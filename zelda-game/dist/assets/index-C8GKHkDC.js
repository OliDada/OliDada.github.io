(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();var Gi=(()=>{for(var e=new Uint8Array(128),t=0;t<64;t++)e[t<26?t+65:t<52?t+71:t<62?t-4:t*4-205]=t;return n=>{for(var r=n.length,s=new Uint8Array((r-(n[r-1]=="=")-(n[r-2]=="="))*3/4|0),i=0,a=0;i<r;){var l=e[n.charCodeAt(i++)],o=e[n.charCodeAt(i++)],u=e[n.charCodeAt(i++)],c=e[n.charCodeAt(i++)];s[a++]=l<<2|o>>4,s[a++]=o<<4|u>>2,s[a++]=u<<6|c}return s}})(),Ki={version:"3001.0.19"};function Ze(e,t,n){return t>n?Ze(e,n,t):Math.min(Math.max(e,t),n)}var W=class de{r=255;g=255;b=255;constructor(t,n,r){this.r=Ze(t,0,255),this.g=Ze(n,0,255),this.b=Ze(r,0,255)}static fromArray(t){return new de(t[0],t[1],t[2])}static fromHex(t){if(typeof t=="number")return new de(t>>16&255,t>>8&255,t>>0&255);if(typeof t=="string"){let n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);if(!n)throw new Error("Invalid hex color format");return new de(parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16))}else throw new Error("Invalid hex color format")}static fromHSL(t,n,r){if(n==0)return new de(255*r,255*r,255*r);let s=(c,m,d)=>(d<0&&(d+=1),d>1&&(d-=1),d<1/6?c+(m-c)*6*d:d<1/2?m:d<2/3?c+(m-c)*(2/3-d)*6:c),i=r<.5?r*(1+n):r+n-r*n,a=2*r-i,l=s(a,i,t+1/3),o=s(a,i,t),u=s(a,i,t-1/3);return new de(Math.round(l*255),Math.round(o*255),Math.round(u*255))}static RED=new de(255,0,0);static GREEN=new de(0,255,0);static BLUE=new de(0,0,255);static YELLOW=new de(255,255,0);static MAGENTA=new de(255,0,255);static CYAN=new de(0,255,255);static WHITE=new de(255,255,255);static BLACK=new de(0,0,0);clone(){return new de(this.r,this.g,this.b)}lighten(t){return new de(this.r+t,this.g+t,this.b+t)}darken(t){return this.lighten(-t)}invert(){return new de(255-this.r,255-this.g,255-this.b)}mult(t){return new de(this.r*t.r/255,this.g*t.g/255,this.b*t.b/255)}lerp(t,n){return new de(Te(this.r,t.r,n),Te(this.g,t.g,n),Te(this.b,t.b,n))}toHSL(){let t=this.r/255,n=this.g/255,r=this.b/255,s=Math.max(t,n,r),i=Math.min(t,n,r),a=(s+i)/2,l=a,o=a;if(s==i)a=l=0;else{let u=s-i;switch(l=o>.5?u/(2-s-i):u/(s+i),s){case t:a=(n-r)/u+(n<r?6:0);break;case n:a=(r-t)/u+2;break;case r:a=(t-n)/u+4;break}a/=6}return[a,l,o]}eq(t){return this.r===t.r&&this.g===t.g&&this.b===t.b}toString(){return`rgb(${this.r}, ${this.g}, ${this.b})`}toHex(){return"#"+((1<<24)+(this.r<<16)+(this.g<<8)+this.b).toString(16).slice(1)}toArray(){return[this.r,this.g,this.b]}};function _(...e){if(e.length===0)return new W(255,255,255);if(e.length===1){if(e[0]instanceof W)return e[0].clone();if(typeof e[0]=="string")return W.fromHex(e[0]);if(Array.isArray(e[0])&&e[0].length===3)return W.fromArray(e[0])}else if(e.length===2){if(e[0]instanceof W)return e[0].clone()}else if(e.length===3||e.length===4)return new W(e[0],e[1],e[2]);throw new Error("Invalid color arguments")}var zi=(e,t,n)=>W.fromHSL(e,t,n);function ce(e){return e*Math.PI/180}function wt(e){return e*180/Math.PI}function Te(e,t,n){if(typeof e=="number"&&typeof t=="number")return e+(t-e)*n;if(e instanceof E&&t instanceof E||e instanceof W&&t instanceof W)return e.lerp(t,n);throw new Error(`Bad value for lerp(): ${e}, ${t}. Only number, Vec2 and Color is supported.`)}function Je(e,t,n,r,s){return r+(e-t)/(n-t)*(s-r)}function Yi(e,t,n,r,s){return Ze(Je(e,t,n,r,s),r,s)}var E=class ge{x=0;y=0;constructor(t=0,n=t){this.x=t,this.y=n}static fromAngle(t){let n=ce(t);return new ge(Math.cos(n),Math.sin(n))}static fromArray(t){return new ge(t[0],t[1])}static ZERO=new ge(0,0);static ONE=new ge(1,1);static LEFT=new ge(-1,0);static RIGHT=new ge(1,0);static UP=new ge(0,-1);static DOWN=new ge(0,1);clone(){return new ge(this.x,this.y)}add(...t){let n=x(...t);return new ge(this.x+n.x,this.y+n.y)}sub(...t){let n=x(...t);return new ge(this.x-n.x,this.y-n.y)}scale(...t){let n=x(...t);return new ge(this.x*n.x,this.y*n.y)}dist(...t){let n=x(...t);return this.sub(n).len()}sdist(...t){let n=x(...t);return this.sub(n).slen()}static sdist(t,n){let r=t.x-n.x,s=t.y-n.y;return r*r+s*s}len(){return Math.sqrt(this.dot(this))}slen(){return this.dot(this)}unit(){let t=this.len();return t===0?new ge(0):this.scale(1/t)}normal(){return new ge(this.y,-this.x)}reflect(t){return this.sub(t.scale(2*this.dot(t)))}project(t){return t.scale(t.dot(this)/t.len())}reject(t){return this.sub(this.project(t))}dot(t){return this.x*t.x+this.y*t.y}static dot(t,n){return t.x*n.x+t.y*n.y}cross(t){return this.x*t.y-this.y*t.x}static cross(t,n){return t.x*n.y-t.y*n.x}angle(...t){let n=x(...t);return wt(Math.atan2(this.y-n.y,this.x-n.x))}angleBetween(...t){let n=x(...t);return wt(Math.atan2(this.cross(n),this.dot(n)))}lerp(t,n){return new ge(Te(this.x,t.x,n),Te(this.y,t.y,n))}slerp(t,n){let r=this.dot(t),s=this.cross(t),i=Math.atan2(s,r);return this.scale(Math.sin((1-n)*i)).add(t.scale(Math.sin(n*i))).scale(1/s)}isZero(){return this.x===0&&this.y===0}toFixed(t){return new ge(Number(this.x.toFixed(t)),Number(this.y.toFixed(t)))}transform(t){return t.multVec2(this)}eq(t){return this.x===t.x&&this.y===t.y}bbox(){return new re(this,0,0)}toString(){return`vec2(${this.x.toFixed(2)}, ${this.y.toFixed(2)})`}toArray(){return[this.x,this.y]}};function x(...e){if(e.length===1){if(e[0]instanceof E)return new E(e[0].x,e[0].y);if(Array.isArray(e[0])&&e[0].length===2)return new E(...e[0])}return new E(...e)}var oe=class or{x=0;y=0;w=1;h=1;constructor(t,n,r,s){this.x=t,this.y=n,this.w=r,this.h=s}scale(t){return new or(this.x+this.w*t.x,this.y+this.h*t.y,this.w*t.w,this.h*t.h)}pos(){return new E(this.x,this.y)}clone(){return new or(this.x,this.y,this.w,this.h)}eq(t){return this.x===t.x&&this.y===t.y&&this.w===t.w&&this.h===t.h}toString(){return`quad(${this.x}, ${this.y}, ${this.w}, ${this.h})`}};function he(e,t,n,r){return new oe(e,t,n,r)}var Tn=class qt{a;b;c;d;constructor(t,n,r,s){this.a=t,this.b=n,this.c=r,this.d=s}mul(t){return new qt(this.a*t.a+this.b*t.c,this.a*t.b+this.b*t.d,this.c*t.a+this.d*t.c,this.c*t.b+this.d*t.d)}transform(t){return x(this.a*t.x+this.b*t.y,this.c*t.x+this.d*t.y)}get inverse(){let t=this.det;return new qt(this.d/t,-this.b/t,-this.c/t,this.a/t)}get transpose(){return new qt(this.a,this.c,this.b,this.d)}get eigenvalues(){let t=this.trace/2,n=this.det,r=t+Math.sqrt(t*t-n),s=t-Math.sqrt(t*t-n);return[r,s]}eigenvectors(t,n){return this.c!=0?[[t-this.d,this.c],[n-this.d,this.c]]:this.b!=0?[[this.b,t-this.a],[this.b,n-this.a]]:Math.abs(this.transform(x(1,0)).x-t)<Number.EPSILON?[[1,0],[0,1]]:[[0,1],[1,0]]}get det(){return this.a*this.d-this.b*this.c}get trace(){return this.a+this.d}static rotation(t){let n=Math.cos(t),r=Math.sin(t);return new qt(n,r,-r,n)}static scale(t,n){return new qt(t,0,0,n)}},Yt=class Vt{m11;m12;m13;m21;m22;m23;m31;m32;m33;constructor(t,n,r,s,i,a,l,o,u){this.m11=t,this.m12=n,this.m13=r,this.m21=s,this.m22=i,this.m23=a,this.m31=l,this.m32=o,this.m33=u}static fromMat2(t){return new Vt(t.a,t.b,0,t.c,t.d,0,0,0,1)}toMat2(){return new Tn(this.m11,this.m12,this.m21,this.m22)}mul(t){return new Vt(this.m11*t.m11+this.m12*t.m21+this.m13*t.m31,this.m11*t.m12+this.m12*t.m22+this.m13*t.m32,this.m11*t.m13+this.m12*t.m23+this.m13*t.m33,this.m21*t.m11+this.m22*t.m21+this.m23*t.m31,this.m21*t.m12+this.m22*t.m22+this.m23*t.m32,this.m21*t.m13+this.m22*t.m23+this.m23*t.m33,this.m31*t.m11+this.m32*t.m21+this.m33*t.m31,this.m31*t.m12+this.m32*t.m22+this.m33*t.m32,this.m31*t.m13+this.m32*t.m23+this.m33*t.m33)}get det(){return this.m11*this.m22*this.m33+this.m12*this.m23*this.m31+this.m13*this.m21*this.m32-this.m13*this.m22*this.m31-this.m12*this.m21*this.m33-this.m11*this.m23*this.m32}rotate(t){let n=Math.cos(t),r=Math.sin(t),s=this.m11,i=this.m12;return this.m11=n*this.m11+r*this.m21,this.m12=n*this.m12+r*this.m22,this.m21=n*this.m21-r*s,this.m22=n*this.m22-r*i,this}scale(t,n){return this.m11*=t,this.m12*=t,this.m21*=n,this.m22*=n,this}get inverse(){let t=this.det;return new Vt((this.m22*this.m33-this.m23*this.m32)/t,(this.m13*this.m32-this.m12*this.m33)/t,(this.m12*this.m23-this.m13*this.m22)/t,(this.m23*this.m31-this.m21*this.m33)/t,(this.m11*this.m33-this.m13*this.m31)/t,(this.m13*this.m21-this.m11*this.m23)/t,(this.m21*this.m32-this.m22*this.m31)/t,(this.m12*this.m31-this.m11*this.m32)/t,(this.m11*this.m22-this.m12*this.m21)/t)}get transpose(){return new Vt(this.m11,this.m21,this.m31,this.m12,this.m22,this.m32,this.m13,this.m23,this.m33)}},$e=class tt{m=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];constructor(t){t&&(this.m=t)}static translate(t){return new tt([1,0,0,0,0,1,0,0,0,0,1,0,t.x,t.y,0,1])}static scale(t){return new tt([t.x,0,0,0,0,t.y,0,0,0,0,1,0,0,0,0,1])}static rotateX(t){t=ce(-t);let n=Math.cos(t),r=Math.sin(t);return new tt([1,0,0,0,0,n,-r,0,0,r,n,0,0,0,0,1])}static rotateY(t){t=ce(-t);let n=Math.cos(t),r=Math.sin(t);return new tt([n,0,r,0,0,1,0,0,-r,0,n,0,0,0,0,1])}static rotateZ(t){t=ce(-t);let n=Math.cos(t),r=Math.sin(t);return new tt([n,-r,0,0,r,n,0,0,0,0,1,0,0,0,0,1])}translate(t){return this.m[12]+=this.m[0]*t.x+this.m[4]*t.y,this.m[13]+=this.m[1]*t.x+this.m[5]*t.y,this.m[14]+=this.m[2]*t.x+this.m[6]*t.y,this.m[15]+=this.m[3]*t.x+this.m[7]*t.y,this}scale(t){return this.m[0]*=t.x,this.m[4]*=t.y,this.m[1]*=t.x,this.m[5]*=t.y,this.m[2]*=t.x,this.m[6]*=t.y,this.m[3]*=t.x,this.m[7]*=t.y,this}rotate(t){t=ce(-t);let n=Math.cos(t),r=Math.sin(t),s=this.m[0],i=this.m[1],a=this.m[4],l=this.m[5];return this.m[0]=s*n+i*r,this.m[1]=-s*r+i*n,this.m[4]=a*n+l*r,this.m[5]=-a*r+l*n,this}mult(t){let n=[];for(let r=0;r<4;r++)for(let s=0;s<4;s++)n[r*4+s]=this.m[0+s]*t.m[r*4+0]+this.m[4+s]*t.m[r*4+1]+this.m[8+s]*t.m[r*4+2]+this.m[12+s]*t.m[r*4+3];return new tt(n)}multVec2(t){return new E(t.x*this.m[0]+t.y*this.m[4]+this.m[12],t.x*this.m[1]+t.y*this.m[5]+this.m[13])}getTranslation(){return new E(this.m[12],this.m[13])}getScale(){if(this.m[0]!=0||this.m[1]!=0){let t=this.m[0]*this.m[5]-this.m[1]*this.m[4],n=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new E(n,t/n)}else if(this.m[4]!=0||this.m[5]!=0){let t=this.m[0]*this.m[5]-this.m[1]*this.m[4],n=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new E(t/n,n)}else return new E(0,0)}getRotation(){if(this.m[0]!=0||this.m[1]!=0){let t=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return wt(this.m[1]>0?Math.acos(this.m[0]/t):-Math.acos(this.m[0]/t))}else if(this.m[4]!=0||this.m[5]!=0){let t=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return wt(Math.PI/2-(this.m[5]>0?Math.acos(-this.m[4]/t):-Math.acos(this.m[4]/t)))}else return 0}getSkew(){if(this.m[0]!=0||this.m[1]!=0){let t=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new E(Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(t*t),0)}else if(this.m[4]!=0||this.m[5]!=0){let t=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new E(0,Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(t*t))}else return new E(0,0)}invert(){let t=[],n=this.m[10]*this.m[15]-this.m[14]*this.m[11],r=this.m[9]*this.m[15]-this.m[13]*this.m[11],s=this.m[9]*this.m[14]-this.m[13]*this.m[10],i=this.m[8]*this.m[15]-this.m[12]*this.m[11],a=this.m[8]*this.m[14]-this.m[12]*this.m[10],l=this.m[8]*this.m[13]-this.m[12]*this.m[9],o=this.m[6]*this.m[15]-this.m[14]*this.m[7],u=this.m[5]*this.m[15]-this.m[13]*this.m[7],c=this.m[5]*this.m[14]-this.m[13]*this.m[6],m=this.m[4]*this.m[15]-this.m[12]*this.m[7],d=this.m[4]*this.m[14]-this.m[12]*this.m[6],p=this.m[5]*this.m[15]-this.m[13]*this.m[7],f=this.m[4]*this.m[13]-this.m[12]*this.m[5],v=this.m[6]*this.m[11]-this.m[10]*this.m[7],y=this.m[5]*this.m[11]-this.m[9]*this.m[7],w=this.m[5]*this.m[10]-this.m[9]*this.m[6],C=this.m[4]*this.m[11]-this.m[8]*this.m[7],q=this.m[4]*this.m[10]-this.m[8]*this.m[6],F=this.m[4]*this.m[9]-this.m[8]*this.m[5];t[0]=this.m[5]*n-this.m[6]*r+this.m[7]*s,t[4]=-(this.m[4]*n-this.m[6]*i+this.m[7]*a),t[8]=this.m[4]*r-this.m[5]*i+this.m[7]*l,t[12]=-(this.m[4]*s-this.m[5]*a+this.m[6]*l),t[1]=-(this.m[1]*n-this.m[2]*r+this.m[3]*s),t[5]=this.m[0]*n-this.m[2]*i+this.m[3]*a,t[9]=-(this.m[0]*r-this.m[1]*i+this.m[3]*l),t[13]=this.m[0]*s-this.m[1]*a+this.m[2]*l,t[2]=this.m[1]*o-this.m[2]*u+this.m[3]*c,t[6]=-(this.m[0]*o-this.m[2]*m+this.m[3]*d),t[10]=this.m[0]*p-this.m[1]*m+this.m[3]*f,t[14]=-(this.m[0]*c-this.m[1]*d+this.m[2]*f),t[3]=-(this.m[1]*v-this.m[2]*y+this.m[3]*w),t[7]=this.m[0]*v-this.m[2]*C+this.m[3]*q,t[11]=-(this.m[0]*y-this.m[1]*C+this.m[3]*F),t[15]=this.m[0]*w-this.m[1]*q+this.m[2]*F;let M=this.m[0]*t[0]+this.m[1]*t[4]+this.m[2]*t[8]+this.m[3]*t[12];for(let A=0;A<4;A++)for(let b=0;b<4;b++)t[A*4+b]*=1/M;return new tt(t)}clone(){return new tt([...this.m])}toString(){return this.m.toString()}};function ms(e,t,n,r=s=>-Math.cos(s)){return e+(r(n)+1)/2*(t-e)}var Vi=1103515245,Xi=12345,$r=2147483648,ys=class{seed;constructor(e){this.seed=e}gen(){return this.seed=(Vi*this.seed+Xi)%$r,this.seed/$r}genNumber(e,t){return e+this.gen()*(t-e)}genVec2(e,t){return new E(this.genNumber(e.x,t.x),this.genNumber(e.y,t.y))}genColor(e,t){return new W(this.genNumber(e.r,t.r),this.genNumber(e.g,t.g),this.genNumber(e.b,t.b))}genAny(...e){if(e.length===0)return this.gen();if(e.length===1){if(typeof e[0]=="number")return this.genNumber(0,e[0]);if(e[0]instanceof E)return this.genVec2(x(0,0),e[0]);if(e[0]instanceof W)return this.genColor(_(0,0,0),e[0])}else if(e.length===2){if(typeof e[0]=="number"&&typeof e[1]=="number")return this.genNumber(e[0],e[1]);if(e[0]instanceof E&&e[1]instanceof E)return this.genVec2(e[0],e[1]);if(e[0]instanceof W&&e[1]instanceof W)return this.genColor(e[0],e[1])}throw new Error("More than 2 arguments not supported")}},lr=new ys(Date.now());function Wi(e){return e!=null&&(lr.seed=e),lr.seed}function me(...e){return lr.genAny(...e)}function ws(...e){return Math.floor(me(...e.length>0?e:[2]))}function Qi(e){return me()<=e}function As(e){for(let t=e.length-1;t>0;t--){let n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}return e}function Ji(e,t){return e.length<=t?e.slice():As(e.slice()).slice(0,t)}function Zi(e){return e[ws(e.length)]}function vs(e,t){return e.pos.x+e.width>t.pos.x&&e.pos.x<t.pos.x+t.width&&e.pos.y+e.height>t.pos.y&&e.pos.y<t.pos.y+t.height}function $i(e,t){if(e.p1.x===e.p2.x&&e.p1.y===e.p2.y||t.p1.x===t.p2.x&&t.p1.y===t.p2.y)return null;let n=(t.p2.y-t.p1.y)*(e.p2.x-e.p1.x)-(t.p2.x-t.p1.x)*(e.p2.y-e.p1.y);if(n===0)return null;let r=((t.p2.x-t.p1.x)*(e.p1.y-t.p1.y)-(t.p2.y-t.p1.y)*(e.p1.x-t.p1.x))/n,s=((e.p2.x-e.p1.x)*(e.p1.y-t.p1.y)-(e.p2.y-e.p1.y)*(e.p1.x-t.p1.x))/n;return r<0||r>1||s<0||s>1?null:r}function Tr(e,t){let n=$i(e,t);return n?x(e.p1.x+n*(e.p2.x-e.p1.x),e.p1.y+n*(e.p2.y-e.p1.y)):null}function qr(e,t){let n=t.p2.sub(t.p1),r=Number.NEGATIVE_INFINITY,s=Number.POSITIVE_INFINITY;if(n.x!=0){let i=(e.pos.x-t.p1.x)/n.x,a=(e.pos.x+e.width-t.p1.x)/n.x;r=Math.max(r,Math.min(i,a)),s=Math.min(s,Math.max(i,a))}if(n.y!=0){let i=(e.pos.y-t.p1.y)/n.y,a=(e.pos.y+e.height-t.p1.y)/n.y;r=Math.max(r,Math.min(i,a)),s=Math.min(s,Math.max(i,a))}return s>=r&&s>=0&&r<=1}function jn(e,t){return t.x>e.pos.x&&t.x<e.pos.x+e.width&&t.y>e.pos.y&&t.y<e.pos.y+e.height}function bs(e,t){let n=Math.max(e.pos.x,Math.min(t.center.x,e.pos.x+e.width)),r=Math.max(e.pos.y,Math.min(t.center.y,e.pos.y+e.height));return x(n,r).sdist(t.center)<=t.radius*t.radius}function xs(e,t){return Ss(t,new Ee(e.points()))}function Ir(e,t){let n=t.sub(e.p1),r=e.p2.sub(e.p1);if(Math.abs(n.cross(r))>Number.EPSILON)return!1;let s=n.dot(r)/r.dot(r);return s>=0&&s<=1}function an(e,t){let n=e.p2.sub(e.p1),r=n.dot(n),s=e.p1.sub(t.center),i=2*n.dot(s),a=s.dot(s)-t.radius*t.radius,l=i*i-4*r*a;if(r<=Number.EPSILON||l<0)return!1;if(l==0){let o=-i/(2*r);if(o>=0&&o<=1)return!0}else{let o=(-i+Math.sqrt(l))/(2*r),u=(-i-Math.sqrt(l))/(2*r);if(o>=0&&o<=1||u>=0&&u<=1)return!0}return Ln(t,e.p1)}function Br(e,t){if(dt(t,e.p1)||dt(t,e.p2))return!0;for(let n=0;n<t.pts.length;n++){let r=t.pts[n],s=t.pts[(n+1)%t.pts.length];if(Tr(e,new Ie(r,s)))return!0}return!1}function Ln(e,t){return e.center.sdist(t)<e.radius*e.radius}function _i(e,t){return e.center.sdist(t.center)<(e.radius+t.radius)*(e.radius+t.radius)}function Nn(e,t){let n=t.pts[t.pts.length-1];for(let r of t.pts){if(an(new Ie(n,r),e))return!0;n=r}return Ln(e,t.pts[0])?!0:dt(t,e.center)}function Ss(e,t){for(let n=0;n<e.pts.length;n++)if(Br(new Ie(e.pts[n],e.pts[(n+1)%e.pts.length]),t))return!0;return!!(e.pts.some(n=>dt(t,n))||t.pts.some(n=>dt(e,n)))}function dt(e,t){let n=!1,r=e.pts;for(let s=0,i=r.length-1;s<r.length;i=s++)r[s].y>t.y!=r[i].y>t.y&&t.x<(r[i].x-r[s].x)*(t.y-r[s].y)/(r[i].y-r[s].y)+r[s].x&&(n=!n);return n}function Dr(e,t){t=t.sub(e.center);let n=ce(e.angle),r=Math.cos(n),s=Math.sin(n),i=t.x*r+t.y*s,a=-t.x*s+t.y*r;return i*i/(e.radiusX*e.radiusX)+a*a/(e.radiusY*e.radiusY)<1}function qn(e,t){let n=t.center.sub(e.center),r=ce(e.angle),s=Math.cos(r),i=Math.sin(r),a=n.x*s+n.y*i,l=-n.x*i+n.y*s;return Dr(new nt(x(),e.radiusX+t.radius,e.radiusY+t.radius,0),x(a,l))}function Es(e,t){let n=e.toMat2().inverse;return t=new Ie(n.transform(t.p1.sub(e.center)),n.transform(t.p2.sub(e.center))),an(t,new qe(x(),1))}function ki(e,t){if(e.radiusX===e.radiusY)return qn(t,new qe(e.center,e.radiusX));if(t.radiusX===t.radiusY)return qn(e,new qe(t.center,t.radiusX));let n=new Yt(1/e.radiusX**2,0,0,0,1/e.radiusY**2,0,0,0,-1),r=new Yt(1/t.radiusX**2,0,0,0,1/t.radiusY**2,0,0,0,-1),s=e.center.x,i=e.center.y,a=t.center.x,l=t.center.y,o=ce(e.angle),u=ce(t.angle),c=new Yt(Math.cos(o),-Math.sin(o),s,Math.sin(o),Math.cos(o),i,0,0,1),m=new Yt(Math.cos(u),-Math.sin(u),a,Math.sin(u),Math.cos(u),l,0,0,1),d=c.inverse,p=m.inverse,f=d.transpose.mul(n).mul(d),v=p.transpose.mul(r).mul(p),y=f.m11,w=f.m12,C=f.m13,q=f.m21,F=f.m22,M=f.m23,A=f.m31,b=f.m32,T=f.m33,I=v.m11,B=v.m12,R=v.m13,H=v.m21,V=v.m22,X=v.m23,Q=v.m31,U=v.m32,j=v.m33,ie=y*F*T-y*M*b-w*q*T+w*M*A+C*q*b-C*F*A,J=(y*F*j-y*M*U-y*b*X+y*T*V-w*q*j+w*M*Q+w*A*X-w*T*H+C*q*U-C*F*Q-C*A*V+C*b*H+q*b*R-q*T*B-F*A*R+F*T*I+M*A*B-M*b*I)/ie,ee=(y*V*j-y*X*U-w*H*j+w*X*Q+C*H*U-C*V*Q-q*B*j+q*R*U+F*I*j-F*R*Q-M*I*U+M*B*Q+A*B*X-A*R*V-b*I*X+b*R*H+T*I*V-T*B*H)/ie,we=(I*V*j-I*X*U-B*H*j+B*X*Q+R*H*U-R*V*Q)/ie;if(J>=0){let N=-3*ee+J**2,ft=3*J*we+ee*J**2-4*ee**2,Mt=-27*we**2+18*we*J*ee+J**2*ee**2-4*J**3*we-4*ee**3;return!(N>0&&ft<0&&Mt>0)}else{let N=-3*ee+J**2,ft=-27*we**2+18*we*J*ee+J**2*ee**2-4*J**3*we-4*ee**3;return!(N>0&&ft>0)}}function Ms(e,t){return Rr(e,new Ee(t.points()))}function Rr(e,t){let n=e.toMat2().inverse;return t=new Ee(t.pts.map(r=>n.transform(r.sub(e.center)))),Nn(new qe(x(),1),t)}function ea(e,t){return e.x===t.x&&e.y===t.y}function ta(e,t){return t instanceof E?ea(t,e.pt):t instanceof qe?Ln(t,e.pt):t instanceof Ie?Ir(t,e.pt):t instanceof re?jn(t,e.pt):t instanceof Ee?dt(t,e.pt):t instanceof nt?Dr(t,e.pt):!1}function na(e,t){return t instanceof E?Ir(e,t):t instanceof qe?an(e,t):t instanceof Ie?Tr(e,t)!=null:t instanceof re?qr(t,e):t instanceof Ee?Br(e,t):t instanceof nt?Es(t,e):!1}function ra(e,t){return t instanceof E?Ln(e,t):t instanceof qe?_i(e,t):t instanceof Ie?an(t,e):t instanceof re?bs(t,e):t instanceof Ee?Nn(e,t):t instanceof nt?qn(t,e):!1}function sa(e,t){return t instanceof E?jn(e,t):t instanceof qe?bs(e,t):t instanceof Ie?qr(e,t):t instanceof re?vs(e,t):t instanceof Ee?xs(e,t):t instanceof nt?Ms(t,e):!1}function ia(e,t){return t instanceof E?dt(e,t):t instanceof qe?Nn(t,e):t instanceof Ie?Br(t,e):t instanceof re?xs(t,e):t instanceof Ee?Ss(t,e):t instanceof nt?Rr(t,e):!1}function aa(e,t){return t instanceof E?Dr(e,t):t instanceof qe?qn(e,t):t instanceof Ie?Es(e,t):t instanceof re?Ms(e,t):t instanceof Ee?Rr(e,t):t instanceof nt?ki(t,e):!1}function Cs(e,t,n){let r=e,s=n.p1,i=n.p2,a=t,l=i.sub(s),o=a.cross(l);if(Math.abs(o)<Number.EPSILON)return null;let u=s.sub(r),c=u.cross(l)/o;if(c<=0||c>=1)return null;let m=u.cross(a)/o;if(m<=0||m>=1)return null;let d=l.normal().unit();return t.dot(d)>0&&(d.x*=-1,d.y*=-1),{point:r.add(a.scale(c)),normal:d,fraction:c}}function oa(e,t,n){let r=Number.NEGATIVE_INFINITY,s=Number.POSITIVE_INFINITY,i;if(e.x!=0){let a=(n.pos.x-e.x)/t.x,l=(n.pos.x+n.width-e.x)/t.x;i=x(-Math.sign(t.x),0),r=Math.max(r,Math.min(a,l)),s=Math.min(s,Math.max(a,l))}if(e.y!=0){let a=(n.pos.y-e.y)/t.y,l=(n.pos.y+n.height-e.y)/t.y;Math.min(a,l)>r&&(i=x(0,-Math.sign(t.y))),r=Math.max(r,Math.min(a,l)),s=Math.min(s,Math.max(a,l))}return s>=r&&r>=0&&r<=1?{point:e.add(t.scale(r)),normal:i,fraction:r}:null}function Ps(e,t,n){let r=e,s=n.center,i=t,a=i.dot(i),l=r.sub(s),o=2*i.dot(l),u=l.dot(l)-n.radius*n.radius,c=o*o-4*a*u;if(a<=Number.EPSILON||c<0)return null;if(c==0){let m=-o/(2*a);if(m>=0&&m<=1){let d=r.add(i.scale(m));return{point:d,normal:d.sub(s),fraction:m}}}else{let m=(-o+Math.sqrt(c))/(2*a),d=(-o-Math.sqrt(c))/(2*a),p=null;if(m>=0&&m<=1&&(p=m),d>=0&&d<=1&&(p=Math.min(d,p??d)),p!=null){let f=r.add(i.scale(p));return{point:f,normal:f.sub(s).unit(),fraction:p}}}return null}function la(e,t,n){let r=n.pts,s=null,i=r[r.length-1];for(let a=0;a<r.length;a++){let l=r[a],o=Cs(e,t,new Ie(i,l));o&&(!s||s.fraction>o.fraction)&&(s=o),i=l}return s}function ua(e,t,n){let r=n.toMat2(),s=r.inverse,i=s.transform(e.sub(n.center)),a=s.transform(t),l=Ps(i,a,new qe(x(),1));if(l){let o=Tn.rotation(ce(-n.angle)),u=Tn.scale(n.radiusX,n.radiusY).transform(l.point),c=r.transform(l.point).add(n.center),m=c.dist(e)/t.len();return{point:c,normal:o.transform(x(n.radiusY**2*u.x,n.radiusX**2*u.y)).unit(),fraction:m}}return l}function da(e,t,n,r=64){let s=e,i=t.len(),a=t.scale(1/i),l=0,o=x(Math.floor(e.x),Math.floor(e.y)),u=x(a.x>0?1:-1,a.y>0?1:-1),c=x(Math.abs(1/a.x),Math.abs(1/a.y)),m=x(u.x>0?o.x+1-e.x:e.x-o.x,u.y>0?o.y+1-e.y:e.y-o.y),d=x(c.x<1/0?c.x*m.x:1/0,c.y<1/0?c.y*m.y:1/0),p=-1;for(;l<=r;){let f=n(o);if(f===!0)return{point:s.add(a.scale(l)),normal:x(p===0?-u.x:0,p===1?-u.y:0),fraction:l/i,gridPos:o};if(f)return f;d.x<d.y?(o.x+=u.x,l=d.x,d.x+=c.x,p=0):(o.y+=u.y,l=d.y,d.y+=c.y,p=1)}return null}var ha=class ur{pt;constructor(t){this.pt=t.clone()}transform(t){return new ur(t.multVec2(this.pt))}bbox(){return new re(this.pt,0,0)}area(){return 0}clone(){return new ur(this.pt)}collides(t){return ta(this,t)}contains(t){return this.pt.eq(t)}raycast(t,n){return null}random(){return this.pt.clone()}},Ie=class dr{p1;p2;constructor(t,n){this.p1=t.clone(),this.p2=n.clone()}transform(t){return new dr(t.multVec2(this.p1),t.multVec2(this.p2))}bbox(){return re.fromPoints(this.p1,this.p2)}area(){return this.p1.dist(this.p2)}clone(){return new dr(this.p1,this.p2)}collides(t){return na(this,t)}contains(t){return this.collides(t)}raycast(t,n){return Cs(t,n,this)}random(){return this.p1.add(this.p2.sub(this.p1).scale(me(1)))}},re=class hr{pos;width;height;constructor(t,n,r){this.pos=t.clone(),this.width=n,this.height=r}static fromPoints(t,n){return new hr(t.clone(),n.x-t.x,n.y-t.y)}center(){return new E(this.pos.x+this.width/2,this.pos.y+this.height/2)}points(){return[this.pos,this.pos.add(this.width,0),this.pos.add(this.width,this.height),this.pos.add(0,this.height)]}transform(t){return new Ee(this.points().map(n=>t.multVec2(n)))}bbox(){return this.clone()}area(){return this.width*this.height}clone(){return new hr(this.pos.clone(),this.width,this.height)}distToPoint(t){return Math.sqrt(this.sdistToPoint(t))}sdistToPoint(t){let n=this.pos,r=this.pos.add(this.width,this.height),s=Math.max(n.x-t.x,0,t.x-r.x),i=Math.max(n.y-t.y,0,t.y-r.y);return s*s+i*i}collides(t){return sa(this,t)}contains(t){return this.collides(t)}raycast(t,n){return oa(t,n,this)}random(){return this.pos.add(me(this.width),me(this.height))}},qe=class Ts{center;radius;constructor(t,n){this.center=t.clone(),this.radius=n}transform(t){return new nt(this.center,this.radius,this.radius).transform(t)}bbox(){return re.fromPoints(this.center.sub(x(this.radius)),this.center.add(x(this.radius)))}area(){return this.radius*this.radius*Math.PI}clone(){return new Ts(this.center,this.radius)}collides(t){return ra(this,t)}contains(t){return this.collides(t)}raycast(t,n){return Ps(t,n,this)}random(){return this.center.add(E.fromAngle(me(360)).scale(me(this.radius)))}},nt=class It{center;radiusX;radiusY;angle;constructor(t,n,r,s=0){this.center=t.clone(),this.radiusX=n,this.radiusY=r,this.angle=s}static fromMat2(t){let n=t.inverse,r=n.transpose.mul(n),[s,i]=r.eigenvalues,[a,l]=r.eigenvectors(s,i),[o,u]=[1/Math.sqrt(s),1/Math.sqrt(i)];return o>u?new It(x(),o,u,wt(Math.atan2(-a[1],a[0]))):new It(x(),u,o,wt(Math.atan2(-l[1],l[0])))}toMat2(){let t=ce(this.angle),n=Math.cos(t),r=Math.sin(t);return new Tn(n*this.radiusX,-r*this.radiusY,r*this.radiusX,n*this.radiusY)}transform(t){if(this.angle==0&&t.getRotation()==0)return new It(t.multVec2(this.center),t.m[0]*this.radiusX,t.m[5]*this.radiusY);{let n=this.toMat2(),r=t.getRotation(),s=t.getScale();n=Yt.fromMat2(n).scale(s.x,s.y).rotate(r).toMat2();let i=It.fromMat2(n);return i.center=t.multVec2(this.center),i}}bbox(){if(this.angle==0)return re.fromPoints(this.center.sub(x(this.radiusX,this.radiusY)),this.center.add(x(this.radiusX,this.radiusY)));{let t=ce(this.angle),n=Math.cos(t),r=Math.sin(t),s=this.radiusX*n,i=this.radiusX*r,a=this.radiusY*r,l=this.radiusY*n,o=Math.sqrt(s*s+a*a),u=Math.sqrt(i*i+l*l);return re.fromPoints(this.center.sub(x(o,u)),this.center.add(x(o,u)))}}area(){return this.radiusX*this.radiusY*Math.PI}clone(){return new It(this.center,this.radiusX,this.radiusY,this.angle)}collides(t){return aa(this,t)}contains(t){t=t.sub(this.center);let n=ce(this.angle),r=Math.cos(n),s=Math.sin(n),i=t.x*r+t.y*s,a=-t.x*s+t.y*r;return i*i/(this.radiusX*this.radiusX)+a*a/(this.radiusY*this.radiusY)<1}raycast(t,n){return ua(t,n,this)}random(){return this.center}};function ca(e,t,n,r){let s=t.sub(e),i=r.sub(n),a=s.cross(i);return a<1e-5&&a>-1e-5||(a=n.sub(e).cross(i)/a,a<0||a>1)?null:e.add(s.scale(a))}var Ee=class Xt{pts;constructor(t){if(t.length<3)throw new Error("Polygons should have at least 3 vertices");this.pts=t}transform(t){return new Xt(this.pts.map(n=>t.multVec2(n)))}bbox(){let t=x(Number.MAX_VALUE),n=x(-Number.MAX_VALUE);for(let r of this.pts)t.x=Math.min(t.x,r.x),n.x=Math.max(n.x,r.x),t.y=Math.min(t.y,r.y),n.y=Math.max(n.y,r.y);return re.fromPoints(t,n)}area(){let t=0,n=this.pts.length;for(let r=0;r<n;r++){let s=this.pts[r],i=this.pts[(r+1)%n];t+=s.x*i.y*.5,t-=i.x*s.y*.5}return Math.abs(t)}clone(){return new Xt(this.pts.map(t=>t.clone()))}collides(t){return ia(this,t)}contains(t){return this.collides(t)}raycast(t,n){return la(t,n,this)}random(){return x()}cut(t,n){new Ie(t,n);let r=[],s=[],i=n.sub(t),a=this.pts[this.pts.length-1],l=a.sub(t),o=i.cross(l)>0;return this.pts.forEach(u=>{l=u.sub(t);let c=i.cross(l)>0;if(o!=c){let m=ca(a,u,t,n);r.push(m),s.push(m),o=c}(c?r:s).push(u),a=u}),[r.length?new Xt(r):null,s.length?new Xt(s):null]}};function fa(e,t,n,r){let s=r*r,i=1-r,a=i*i;return e.scale(a).add(t.scale(2*i*r)).add(n.scale(s))}function pa(e,t,n,r){let s=1-r;return t.sub(e).scale(2*s).add(n.sub(t).scale(2*r))}function ga(e,t,n,r){return n.sub(t.scale(2)).add(e).scale(2)}function Fr(e,t,n,r,s){let i=s*s,a=i*s,l=1-s,o=l*l,u=o*l;return e.scale(u).add(t.scale(3*o*s)).add(n.scale(3*l*i)).add(r.scale(a))}function ma(e,t,n,r,s){let i=s*s,a=1-s,l=a*a;return t.sub(e).scale(3*l).add(n.sub(t).scale(6*a*s)).add(r.sub(n).scale(3*i))}function ya(e,t,n,r,s){let i=1-s;return n.sub(t.scale(2)).add(e).scale(6*i).add(r.sub(n.scale(2)).add(t).scale(6*s))}function wa(e,t,n,r,s){let i=.5*(((-s+2)*s-1)*s),a=.5*((3*s-5)*s*s+2),l=.5*(((-3*s+4)*s+1)*s),o=.5*((s-1)*s*s);return e.scale(i).add(t.scale(a)).add(n.scale(l)).add(r.scale(o))}function Aa(e,t,n,r,s){let i=.5*((-3*s+4)*s-1),a=.5*((9*s-10)*s),l=.5*((-9*s+8)*s+1),o=.5*((3*s-2)*s);return e.scale(i).add(t.scale(a)).add(n.scale(l)).add(r.scale(o))}function va(e){let t=qs(e),n=t(1);return r=>{let s=r*n,i=t(s,!0);return e(i)}}function qs(e,t=10,n=10){let r=[0],s=[0],i=1/(t-1)/n,a=0,l=e(0),o=0;for(let u=1;u<t;u++){for(let c=0;c<n;c++){o+=i;let m=e(o),d=m.dist(l);a+=d,l=m}r[u]=a,s[u]=o}return s[t-1]=1,(u,c=!1)=>{if(c){let m=u;if(m<=0)return 0;if(m>=a)return 1;let d=0;for(;r[d+1]<m;)d++;let p=s[d],f=s[d+1],v=r[d],y=r[d+1],w=(m-v)/(y-v);return p+(f-p)*w}else{if(u<=0)return 0;if(u>=1)return r[t-1];let m=0;for(;s[m+1]<u;)m++;let d=s[m],p=s[m+1],f=r[m],v=r[m+1],y=(u-d)/(p-d);return f+(v-f)*y}}}function on(e,t,n,r){let s=2*e+t-2*r+n,i=-3*e+3*r-2*t-n,a=t,l=e;return o=>{let u=o*o,c=u*o;return s*c+i*u+a*o+l}}function Is(e,t,n,r,s,i=on){let a=i(t.x,(1-s)*(n.x-e.x),(1-s)*(r.x-t.x),n.x),l=i(t.y,(1-s)*(n.y-e.y),(1-s)*(r.y-t.y),n.y);return o=>new E(a(o),l(o))}function In(e,t,n,r,s=on){return Is(e,t,n,r,.5,s)}function ba(e,t,n,r,s=on){return In(r.add(e.sub(t).scale(6)),e,r,e.add(r.sub(n).scale(6)),s)}function xa(e,t,n,r,s,i,a,l=on){let o=l(t.x,.5*(1-s)*(1+a)*(1+i)*(t.x-e.x)+.5*(1-s)*(1-a)*(1-i)*(n.x-t.x),.5*(1-s)*(1+a)*(1-i)*(n.x-t.x)+.5*(1-s)*(1-a)*(1+i)*(r.x-n.x),n.x),u=l(t.y,.5*(1-s)*(1+a)*(1+i)*(t.y-e.y)+.5*(1-s)*(1-a)*(1-i)*(n.y-t.y),.5*(1-s)*(1+a)*(1-i)*(n.y-t.y)+.5*(1-s)*(1-a)*(1+i)*(r.y-n.y),n.y);return c=>new E(o(c),u(c))}function Sa(e,t,n,r){let s=2*e+t-2*r+n,i=-3*e+3*r-2*t+n,a=t;return l=>{let o=l*l;return 3*s*o+2*i*l+a}}function Ut(e){return 0<=e&&e<=1}function _n(e,t){return Math.abs(e-t)<=Number.EPSILON}function Gt(e){return e<0?-Math.pow(-e,1/3):Math.pow(e,1/3)}function Ea(e,t,n,r){let s=3*e-6*t+3*n,i=-3*e+3*t,a=e,l=-e+3*t-3*n+r;if(_n(l,0)){if(_n(s,0))return _n(i,0)?[]:[-a/i].filter(Ut);let y=Math.sqrt(i*i-4*s*a),w=2*s;return[(y-i)/w,(-i-y)/w].filter(Ut)}s/=l,i/=l,a/=l;let o=(3*i-s*s)/3,u=o/3,c=(2*s*s*s-9*s*i+27*a)/27,m=c/2,d=m*m+u*u*u;if(d<0){let y=-o/3,w=y*y*y,C=Math.sqrt(w),q=-c/(2*C),F=q<-1?-1:q>1?1:q,M=Math.acos(F),A=2*Gt(C),b=A*Math.cos(M/3)-s/3,T=A*Math.cos((M+2*Math.PI)/3)-s/3,I=A*Math.cos((M+4*Math.PI)/3)-s/3;return[b,T,I].filter(Ut)}if(d===0){let y=m<0?Gt(-m):-Gt(m),w=2*y-s/3,C=-y-s/3;return[w,C].filter(Ut)}let p=Math.sqrt(d),f=Gt(p-m),v=Gt(p+m);return[f-v-s/3].filter(Ut)}function Ma(e,t,n,r,s){let i=Ea(e.x-s,t.x-s,n.x-s,r.x-s);return i.length>0?Fr(e,t,n,r,i[0]).y:NaN}function Ca(e){if(!e||e.length==0)throw new Error("Need at least one point for easingLinear.");let t=e.length;return n=>{if(n<=0||e.length==1||n<=e[0].x)return e[0].y;for(let r=0;r<t;r++)if(e[r].x>=n)return Je(n,e[r-1].x,e[r].x,e[r-1].y,e[r].y);return e[e.length-1].y}}function Pa(e,t){return n=>Ma(x(0,0),e,t,x(1,1),n)}function Ta(e,t="jump-end"){let n=1/e,r=t=="jump-start"||t=="jump-both",s=t=="jump-end"||t=="jump-both",i=1/(e+(s?1:0)),a=r?i:0;return l=>{let o=Math.floor(l/n);return a+o*i}}function qa(e,t){let n=Number.MAX_VALUE,r={normal:x(0),distance:0};for(let s of[e,t])for(let i=0;i<s.pts.length;i++){let a=s.pts[i],l=s.pts[(i+1)%s.pts.length].sub(a).normal().unit(),o=Number.MAX_VALUE,u=-Number.MAX_VALUE;for(let p=0;p<e.pts.length;p++){let f=e.pts[p].dot(l);o=Math.min(o,f),u=Math.max(u,f)}let c=Number.MAX_VALUE,m=-Number.MAX_VALUE;for(let p=0;p<t.pts.length;p++){let f=t.pts[p].dot(l);c=Math.min(c,f),m=Math.max(m,f)}let d=Math.min(u,m)-Math.max(o,c);if(d<0)return null;if(d<Math.abs(n)){let p=m-o,f=c-u;n=Math.abs(p)<Math.abs(f)?p:f,r.normal=l,r.distance=n}}return r}function Bs(e,t,n){return(t.x-e.x)*(n.y-e.y)-(t.y-e.y)*(n.x-e.x)>=0}function Ia(e){let t=0,n=e[e.length-1];for(let r=0;r<e.length;r++)t+=(e[r].x-n.x)*(e[r].y+n.y),n=e[r];return t<0}function kn(e,t,n,r){let s=r.x-n.x,i=r.y-n.y,a=s*(e.y-n.y)-i*(e.x-n.x),l=s*(t.y-n.y)-i*(t.x-n.x);return a*l>=0}function Ba(e,t,n,r){return kn(e,t,n,r)&&kn(e,n,t,r)&&kn(e,r,t,n)}function Da(e,t,n,r){for(let s of e)if(s!==t&&s!==n&&s!==r&&Ba(s,t,n,r))return!0;return!1}function Ra(e,t,n,r){return Bs(e,t,n)&&!Da(r,e,t,n)}function Ds(e){if(e.length<3)return[];if(e.length==3)return[e];let t=[],n=[],r=0;for(let m=0;m<e.length;m++){let d=e[r],p=e[m];(p.x<d.x||p.x==d.x&&p.y<d.y)&&(r=r),t[m]=m+1,n[m]=m-1}t[t.length-1]=0,n[0]=n.length-1,Ia(e)||([t,n]=[n,t]);let s=[];for(let m=0;m<e.length;++m)Bs(e[n[m]],e[m],e[t[m]])||s.push(e[m]);let i=[],a=e.length,l=1,o=0,u,c;for(;a>3;){u=t[l],c=n[l];let m=e[c],d=e[l],p=e[u];if(Ra(m,d,p,s))i.push([m,d,p]),t[c]=u,n[u]=c,s.splice(s.indexOf(d),1),--a,o=0;else if(++o>a)return[];l=u}return u=t[l],c=n[l],i.push([e[c],e[l],e[u]]),i}function Fa(e){if(e.length<3)return!1;let t=e.length-2,n=e.length-1,r=0,s=e[n].sub(e[t]),i=e[r].sub(e[n]),a=s.cross(i);for(;r+1<e.length;)if(t=n,n=r,r++,s=e[n].sub(e[t]),i=e[r].sub(e[n]),s.cross(i)*a<0)return!1;return!0}var Rs=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",Un="topleft",Oa="monospace",Bn="monospace",cr="linear",Or=[{name:"a_pos",size:2},{name:"a_uv",size:2},{name:"a_color",size:4}],Ha=Or.reduce((e,t)=>e+t.size,0),Fs=2048,ja=Fs*4*Ha,La=Fs*6,Na=`
attribute vec2 a_pos;
attribute vec2 a_uv;
attribute vec4 a_color;

varying vec2 v_pos;
varying vec2 v_uv;
varying vec4 v_color;

vec4 def_vert() {
	return vec4(a_pos, 0.0, 1.0);
}

{{user}}

void main() {
	vec4 pos = vert(a_pos, a_uv, a_color);
	v_pos = a_pos;
	v_uv = a_uv;
	v_color = a_color;
	gl_Position = pos;
}
`,Ua=`
precision mediump float;

varying vec2 v_pos;
varying vec2 v_uv;
varying vec4 v_color;

uniform sampler2D u_tex;

vec4 def_frag() {
	vec4 texColor = texture2D(u_tex, v_uv);
	return vec4((v_color.rgb * texColor.rgb), texColor.a) * v_color.a;
}

{{user}}

void main() {
	gl_FragColor = frag(v_pos, v_uv, v_color, u_tex);
	if (gl_FragColor.a == 0.0) {
		discard;
	}
}
`,fr=`
vec4 vert(vec2 pos, vec2 uv, vec4 color) {
	return def_vert();
}
`,pr=`
vec4 frag(vec2 pos, vec2 uv, vec4 color, sampler2D tex) {
	return def_frag();
}
`,Ga=new Set(["id","require"]),Ka=new Set(["add","fixedUpdate","update","draw","destroy","inspect","drawInspect"]),_r=200,za=640,Ya=65536,Os=Symbol.for("kaplay.cancel"),Hs=class extends Map{lastID=0;push(e){let t=this.lastID;return this.set(t,e),this.lastID++,t}pushd(e){let t=this.push(e);return()=>this.delete(t)}},St=class js{paused=!1;cancel;constructor(t){this.cancel=t}static join(t){let n=new js(()=>t.forEach(r=>r.cancel()));return Object.defineProperty(n,"paused",{get:()=>t[0].paused,set:r=>t.forEach(s=>s.paused=r)}),n.paused=!1,n}static replace(t,n){return t.cancel=()=>n.cancel(),n.paused=t.paused,Object.defineProperty(t,"paused",{get:()=>n.paused,set:r=>n.paused=r}),t}},Se=class{cancellers=new WeakMap;handlers=new Hs;add(e){function t(...s){if(!r.paused)return e(...s)}let n=this.handlers.pushd(t),r=new St(n);return this.cancellers.set(t,n),r}addOnce(e){let t=this.add((...n)=>{t.cancel(),e(...n)});return t}next(){return new Promise(e=>this.addOnce(e))}trigger(...e){this.handlers.forEach(t=>{let n=t(...e),r;n===Os&&(r=this.cancellers.get(t))&&r()})}numListeners(){return this.handlers.size}clear(){this.handlers.clear()}},en=class{handlers={};registers={};on(e,t){return this.handlers[e]||(this.handlers[e]=new Se),this.handlers[e].add(t)}onOnce(e,t){let n=this.on(e,(...r)=>{n.cancel(),t(...r)});return n}next(e){return new Promise(t=>{this.onOnce(e,(...n)=>t(n[0]))})}trigger(e,...t){this.handlers[e]&&this.handlers[e].trigger(...t)}remove(e){delete this.handlers[e]}clear(){this.handlers={}}numListeners(e){return this.handlers[e]?.numListeners()??0}},Va=e=>e[0]instanceof W,Xa=e=>e[0]instanceof E,Wa=e=>typeof e[0]=="number",Ls=class{_items;_compareFn;constructor(e=(t,n)=>t<n){this._compareFn=e,this._items=[]}insert(e){this._items.push(e),this.moveUp(this._items.length-1)}remove(){if(this._items.length===0)return null;let e=this._items[0],t=this._items.pop();return this._items.length!==0&&(this._items[0]=t,this.moveDown(0)),e}clear(){this._items.splice(0,this._items.length)}moveUp(e){for(;e>0;){let t=Math.floor((e-1)/2);if(!this._compareFn(this._items[e],this._items[t])&&this._items[e]>=this._items[t])break;this.swap(e,t),e=t}}moveDown(e){for(;e<Math.floor(this._items.length/2);){let t=2*e+1;if(t<this._items.length-1&&!this._compareFn(this._items[t],this._items[t+1])&&++t,this._compareFn(this._items[e],this._items[t]))break;this.swap(e,t),e=t}}swap(e,t){[this._items[e],this._items[t]]=[this._items[t],this._items[e]]}get length(){return this._items.length}};function Qa(e){let t=window.atob(e),n=t.length,r=new Uint8Array(n);for(let s=0;s<n;s++)r[s]=t.charCodeAt(s);return r.buffer}function Ja(e){return Qa(e.split(",")[1])}function Hr(e,t){let n=document.createElement("a");n.href=t,n.download=e,n.click()}function Ns(e,t){Hr(e,"data:text/plain;charset=utf-8,"+t)}function Za(e,t){Ns(e,JSON.stringify(t))}function kr(e,t){let n=URL.createObjectURL(t);Hr(e,n),URL.revokeObjectURL(n)}var Us=e=>e.match(/^data:\w+\/\w+;base64,.+/),$a=e=>e.split(".").slice(0,-1).join(".");function jr(e,t){if(e===t)return!0;let n=typeof e,r=typeof t;if(n!==r)return!1;if(n==="object"&&r==="object"&&e!==null&&t!==null){if(Array.isArray(e)!==Array.isArray(t))return!1;let s=Object.keys(e),i=Object.keys(t);if(s.length!==i.length)return!1;for(let a of s){let l=e[a],o=t[a];if(!jr(l,o))return!1}return!0}return!1}var es=new Set,_a=e=>e instanceof Error?e.message:String(e);function ka(e){es.has(e)||(es.add(e),console.warn(e))}function Ft(e,t){ka(`${e} is deprecated. Use ${t} instead.`)}function gr(e,t){return Number(e.toFixed(t))}function se(e,t){return(...n)=>{let r=n.length;if(r===e.length)return e(...n);if(r===t.length)return t(...n)}}var eo=Object.freeze([776,2359,2367,2984,3007,3021,3633,3635,3648,3657,4352,4449,4520]);function to(e){if(typeof e!="string")throw new TypeError("string cannot be undefined or null");let t=[],n=0,r=0;for(;n<e.length;){if(r+=no(n+r,e),uo(e[n+r])&&r++,ao(e[n+r])&&r++,oo(e[n+r])&&r++,ho(e[n+r])){r++;continue}t.push(e.substring(n,n+r)),n+=r,r=0}return t}function no(e,t){let n=t[e];if(!ro(n)||e===t.length-1)return 1;let r=n+t[e+1],s=t.substring(e+2,e+5);return ts(r)&&ts(s)?4:so(r)&&lo(s)?t.slice(e).indexOf(String.fromCodePoint(917631))+2:io(s)?4:2}function ro(e){return e&&Et(e[0].charCodeAt(0),55296,56319)}function ts(e){return Et(Lr(e),127462,127487)}function so(e){return Et(Lr(e),127988,127988)}function io(e){return Et(Lr(e),127995,127999)}function ao(e){return typeof e=="string"&&Et(e.charCodeAt(0),65024,65039)}function oo(e){return typeof e=="string"&&Et(e.charCodeAt(0),8400,8447)}function lo(e){let t=e.codePointAt(0);return typeof e=="string"&&typeof t=="number"&&Et(t,917504,917631)}function uo(e){return typeof e=="string"&&eo.includes(e.charCodeAt(0))}function ho(e){return typeof e=="string"&&e.charCodeAt(0)===8205}function Lr(e){let t=e.charCodeAt(0)-55296,n=e.charCodeAt(1)-56320;return(t<<10)+n+65536}function Et(e,t,n){return e>=t&&e<=n}var Re=(e,t)=>Array.isArray(e)?e?.includes(t):e===t,Qe=(e,t)=>Array.isArray(t)?t.some(n=>e.has(n)):e.has(t),gn=(e,t,n)=>{e.has(t)?e.get(t)?.push(n):e.set(t,[n])},co=(()=>{let e=0;return()=>e++})(),fo={"Joy-Con L+R (STANDARD GAMEPAD Vendor: 057e Product: 200e)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home",17:"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},"Joy-Con (L) (STANDARD GAMEPAD Vendor: 057e Product: 2006)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",9:"select",10:"lstick",16:"start"},sticks:{left:{x:0,y:1}}},"Joy-Con (R) (STANDARD GAMEPAD Vendor: 057e Product: 2007)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",9:"start",10:"lstick",16:"select"},sticks:{left:{x:0,y:1}}},"Pro Controller (STANDARD GAMEPAD Vendor: 057e Product: 2009)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home",17:"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},default:{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}}};function Gs(){let e=h.globalOpt.pixelDensity??1,t=h.globalOpt.width,n=h.globalOpt.height,r=h.gfx.ggl.gl.drawingBufferWidth,s=h.gfx.ggl.gl.drawingBufferHeight,i=r/e,a=s/e,l=0,o=0,u=i,c=a;if(h.globalOpt.letterbox){if(!t||!n)throw new Error("Letterboxing requires width and height defined.");let m=i/a,d=t/n;if(m>d){let p=a*d;l=(i-p)/2,u=p}else{let p=i/d;c=p,o=(a-p)/2}}if(h.globalOpt.stretch&&(!h.globalOpt.width||!h.globalOpt.height))throw new Error("Stretching requires width and height defined.");h.gfx.viewport={x:l,y:o,width:u,height:c,scale:(h.gfx.viewport.width+h.gfx.viewport.height)/(h.gfx.width+h.gfx.height)}}function po(e){return new E(e.x*h.gfx.viewport.width/h.gfx.width,e.y*h.gfx.viewport.height/h.gfx.height)}function et(e){return new E((e.x-h.gfx.viewport.x)*h.gfx.width/h.gfx.viewport.width,(e.y-h.gfx.viewport.y)*h.gfx.height/h.gfx.viewport.height)}var go=()=>mt.lastInputDevice,mo=()=>{let e=mt.buttons;for(let t in e){let n=e[t].keyboard&&[e[t].keyboard].flat(),r=e[t].keyboardCode&&[e[t].keyboardCode].flat(),s=e[t].gamepad&&[e[t].gamepad].flat(),i=e[t].mouse&&[e[t].mouse].flat();n&&n.forEach(a=>{gn(mt.buttonsByKey,a,t)}),r&&r.forEach(a=>{gn(mt.buttonsByKeyCode,a,t)}),s&&s.forEach(a=>{gn(mt.buttonsByGamepad,a,t)}),i&&i.forEach(a=>{gn(mt.buttonsByMouse,a,t)})}},Zt=class{pressed=new Set([]);pressedRepeat=new Set([]);released=new Set([]);down=new Set([]);update(){this.pressed.clear(),this.released.clear(),this.pressedRepeat.clear()}press(e){this.pressed.add(e),this.pressedRepeat.add(e),this.down.add(e)}pressRepeat(e){this.pressedRepeat.add(e)}release(e){this.down.delete(e),this.pressed.delete(e),this.released.add(e)}},yo=class{buttonState=new Zt;stickState=new Map},wo=class{dts=[];timer=0;fps=0;tick(e){this.dts.push(e),this.timer+=e,this.timer>=1&&(this.timer=0,this.fps=Math.round(1/(this.dts.reduce((t,n)=>t+n)/this.dts.length)),this.dts=[])}},mt,ns=fo,Ao=e=>{let t=e.buttons??{};return{canvas:e.canvas,buttons:t,buttonsByKey:new Map,buttonsByMouse:new Map,buttonsByGamepad:new Map,buttonsByKeyCode:new Map,loopID:null,stopped:!1,dt:0,fixedDt:1/50,restDt:0,time:0,realTime:0,fpsCounter:new wo,timeScale:1,skipTime:!1,isHidden:!1,numFrames:0,mousePos:new E(0),mouseDeltaPos:new E(0),keyState:new Zt,mouseState:new Zt,mergedGamepadState:new yo,gamepadStates:new Map,lastInputDevice:null,buttonState:new Zt,gamepads:[],charInputted:[],isMouseMoved:!1,lastWidth:e.canvas.offsetWidth,lastHeight:e.canvas.offsetHeight,events:new en}},vo=e=>{if(!e.canvas)throw new Error("Please provide a canvas");let t=Ao(e);mt=t,mo();function n(){return t.dt*t.timeScale}function r(){return t.fixedDt*t.timeScale}function s(){return t.restDt*t.timeScale}function i(){return t.isHidden}function a(){return t.time}function l(){return t.fpsCounter.fps}function o(){return t.numFrames}function u(){return t.canvas.toDataURL()}function c(g){t.canvas.style.cursor=g}function m(){return t.canvas.style.cursor}function d(g){if(g)try{let S=t.canvas.requestPointerLock();S?.catch&&S.catch(P=>console.error(P))}catch(S){console.error(S)}else document.exitPointerLock()}function p(){return!!document.pointerLockElement}function f(g){g.requestFullscreen?g.requestFullscreen():g.webkitRequestFullscreen&&g.webkitRequestFullscreen()}function v(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullScreen&&document.webkitExitFullScreen()}function y(g=!0){g?f(t.canvas):v()}function w(){return document.fullscreenElement===t.canvas||document.webkitFullscreenElement===t.canvas}function C(){t.stopped=!0;let g=Object.entries(Ce),S=Object.entries(Zn),P=Object.entries(pn);for(let[D,$]of g)t.canvas.removeEventListener(D,$);for(let[D,$]of S)document.removeEventListener(D,$);for(let[D,$]of P)window.removeEventListener(D,$);Zr.disconnect()}function q(g,S){t.loopID!==null&&cancelAnimationFrame(t.loopID);let P=0,D=0,$=ae=>{if(t.stopped)return;if(document.visibilityState!=="visible"){t.loopID=requestAnimationFrame($);return}let De=ae/1e3,Pt=Math.min(De-t.realTime,.25),ke=e.maxFPS?1/e.maxFPS:0;if(t.realTime=De,D+=Pt,D>ke){if(!t.skipTime){for(P+=D,t.dt=t.fixedDt,t.restDt=0;P>t.fixedDt;)P-=t.fixedDt,P<t.fixedDt&&(t.restDt=P),g();t.restDt=P,t.dt=D,t.time+=n(),t.fpsCounter.tick(t.dt)}D=0,t.skipTime=!1,t.numFrames++,S(Hi,ji)}t.loopID=requestAnimationFrame($)};$(0)}function F(){return"ontouchstart"in window||navigator.maxTouchPoints>0}function M(){return t.mousePos.clone()}function A(){return t.mouseDeltaPos.clone()}function b(g="left"){return t.mouseState.pressed.has(g)}function T(g="left"){return t.mouseState.down.has(g)}function I(g="left"){return t.mouseState.released.has(g)}function B(){return t.isMouseMoved}function R(g){return g===void 0?t.keyState.pressed.size>0:Qe(t.keyState.pressed,g)}function H(g){return g===void 0?t.keyState.pressedRepeat.size>0:Qe(t.keyState.pressedRepeat,g)}function V(g){return g===void 0?t.keyState.down.size>0:Qe(t.keyState.down,g)}function X(g){return g===void 0?t.keyState.released.size>0:Qe(t.keyState.released,g)}function Q(g){return g===void 0?t.mergedGamepadState.buttonState.pressed.size>0:Qe(t.mergedGamepadState.buttonState.pressed,g)}function U(g){return g===void 0?t.mergedGamepadState.buttonState.down.size>0:Qe(t.mergedGamepadState.buttonState.down,g)}function j(g){return g===void 0?t.mergedGamepadState.buttonState.released.size>0:Qe(t.mergedGamepadState.buttonState.released,g)}function ie(g){return g===void 0?t.buttonState.pressed.size>0:Qe(t.buttonState.pressed,g)}function J(g){return g===void 0?t.buttonState.down.size>0:Qe(t.buttonState.down,g)}function ee(g){return g===void 0?t.buttonState.released.size>0:Qe(t.buttonState.released,g)}function we(g){return t.buttons?.[g]}function N(g,S){t.buttons[g]={...t.buttons[g],...S}}function ft(g){t.buttonState.press(g),t.events.trigger("buttonPress",g)}function Mt(g){t.buttonState.release(g),t.events.trigger("buttonRelease",g)}function Lt(g){return t.events.on("resize",g)}let ln=se(g=>t.events.on("keyDown",g),(g,S)=>t.events.on("keyDown",P=>Re(g,P)&&S(P))),un=se(g=>t.events.on("keyPress",S=>g(S)),(g,S)=>t.events.on("keyPress",P=>Re(g,P)&&S(P))),Yn=se(g=>t.events.on("keyPressRepeat",g),(g,S)=>t.events.on("keyPressRepeat",P=>Re(g,P)&&S(P))),Vn=se(g=>t.events.on("keyRelease",g),(g,S)=>t.events.on("keyRelease",P=>Re(g,P)&&S(P))),Ct=se(g=>t.events.on("mouseDown",S=>g(S)),(g,S)=>t.events.on("mouseDown",P=>Re(g,P)&&S(P))),Xe=se(g=>t.events.on("mousePress",S=>g(S)),(g,S)=>t.events.on("mousePress",P=>Re(g,P)&&S(P))),dn=se(g=>t.events.on("mouseRelease",S=>g(S)),(g,S)=>t.events.on("mouseRelease",P=>P===g&&S(P)));function O(g){return t.events.on("mouseMove",()=>g(M(),A()))}function G(g){return t.events.on("charInput",g)}function Y(g){return t.events.on("touchStart",g)}function ne(g){return t.events.on("touchMove",g)}function pe(g){return t.events.on("touchEnd",g)}function Z(g){return t.events.on("scroll",g)}function xe(g){return t.events.on("hide",g)}function rt(g){return t.events.on("show",g)}let Xn=se(g=>t.events.on("gamepadButtonPress",(S,P)=>g(S,P)),(g,S)=>t.events.on("gamepadButtonPress",(P,D)=>Re(g,P)&&S(P,D))),Wn=se(g=>t.events.on("gamepadButtonDown",(S,P)=>g(S,P)),(g,S)=>t.events.on("gamepadButtonDown",(P,D)=>Re(g,P)&&S(P,D))),Qn=se(g=>t.events.on("gamepadButtonRelease",(S,P)=>g(S,P)),(g,S)=>t.events.on("gamepadButtonRelease",(P,D)=>Re(g,P)&&S(P,D)));function Jn(g,S){return t.events.on("gamepadStick",(P,D,$)=>P===g&&S(D,$))}function hn(g){t.events.on("gamepadConnect",g)}function We(g){t.events.on("gamepadDisconnect",g)}function st(g){return t.mergedGamepadState.stickState.get(g)||new E(0)}function cn(){return[...t.charInputted]}function Me(){return[...t.gamepads]}let Nt=se(g=>t.events.on("buttonPress",S=>g(S)),(g,S)=>t.events.on("buttonPress",P=>Re(g,P)&&S(P))),_e=se(g=>t.events.on("buttonDown",S=>g(S)),(g,S)=>t.events.on("buttonDown",P=>Re(g,P)&&S(P))),fn=se(g=>t.events.on("buttonRelease",S=>g(S)),(g,S)=>t.events.on("buttonRelease",P=>Re(g,P)&&S(P)));function Hi(){t.events.trigger("input"),t.keyState.down.forEach(g=>t.events.trigger("keyDown",g)),t.mouseState.down.forEach(g=>t.events.trigger("mouseDown",g)),t.buttonState.down.forEach(g=>{t.events.trigger("buttonDown",g)}),Ni()}function ji(){t.keyState.update(),t.mouseState.update(),t.buttonState.update(),t.mergedGamepadState.buttonState.update(),t.mergedGamepadState.stickState.forEach((g,S)=>{t.mergedGamepadState.stickState.set(S,new E(0))}),t.charInputted=[],t.isMouseMoved=!1,t.mouseDeltaPos=new E(0),t.gamepadStates.forEach(g=>{g.buttonState.update(),g.stickState.forEach((S,P)=>{g.stickState.set(P,new E(0))})})}function Xr(g){let S={index:g.index,isPressed:P=>t.gamepadStates.get(g.index)?.buttonState.pressed.has(P)||!1,isDown:P=>t.gamepadStates.get(g.index)?.buttonState.down.has(P)||!1,isReleased:P=>t.gamepadStates.get(g.index)?.buttonState.released.has(P)||!1,getStick:P=>t.gamepadStates.get(g.index)?.stickState.get(P)||x()};return t.gamepads.push(S),t.gamepadStates.set(g.index,{buttonState:new Zt,stickState:new Map([["left",new E(0)],["right",new E(0)]])}),S}function Li(g){t.gamepads=t.gamepads.filter(S=>S.index!==g.index),t.gamepadStates.delete(g.index)}function Ni(){for(let g of navigator.getGamepads())g&&!t.gamepadStates.has(g.index)&&Xr(g);for(let g of t.gamepads){let S=navigator.getGamepads()[g.index];if(!S)continue;let P=(e.gamepads??{})[S.id]||ns[S.id]||ns.default,D=t.gamepadStates.get(g.index);if(D){for(let $=0;$<S.buttons.length;$++){let ae=P.buttons[$],De=S.buttons[$],Pt=t.buttonsByGamepad.has(ae);if(De.pressed){if(D.buttonState.down.has(ae)){t.events.trigger("gamepadButtonDown",ae,g);continue}t.lastInputDevice="gamepad",Pt&&t.buttonsByGamepad.get(ae)?.forEach(ke=>{t.buttonState.press(ke),t.events.trigger("buttonPress",ke)}),t.mergedGamepadState.buttonState.press(ae),D.buttonState.press(ae),t.events.trigger("gamepadButtonPress",ae,g)}else D.buttonState.down.has(ae)&&(Pt&&t.buttonsByGamepad.get(ae)?.forEach(ke=>{t.buttonState.release(ke),t.events.trigger("buttonRelease",ke)}),t.mergedGamepadState.buttonState.release(ae),D.buttonState.release(ae),t.events.trigger("gamepadButtonRelease",ae,g))}for(let $ in P.sticks){let ae=P.sticks[$];if(!ae)continue;let De=new E(S.axes[ae.x],S.axes[ae.y]);D.stickState.set($,De),t.mergedGamepadState.stickState.set($,De),t.events.trigger("gamepadStick",$,De,g)}}}}let Ce={},Zn={},pn={},Wr=e.pixelDensity||1;Ce.mousemove=g=>{let S=et(new E(g.offsetX,g.offsetY)),P=new E(g.movementX,g.movementY);if(w()){let D=t.canvas.width/Wr,$=t.canvas.height/Wr,ae=window.innerWidth,De=window.innerHeight,Pt=ae/De,ke=D/$;if(Pt>ke){let pt=De/$,$n=(ae-D*pt)/2;S.x=Je(g.offsetX-$n,0,D*pt,0,D),S.y=Je(g.offsetY,0,$*pt,0,$)}else{let pt=ae/D,$n=(De-$*pt)/2;S.x=Je(g.offsetX,0,D*pt,0,D),S.y=Je(g.offsetY-$n,0,$*pt,0,$)}}t.events.onOnce("input",()=>{t.isMouseMoved=!0,t.mousePos=S,t.mouseDeltaPos=P,t.events.trigger("mouseMove")})};let Qr=["left","middle","right","back","forward"];Ce.mousedown=g=>{t.events.onOnce("input",()=>{let S=Qr[g.button];S&&(t.lastInputDevice="mouse",t.buttonsByMouse.has(S)&&t.buttonsByMouse.get(S)?.forEach(P=>{t.buttonState.press(P),t.events.trigger("buttonPress",P)}),t.mouseState.press(S),t.events.trigger("mousePress",S))})},Ce.mouseup=g=>{t.events.onOnce("input",()=>{let S=Qr[g.button];S&&(t.buttonsByMouse.has(S)&&t.buttonsByMouse.get(S)?.forEach(P=>{t.buttonState.release(P),t.events.trigger("buttonRelease",P)}),t.mouseState.release(S),t.events.trigger("mouseRelease",S))})};let Ui=new Set([" ","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Tab"]),Jr={ArrowLeft:"left",ArrowRight:"right",ArrowUp:"up",ArrowDown:"down"," ":"space"};Ce.keydown=g=>{Ui.has(g.key)&&g.preventDefault(),t.events.onOnce("input",()=>{let S=Jr[g.key]||g.key.toLowerCase(),P=g.code;if(S===void 0)throw new Error(`Unknown key: ${g.key}`);S.length===1?(t.events.trigger("charInput",S),t.charInputted.push(S)):S==="space"&&(t.events.trigger("charInput"," "),t.charInputted.push(" ")),g.repeat?(t.keyState.pressRepeat(S),t.events.trigger("keyPressRepeat",S)):(t.lastInputDevice="keyboard",t.buttonsByKey.has(S)&&t.buttonsByKey.get(S)?.forEach(D=>{t.buttonState.press(D),t.events.trigger("buttonPress",D)}),t.buttonsByKeyCode.has(P)&&t.buttonsByKeyCode.get(P)?.forEach(D=>{t.buttonState.press(D),t.events.trigger("buttonPress",D)}),t.keyState.press(S),t.events.trigger("keyPressRepeat",S),t.events.trigger("keyPress",S))})},Ce.keyup=g=>{t.events.onOnce("input",()=>{let S=Jr[g.key]||g.key.toLowerCase(),P=g.code;t.buttonsByKey.has(S)&&t.buttonsByKey.get(S)?.forEach(D=>{t.buttonState.release(D),t.events.trigger("buttonRelease",D)}),t.buttonsByKeyCode.has(P)&&t.buttonsByKeyCode.get(P)?.forEach(D=>{t.buttonState.release(D),t.events.trigger("buttonRelease",D)}),t.keyState.release(S),t.events.trigger("keyRelease",S)})},Ce.touchstart=g=>{g.preventDefault(),t.events.onOnce("input",()=>{let S=[...g.changedTouches],P=t.canvas.getBoundingClientRect();e.touchToMouse!==!1&&(t.mousePos=et(new E(S[0].clientX-P.x,S[0].clientY-P.y)),t.lastInputDevice="mouse",t.buttonsByMouse.has("left")&&t.buttonsByMouse.get("left")?.forEach(D=>{t.buttonState.press(D),t.events.trigger("buttonPress",D)}),t.mouseState.press("left"),t.events.trigger("mousePress","left")),S.forEach(D=>{t.events.trigger("touchStart",et(new E(D.clientX-P.x,D.clientY-P.y)),D)})})},Ce.touchmove=g=>{g.preventDefault(),t.events.onOnce("input",()=>{let S=[...g.changedTouches],P=t.canvas.getBoundingClientRect();if(e.touchToMouse!==!1){let D=t.mousePos;t.mousePos=et(new E(S[0].clientX-P.x,S[0].clientY-P.y)),t.mouseDeltaPos=t.mousePos.sub(D),t.events.trigger("mouseMove")}S.forEach(D=>{t.events.trigger("touchMove",et(new E(D.clientX-P.x,D.clientY-P.y)),D)})})},Ce.touchend=g=>{t.events.onOnce("input",()=>{let S=[...g.changedTouches],P=t.canvas.getBoundingClientRect();e.touchToMouse!==!1&&(t.mousePos=et(new E(S[0].clientX-P.x,S[0].clientY-P.y)),t.mouseDeltaPos=new E(0,0),t.buttonsByMouse.has("left")&&t.buttonsByMouse.get("left")?.forEach(D=>{t.buttonState.release(D),t.events.trigger("buttonRelease",D)}),t.mouseState.release("left"),t.events.trigger("mouseRelease","left")),S.forEach(D=>{t.events.trigger("touchEnd",et(new E(D.clientX-P.x,D.clientY-P.y)),D)})})},Ce.touchcancel=g=>{t.events.onOnce("input",()=>{let S=[...g.changedTouches],P=t.canvas.getBoundingClientRect();e.touchToMouse!==!1&&(t.mousePos=et(new E(S[0].clientX-P.x,S[0].clientY-P.y)),t.mouseState.release("left"),t.events.trigger("mouseRelease","left")),S.forEach(D=>{t.events.trigger("touchEnd",et(new E(D.clientX-P.x,D.clientY-P.y)),D)})})},Ce.wheel=g=>{g.preventDefault(),t.events.onOnce("input",()=>{t.events.trigger("scroll",new E(g.deltaX,g.deltaY))})},Ce.contextmenu=g=>g.preventDefault(),Zn.visibilitychange=()=>{document.visibilityState==="visible"?(t.skipTime=!0,t.isHidden=!1,t.events.trigger("show")):(t.isHidden=!0,t.events.trigger("hide"))},pn.gamepadconnected=g=>{let S=Xr(g.gamepad);t.events.onOnce("input",()=>{t.events.trigger("gamepadConnect",S)})},pn.gamepaddisconnected=g=>{let S=Me().filter(P=>P.index===g.gamepad.index)[0];Li(g.gamepad),t.events.onOnce("input",()=>{t.events.trigger("gamepadDisconnect",S)})};for(let[g,S]of Object.entries(Ce))t.canvas.addEventListener(g,S);for(let[g,S]of Object.entries(Zn))document.addEventListener(g,S);for(let[g,S]of Object.entries(pn))window.addEventListener(g,S);let Zr=new ResizeObserver(g=>{for(let S of g)if(S.target===t.canvas){if(t.lastWidth===t.canvas.offsetWidth&&t.lastHeight===t.canvas.offsetHeight)return;t.lastWidth=t.canvas.offsetWidth,t.lastHeight=t.canvas.offsetHeight,t.events.onOnce("input",()=>{t.events.trigger("resize")})}});return Zr.observe(t.canvas),{state:t,dt:n,fixedDt:r,restDt:s,time:a,run:q,canvas:t.canvas,fps:l,numFrames:o,quit:C,isHidden:i,setFullscreen:y,isFullscreen:w,setCursor:c,screenshot:u,getGamepads:Me,getCursor:m,setCursorLocked:d,isCursorLocked:p,isTouchscreen:F,mousePos:M,mouseDeltaPos:A,isKeyDown:V,isKeyPressed:R,isKeyPressedRepeat:H,isKeyReleased:X,isMouseDown:T,isMousePressed:b,isMouseReleased:I,isMouseMoved:B,isGamepadButtonPressed:Q,isGamepadButtonDown:U,isGamepadButtonReleased:j,getGamepadStick:st,isButtonPressed:ie,isButtonDown:J,isButtonReleased:ee,setButton:N,getButton:we,pressButton:ft,releaseButton:Mt,charInputted:cn,onResize:Lt,onKeyDown:ln,onKeyPress:un,onKeyPressRepeat:Yn,onKeyRelease:Vn,onMouseDown:Ct,onMousePress:Xe,onMouseRelease:dn,onMouseMove:O,onCharInput:G,onTouchStart:Y,onTouchMove:ne,onTouchEnd:pe,onScroll:Z,onHide:xe,onShow:rt,onGamepadButtonDown:Wn,onGamepadButtonPress:Xn,onGamepadButtonRelease:Qn,onGamepadStick:Jn,onGamepadConnect:hn,onGamepadDisconnect:We,onButtonPress:Nt,onButtonDown:_e,onButtonRelease:fn,getLastInputDeviceType:go,events:t.events}};function ye(){return h.app.dt()}function mr(){return h.app.fixedDt()}function yr(){return h.app.restDt()}var bo=new E(-1,-1),xo=new E(0,-1),So=new E(1,-1),Eo=new E(-1,0),Mo=new E(0,0),Co=new E(1,0),Po=new E(-1,1),To=new E(0,1),qo=new E(1,1);function Ot(e){switch(e){case"topleft":return bo;case"top":return xo;case"topright":return So;case"left":return Eo;case"center":return Mo;case"right":return Co;case"botleft":return Po;case"bot":return To;case"botright":return qo;default:return e}}function Io(e){switch(e){case"left":return 0;case"center":return .5;case"right":return 1;default:return 0}}function Bo(e){return e.createBuffer(1,1,44100)}var mn=2.5949095,rs=1.70158+1,ss=2*Math.PI/3,is=2*Math.PI/4.5,En={linear:e=>e,easeInSine:e=>1-Math.cos(e*Math.PI/2),easeOutSine:e=>Math.sin(e*Math.PI/2),easeInOutSine:e=>-(Math.cos(Math.PI*e)-1)/2,easeInQuad:e=>e*e,easeOutQuad:e=>1-(1-e)*(1-e),easeInOutQuad:e=>e<.5?2*e*e:1-Math.pow(-2*e+2,2)/2,easeInCubic:e=>e*e*e,easeOutCubic:e=>1-Math.pow(1-e,3),easeInOutCubic:e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2,easeInQuart:e=>e*e*e*e,easeOutQuart:e=>1-Math.pow(1-e,4),easeInOutQuart:e=>e<.5?8*e*e*e*e:1-Math.pow(-2*e+2,4)/2,easeInQuint:e=>e*e*e*e*e,easeOutQuint:e=>1-Math.pow(1-e,5),easeInOutQuint:e=>e<.5?16*e*e*e*e*e:1-Math.pow(-2*e+2,5)/2,easeInExpo:e=>e===0?0:Math.pow(2,10*e-10),easeOutExpo:e=>e===1?1:1-Math.pow(2,-10*e),easeInOutExpo:e=>e===0?0:e===1?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2,easeInCirc:e=>1-Math.sqrt(1-Math.pow(e,2)),easeOutCirc:e=>Math.sqrt(1-Math.pow(e-1,2)),easeInOutCirc:e=>e<.5?(1-Math.sqrt(1-Math.pow(2*e,2)))/2:(Math.sqrt(1-Math.pow(-2*e+2,2))+1)/2,easeInBack:e=>rs*e*e*e-1.70158*e*e,easeOutBack:e=>1+rs*Math.pow(e-1,3)+1.70158*Math.pow(e-1,2),easeInOutBack:e=>e<.5?Math.pow(2*e,2)*((mn+1)*2*e-mn)/2:(Math.pow(2*e-2,2)*((mn+1)*(e*2-2)+mn)+2)/2,easeInElastic:e=>e===0?0:e===1?1:-Math.pow(2,10*e-10)*Math.sin((e*10-10.75)*ss),easeOutElastic:e=>e===0?0:e===1?1:Math.pow(2,-10*e)*Math.sin((e*10-.75)*ss)+1,easeInOutElastic:e=>e===0?0:e===1?1:e<.5?-(Math.pow(2,20*e-10)*Math.sin((20*e-11.125)*is))/2:Math.pow(2,-20*e+10)*Math.sin((20*e-11.125)*is)/2+1,easeInBounce:e=>1-En.easeOutBounce(1-e),easeOutBounce:e=>e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375,easeInOutBounce:e=>e<.5?(1-En.easeOutBounce(1-2*e))/2:(1+En.easeOutBounce(2*e-1))/2},tn=En;function Do(e,t,n){let r=[],s=t;for(r.push(s);s!==e;){if(s=n.get(s),s==null)return null;r.push(s)}return r.reverse()}function Ro(e,t,n){let r=new Ls((a,l)=>a.cost<l.cost);r.insert({cost:0,node:t});let s=new Map;s.set(t,t);let i=new Map;for(i.set(t,0);r.length!==0;){let a=r.remove()?.node;if(a===n)break;let l=e.getNeighbours(a);for(let o of l){let u=(i.get(a)||0)+e.getCost(a,o)+e.getHeuristic(o,n);(!i.has(o)||u<i.get(o))&&(i.set(o,u),r.insert({cost:u,node:o}),s.set(o,a))}}return Do(t,n,s)}var Fo=class{a;b;polygon;constructor(e,t,n){this.a=e,this.b=t,this.polygon=new WeakRef(n)}isLeft(e,t){return(this.b.x-this.a.x)*(t-this.a.y)-(e-this.a.x)*(this.b.y-this.a.y)}get middle(){return this.a.add(this.b).scale(.5)}},Oo=class{_edges;_centroid;_id;constructor(e){this._id=e}get id(){return this._id}set edges(e){this._edges=e;let t=0,n=0,r=0;for(let s of this._edges){s.polygon=new WeakRef(this);let i=s.a.x*s.b.y-s.a.y*s.b.x;t+=(s.a.x+s.b.x)*i,n+=(s.a.y+s.b.y)*i,r+=i}r/=2,this._centroid=x(t/(6*r),n/(6*r))}get edges(){return this._edges}get centroid(){return this._centroid}contains(e){let t=!1;for(let n of this.edges)n.b.y>e.y!=n.a.y>e.y&&e.x<(n.a.x-n.b.x)*(e.y-n.b.y)/(n.a.y-n.b.y)+n.b.x&&(t=!t);return t}},Ho=class{_polygons;_pointCache;_edgeCache;constructor(){this._polygons=[],this._pointCache={},this._edgeCache={}}_addPoint(e){let t=this._pointCache[`${e.x}_${e.y}`];return t||(t=e.clone(),this._pointCache[`${e.x}_${e.y}`]=t,t)}_addEdge(e){let t=`${e.a.x}_${e.a.y}-${e.b.x}_${e.b.y}`;return this._edgeCache[t]=e,e}_findEdge(e,t){let n=`${e.x}_${e.y}-${t.x}_${t.y}`;return this._edgeCache[n]}_findCommonEdge(e,t){for(let n of e.edges){let r=this._findEdge(n.b,n.a);if(r&&r.polygon.deref().id===t.id)return r}return null}addPolygon(e){let t=new Oo(this._polygons.length),n=e.map((r,s)=>new Fo(r,e[(s+1)%e.length],t));t.edges=n,this._polygons.push(t);for(let r of t.edges)this._addEdge(r);return t}addRect(e,t){let n=this._addPoint(e),r=this._addPoint(e.add(t.x,0)),s=this._addPoint(e.add(t)),i=this._addPoint(e.add(0,t.y));return this.addPolygon([n,r,s,i])}_getLocation(e){for(let t of this._polygons)if(t.contains(e))return t;return null}getNeighbours(e){let t=[];for(let n of this._polygons[e].edges){let r=this._findEdge(n.b,n.a);if(r){let s=r.polygon.deref();s&&t.push(s.id)}}return t}getCost(e,t){return 1}getHeuristic(e,t){let n=this._polygons[e],r=this._polygons[t],s=n.centroid.x-r.centroid.x,i=n.centroid.y-r.centroid.y;return Math.sqrt(s*s+i*i)}getPath(e,t){return e===void 0||t===void 0?[]:e===t?[e,t]:Ro(this,e,t)}getWaypointPath(e,t,n){let r=n?.type||"centroids",s=this._getLocation(e),i=this._getLocation(t);if(s===void 0||i===void 0)return[];let a=this.getPath(s.id,i.id);if(!a)return[];if(r==="edges"){let l=[];for(let o=1;o<a.length;o++){let u=this._polygons[a[o-1]],c=this._polygons[a[o]],m=this._findCommonEdge(u,c);l.push(m.middle.add(c.centroid.sub(m.middle).unit().scale(4)))}return[e,...l,t]}else return[e,...a.slice(1,-1).map(l=>this._polygons[l].centroid),t]}};function $t(e){let t=new $e;return e.pos&&t.translate(e.pos),e.scale&&t.scale(e.scale),e.angle&&t.rotate(e.angle),e.parent?t.mult(e.parent.transform):t}function jo(e){return new E(e.x/Ae()*2-1,-e.y/ve()*2+1)}function Wt(e,t,n,r,s,i=1){r=ce(r%360),s=ce(s%360),s<=r&&(s+=Math.PI*2);let a=[],l=Math.ceil((s-r)/ce(8)*i),o=(s-r)/l,u=x(Math.cos(r),Math.sin(r)),c=x(Math.cos(o),Math.sin(o));for(let m=0;m<=l;m++)a.push(e.add(t*u.x,n*u.y)),u=x(u.x*c.x-u.y*c.y,u.x*c.y+u.y*c.x);return a}function Lo(...e){let t=_(...e),n=e[3]??1;h.gfx.bgColor=t,h.gfx.bgAlpha=n,h.gfx.ggl.gl.clearColor(t.r/255,t.g/255,t.b/255,n)}function No(){return h.gfx.bgColor?.clone?.()??null}function ue(...e){if(e[0]===void 0)return;let t=x(...e);t.x===0&&t.y===0||h.gfx.transform.translate(t)}function Fe(){h.gfx.transformStack.push(h.gfx.transform.clone())}function Uo(e){h.gfx.transform=e.clone()}function nn(...e){if(e[0]===void 0)return;let t=x(...e);t.x===1&&t.y===1||h.gfx.transform.scale(t)}function Rt(e){e&&h.gfx.transform.rotate(e)}function Pe(){h.gfx.transformStack.length>0&&(h.gfx.transform=h.gfx.transformStack.pop())}function Oe(){h.gfx.renderer.flush()}function Ae(){return h.gfx.width}function ve(){return h.gfx.height}function Ks(){return(h.gfx.viewport.width+h.gfx.viewport.height)/(h.gfx.width+h.gfx.height)}function Dn(){return x(Ae()/2,ve()/2)}var Go=class{lastTextureId=0;textures=[];bigTextures=[];texturesPosition=new Map;canvas;c2d;x=0;y=0;curHeight=0;gfx;padding;constructor(e,t,n,r){this.gfx=e,this.canvas=document.createElement("canvas"),this.canvas.width=t,this.canvas.height=n,this.textures=[ut.fromImage(e,this.canvas)],this.bigTextures=[],this.padding=r;let s=this.canvas.getContext("2d");if(!s)throw new Error("Failed to get 2d context");this.c2d=s}addSingle(e){let t=ut.fromImage(this.gfx,e);return this.bigTextures.push(t),[t,new oe(0,0,1,1),0]}add(e){let t=e.width+this.padding*2,n=e.height+this.padding*2;if(t>this.canvas.width||n>this.canvas.height)return this.addSingle(e);this.x+t>this.canvas.width&&(this.x=0,this.y+=this.curHeight,this.curHeight=0),this.y+n>this.canvas.height&&(this.c2d.clearRect(0,0,this.canvas.width,this.canvas.height),this.textures.push(ut.fromImage(this.gfx,this.canvas)),this.x=0,this.y=0,this.curHeight=0);let r=this.textures[this.textures.length-1],s=new E(this.x+this.padding,this.y+this.padding);return this.x+=t,n>this.curHeight&&(this.curHeight=n),e instanceof ImageData?this.c2d.putImageData(e,s.x,s.y):this.c2d.drawImage(e,s.x,s.y),r.update(this.canvas),this.texturesPosition.set(this.lastTextureId,{position:s,size:new E(e.width,e.height),texture:r}),this.lastTextureId++,[r,new oe(s.x/this.canvas.width,s.y/this.canvas.height,e.width/this.canvas.width,e.height/this.canvas.height),this.lastTextureId-1]}free(){for(let e of this.textures)e.free();for(let e of this.bigTextures)e.free()}};function je(e){return typeof e!="string"||Us(e)?e:h.assets.urlPrefix+e}var Le=class zs{loaded=!1;data=null;error=null;onLoadEvents=new Se;onErrorEvents=new Se;onFinishEvents=new Se;constructor(t){t.then(n=>{this.loaded=!0,this.data=n,this.onLoadEvents.trigger(n)}).catch(n=>{if(this.error=n,this.onErrorEvents.numListeners()>0)this.onErrorEvents.trigger(n);else throw n}).finally(()=>{this.onFinishEvents.trigger(),this.loaded=!0})}static loaded(t){let n=new zs(Promise.resolve(t));return n.data=t,n.loaded=!0,n}onLoad(t){return this.loaded&&this.data?t(this.data):this.onLoadEvents.add(t),this}onError(t){return this.loaded&&this.error?t(this.error):this.onErrorEvents.add(t),this}onFinish(t){return this.loaded?t():this.onFinishEvents.add(t),this}then(t){return this.onLoad(t)}catch(t){return this.onError(t)}finally(t){return this.onFinish(t)}},Tt=class{assets=new Map;lastUID=0;add(e,t){let n=e??this.lastUID+++"",r=new Le(t);return this.assets.set(n,r),r}addLoaded(e,t){let n=e??this.lastUID+++"",r=Le.loaded(t);return this.assets.set(n,r),r}get(e){return this.assets.get(e)}progress(){if(this.assets.size===0)return 1;let e=0;return this.assets.forEach(t=>{t.loaded&&e++}),e/this.assets.size}getFailedAssets(){return Array.from(this.assets.keys()).filter(e=>this.assets.get(e).error!==null).map(e=>[e,this.assets.get(e)])}};function Nr(e){return fetch(e).then(t=>{if(!t.ok)throw new Error(`Failed to fetch "${e}"`);return t})}function Gn(e){return Nr(e).then(t=>t.json())}function Ko(e){return Nr(e).then(t=>t.text())}function zo(e){return Nr(e).then(t=>t.arrayBuffer())}function Yo(e){return e!==void 0&&(h.assets.urlPrefix=e),h.assets.urlPrefix}function Vo(e,t){return h.assets.custom.add(e,Gn(je(t)))}function Kn(e){let t=new Image;return t.crossOrigin="anonymous",t.src=e,new Promise((n,r)=>{t.onload=()=>n(t),t.onerror=()=>r(new Error(`Failed to load image from "${e}"`))})}function At(){let e=[h.assets.sprites,h.assets.sounds,h.assets.shaders,h.assets.fonts,h.assets.bitmapFonts,h.assets.custom];return e.reduce((t,n)=>t+n.progress(),0)/e.length}function Ys(){return[h.assets.sprites,h.assets.sounds,h.assets.shaders,h.assets.fonts,h.assets.bitmapFonts,h.assets.custom].reduce((e,t)=>e.concat(t.getFailedAssets()),[])}function Xo(e){return h.assets.custom.get(e)??null}function wr(e){return h.assets.custom.add(null,e)}var Wo=(e,t)=>({urlPrefix:"",sprites:new Tt,fonts:new Tt,bitmapFonts:new Tt,sounds:new Tt,shaders:new Tt,custom:new Tt,music:{},packer:new Go(e,2048,2048,t),loaded:!1}),Qo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAA1CAYAAADyMeOEAAAAAXNSR0IArs4c6QAAAoVJREFUaIHdm7txwkAQhheGAqACiCHzOKQDQrqgILpwSAeEDBnEUAF0gCMxZ7G72qce/mec2Lpf9+3unaS78wgSNZ8uX5729+d1FNWXUuGmXlBOUUEIMckEpeQJgBu6C+BSFngztBR2vd+ovY+7g+p6LbgaWgJrAeUkDYIUXgXdBBwNi6kpABJwMTQH3AZsXRR8GHTfgEth8E3gjdAUcNewpbTgY85sCMCUuOokozE0YM0YRzM9NGAAXd8+omAF5h4lnmBRvpSnZHyLoLEbaN+aKB9KWv/KWw0tAbbANnlG+UvB2dm77NxxdwgBpjrF/d7rW9cbmpvio2A5z8iAYpVU8pGZlo6/2+MSco2lHfd3rv9jAP038e1xef9o2mjvYb2OqpqKE81028/jeietlSEVO5FRWsxWsJit1G3aFpW8iWe5RwpiCZAk25QvV6nz6fIlynRGuTd5WqpJ4guAlDfVKBK87hXljflgv1ON6fV+4+5gVlA17SfeG0heKqQd4l4jI/wrmaA9N9R4ar+wpHJDZyrrfcH0nB66PqAzPi76pn+faSyJk/vzOorYhGurQrzj/P68jtBMawHaHBIR9xoD5O34dy0qQOSYHvqExq2TpT2nf76+w7y251OYF0CRaU+J920TwLUa6inx6OxE6g80lu2ux7Y2eJLF/rCXE6zEPdnenk9o+4ih9AEdnW2q81HXl5LuU6OTl2fXUhqganbXAGq3g6jJOWV/OnoesO6YqqEB/GdNsjf7uHtwj2DzmRNpp7iOZfm6D9oAxB6Yi1gC4oIYeo4MIPdopEQRB+cAko5J1tW386HpB2Kz1eop4Epdwls/kgZ1sh8gZsEjdcWkr//D8Qu3Z3l5Nl1NtAAAAABJRU5ErkJggg==",ht=class Qt{tex;frames=[new oe(0,0,1,1)];anims={};slice9=null;constructor(t,n,r={},s=null){this.tex=t,n&&(this.frames=n),this.anims=r,this.slice9=s}get width(){return this.tex.width*this.frames[0].w}get height(){return this.tex.height*this.frames[0].h}static from(t,n={}){return typeof t=="string"?Qt.fromURL(t,n):Promise.resolve(Qt.fromImage(t,n))}static fromImage(t,n={}){let[r,s]=n.singular?h.assets.packer.addSingle(t):h.assets.packer.add(t),i=n.frames?n.frames.map(a=>new oe(s.x+a.x*s.w,s.y+a.y*s.h,a.w*s.w,a.h*s.h)):Xs(n.sliceX||1,n.sliceY||1,s.x,s.y,s.w,s.h);return new Qt(r,i,n.anims,n.slice9)}static fromURL(t,n={}){return Kn(t).then(r=>Qt.fromImage(r,n))}};function Mn(e){if(typeof e=="string"){let t=Vs(e);if(t)return t;if(At()<1)return null;throw new Error(`Sprite not found: ${e}`)}else{if(e instanceof ht)return Le.loaded(e);if(e instanceof Le)return e;throw new Error(`Invalid sprite: ${e}`)}}function Vs(e){return h.assets.sprites.get(e)??null}function _t(e,t,n={sliceX:1,sliceY:1,anims:{}}){return t=je(t),Array.isArray(t)?t.some(r=>typeof r=="string")?h.assets.sprites.add(e,Promise.all(t.map(r=>typeof r=="string"?Kn(r):Promise.resolve(r))).then(r=>as(r,n))):h.assets.sprites.addLoaded(e,as(t,n)):typeof t=="string"?h.assets.sprites.add(e,ht.from(t,n)):h.assets.sprites.addLoaded(e,ht.fromImage(t,n))}function Xs(e=1,t=1,n=0,r=0,s=1,i=1){let a=[],l=s/e,o=i/t;for(let u=0;u<t;u++)for(let c=0;c<e;c++)a.push(new oe(n+c*l,r+u*o,l,o));return a}function as(e,t={}){let n=document.createElement("canvas"),r=e[0].width,s=e[0].height;n.width=r*e.length,n.height=s;let i=n.getContext("2d");if(!i)throw new Error("Failed to create canvas context");e.forEach((l,o)=>{l instanceof ImageData?i.putImageData(l,o*r,0):i.drawImage(l,o*r,0)});let a=i.getImageData(0,0,e.length*r,s);return ht.fromImage(a,{...t,sliceX:e.length,sliceY:1})}function Jo(e="bean"){return _t(e,Qo)}function Zo(e,t,n){t=je(t),n=je(n),typeof t=="string"&&!n&&(n=$a(t)+".json");let r=typeof n=="string"?Gn(n):Promise.resolve(n);return h.assets.sprites.add(e,r.then(s=>{let i=s.meta.size,a=s.frames.map(o=>new oe(o.frame.x/i.w,o.frame.y/i.h,o.frame.w/i.w,o.frame.h/i.h)),l={};for(let o of s.meta.frameTags)o.from===o.to?l[o.name]=o.from:l[o.name]={from:o.from,to:o.to,speed:10,loop:!0,pingpong:o.direction==="pingpong"};return ht.from(t,{frames:a,anims:l})}))}var Cn=class{fontface;filter=cr;outline=null;size=64;constructor(e,t={}){if(this.fontface=e,this.filter=t.filter??cr,this.size=t.size??64,this.size>256)throw new Error("Max font size: 256");t.outline&&(this.outline={width:1,color:_(0,0,0)},typeof t.outline=="number"?this.outline.width=t.outline:typeof t.outline=="object"&&(t.outline.width&&(this.outline.width=t.outline.width),t.outline.color&&(this.outline.color=t.outline.color)))}};function Ws(e){if(!e)return Ws(h.globalOpt.font??Oa);if(typeof e=="string"){let t=Js(e),n=Qs(e);if(t)return t.data??t;if(n)return n.data??n;if(document.fonts.check(`64px ${e}`))return e;if(At()<1)return null;throw new Error(`Font not found: ${e}`)}else if(e instanceof Le)return e.data?e.data:e;return e}function Qs(e){return h.assets.fonts.get(e)??null}function $o(e,t,n={}){let r=je(t),s=new FontFace(e,typeof t=="string"?`url(${r})`:r);return document.fonts.add(s),h.assets.fonts.add(e,s.load().catch(i=>{throw new Error(`Failed to load font from "${r}": ${i}`)}).then(i=>new Cn(i,n)))}function _o(e,t,n,r){let s=e.width/t,i={},a=r.split("").entries();for(let[l,o]of a)i[o]=new oe(l%s*t,Math.floor(l/s)*n,t,n);return{tex:e,map:i,size:n}}function Js(e){return h.assets.bitmapFonts.get(e)??null}function ko(e,t,n,r,s={}){let i=je(t);return h.assets.bitmapFonts.add(e,Kn(i).then(a=>_o(ut.fromImage(h.gfx.ggl,a,s),n,r,s.chars??Rs)))}function el(e,t){return t=je(t),h.assets.sprites.add(e,new Promise(async n=>{let r=typeof t=="string"?await Gn(t):t,s=await Promise.all(r.frames.map(Kn)),i=document.createElement("canvas");i.width=r.width,i.height=r.height*r.frames.length;let a=i.getContext("2d");if(!a)throw new Error("Failed to create canvas context");s.forEach((o,u)=>{a.drawImage(o,0,u*r.height)});let l=await _t(null,i,{sliceY:r.frames.length,anims:r.anims});n(l)}))}var tl=class{ctx;glProgram;constructor(e,t,n,r){this.ctx=e,e.onDestroy(()=>this.free());let s=e.gl,i=s.createShader(s.VERTEX_SHADER),a=s.createShader(s.FRAGMENT_SHADER);if(!i||!a)throw new Error("Failed to create shader");s.shaderSource(i,t),s.shaderSource(a,n),s.compileShader(i),s.compileShader(a);let l=s.createProgram();if(this.glProgram=l,s.attachShader(l,i),s.attachShader(l,a),r.forEach((o,u)=>s.bindAttribLocation(l,u,o)),s.linkProgram(l),!s.getProgramParameter(l,s.LINK_STATUS)){let o=s.getShaderInfoLog(i);if(o)throw new Error("VERTEX SHADER "+o);let u=s.getShaderInfoLog(a);if(u)throw new Error("FRAGMENT SHADER "+u)}s.deleteShader(i),s.deleteShader(a)}bind(){this.ctx.pushProgram(this.glProgram)}unbind(){this.ctx.popProgram()}send(e){let t=this.ctx.gl;for(let n in e){let r=e[n],s=t.getUniformLocation(this.glProgram,n);if(typeof r=="number")t.uniform1f(s,r);else if(r instanceof $e)t.uniformMatrix4fv(s,!1,new Float32Array(r.m));else if(r instanceof W)t.uniform3f(s,r.r,r.g,r.b);else if(r instanceof E)t.uniform2f(s,r.x,r.y);else if(Array.isArray(r))r[0],Wa(r)?t.uniform1fv(s,r):Xa(r)?t.uniform2fv(s,r.map(i=>[i.x,i.y]).flat()):Va(r)&&t.uniform3fv(s,r.map(i=>[i.r,i.g,i.b]).flat());else throw new Error("Unsupported uniform data type")}}free(){this.ctx.gl.deleteProgram(this.glProgram)}};function Ur(e,t=fr,n=pr){let r=Na.replace("{{user}}",t??fr),s=Ua.replace("{{user}}",n??pr);try{return new tl(e,r,s,Or.map(i=>i.name))}catch(i){let a=/(?<type>^\w+) SHADER ERROR: 0:(?<line>\d+): (?<msg>.+)/,l=_a(i).match(a);if(!l?.groups)throw i;let o=Number(l.groups.line)-14,u=l.groups.msg.trim(),c=l.groups.type.toLowerCase();throw new Error(`${c} shader line ${o}: ${u}`)}}function nl(e){if(!e)return h.gfx.defShader;if(typeof e=="string"){let t=Zs(e);if(t)return t.data??t;if(At()<1)return null;throw new Error(`Shader not found: ${e}`)}else if(e instanceof Le)return e.data?e.data:e;return e}function Zs(e){return h.assets.shaders.get(e)??null}function rl(e,t,n){return h.assets.shaders.addLoaded(e,Ur(h.gfx.ggl,t,n))}function sl(e,t,n){t=je(t),n=je(n);let r=i=>i?Ko(i):Promise.resolve(null),s=Promise.all([r(t),r(n)]).then(([i,a])=>Ur(h.gfx.ggl,i,a));return h.assets.shaders.add(e,s)}var rn=class Pn{buf;constructor(t){this.buf=t}static fromArrayBuffer(t){return new Promise((n,r)=>h.audio.ctx.decodeAudioData(t,n,r)).then(n=>new Pn(n))}static fromURL(t){return Us(t)?Pn.fromArrayBuffer(Ja(t)):zo(t).then(n=>Pn.fromArrayBuffer(n))}};function il(e){if(typeof e=="string"){let t=$s(e);if(t)return t;if(At()<1)return null;throw new Error(`Sound not found: ${e}`)}else{if(e instanceof rn)return Le.loaded(e);if(e instanceof Le)return e;throw new Error(`Invalid sound: ${e}`)}}function $s(e){return h.assets.sounds.get(e)??null}function al(e,t){return t=je(t),h.assets.sounds.add(e,typeof t=="string"?rn.fromURL(t):rn.fromArrayBuffer(t))}function ol(e,t){let n=je(t),r=new Audio(n);return r.preload="auto",h.assets.music[e]=n}function _s(e,t){return e=je(e),wr(typeof t=="string"?new Promise((n,r)=>{Gn(t).then(s=>{_s(e,s).then(n).catch(r)})}):ht.from(e).then(n=>{let r={};for(let s in t){let i=t[s],a=n.frames[0],l=2048*a.w,o=2048*a.h,u=i.frames?i.frames.map(m=>new oe(a.x+(i.x+m.x)/l*a.w,a.y+(i.y+m.y)/o*a.h,m.w/l*a.w,m.h/o*a.h)):Xs(i.sliceX||1,i.sliceY||1,a.x+i.x/l*a.w,a.y+i.y/o*a.h,i.width/l*a.w,i.height/o*a.h),c=new ht(n.tex,u,i.anims);h.assets.sprites.addLoaded(s,c),r[s]=c}return r}))}function ct(e,t,n=!1,r,s,i={}){let a=r??h.gfx.defTex,l=s??h.gfx.defShader,o=nl(l);if(!o||o instanceof Le)return;let u=h.gfx.fixed||n?h.gfx.transform:h.game.cam.transform.mult(h.gfx.transform),c=[];for(let m of e){let d=jo(u.multVec2(m.pos));c.push(d.x,d.y,m.uv.x,m.uv.y,m.color.r/255,m.color.g/255,m.color.b/255,m.opacity)}h.gfx.renderer.push(h.gfx.ggl.gl.TRIANGLES,c,t,o,a,i)}function lt(e){if(!e.pts)throw new Error('drawPolygon() requires property "pts".');let t=e.pts.length;if(!(t<3)){if(Fe(),ue(e.pos),nn(e.scale),Rt(e.angle),ue(e.offset),e.fill!==!1){let n=e.color??W.WHITE,r=e.pts.map((i,a)=>({pos:new E(i.x,i.y),uv:e.uv?e.uv[a]:new E(0,0),color:e.colors&&e.colors[a]?e.colors[a].mult(n):n,opacity:e.opacity??1})),s;e.triangulate?s=Ds(e.pts).map(i=>i.map(a=>e.pts.indexOf(a))).flat():s=[...Array(t-2).keys()].map(i=>[0,i+1,i+2]).flat(),ct(r,e.indices??s,e.fixed,e.uv?e.tex:h.gfx.defTex,e.shader,e.uniform??void 0)}e.outline&&Gr({pts:[...e.pts,e.pts[0]],radius:e.radius,width:e.outline.width,color:e.outline.color,join:e.outline.join,uniform:e.uniform,fixed:e.fixed,opacity:e.opacity??e.outline.opacity}),Pe()}}function ks(e){if(e.radiusX===void 0||e.radiusY===void 0)throw new Error('drawEllipse() requires properties "radiusX" and "radiusY".');if(e.radiusX===0||e.radiusY===0)return;let t=e.start??0,n=e.end??360,r=Ot(e.anchor??"center").scale(new E(-e.radiusX,-e.radiusY)),s=Wt(r,e.radiusX,e.radiusY,t,n,e.resolution);s.unshift(r);let i=Object.assign({},e,{pts:s,radius:0,...e.gradient?{colors:[e.gradient[0],...Array(s.length-1).fill(e.gradient[1])]}:{}});if(n-t>=360&&e.outline){e.fill!==!1&&lt(Object.assign({},i,{outline:null})),lt(Object.assign({},i,{pts:s.slice(1),fill:!1}));return}lt(i)}function Ht(e){if(typeof e.radius!="number")throw new Error('drawCircle() requires property "radius".');e.radius!==0&&ks(Object.assign({},e,{radiusX:e.radius,radiusY:e.radius,angle:0}))}function Jt(e){let{p1:t,p2:n}=e;if(!t||!n)throw new Error('drawLine() requires properties "p1" and "p2".');let r=e.width||1,s=n.sub(t).unit().normal().scale(r*.5),i=[t.sub(s),t.add(s),n.add(s),n.sub(s)].map(a=>({pos:new E(a.x,a.y),uv:new E(0),color:e.color??W.WHITE,opacity:e.opacity??1}));ct(i,[0,1,3,1,2,3],e.fixed,h.gfx.defTex,e.shader,e.uniform??void 0)}function ll(e){let t=e.pts,n=[],r=(e.width||1)*.5,s=t[0]===t[t.length-1]||t[0].eq(t[t.length-1]),i=e.pos||x(0,0),a;s?a=t[0].sub(t[t.length-2]):a=t[1].sub(t[0]);let l=a.len(),o=a.normal().scale(-r/l),u,c=t[0];if(!s)switch(e.cap){case"square":{let f=a.scale(-r/l);n.push(c.add(f).add(o)),n.push(c.add(f).sub(o));break}case"round":{let f=Math.max(r,10),v=Math.PI/f,y=o.scale(-1),w=Math.cos(v),C=Math.sin(v);for(let q=0;q<f;q++)n.push(c),n.push(c.sub(y)),y=x(y.x*w-y.y*C,y.x*C+y.y*w)}}for(let f=1;f<t.length;f++){if(c===t[f]||c.eq(t[f]))continue;u=c,c=t[f];let v=c.sub(u),y=v.len(),w=v.normal().scale(-r/y),C=a.cross(v);if(Math.abs(C)/(l*y)<.05){n.push(u.add(o)),n.push(u.sub(o)),a.dot(v)<0&&(n.push(u.sub(o)),n.push(u.add(o))),a=v,l=y,o=w;continue}let q=w.sub(o).cross(v)/C,F=o.add(a.scale(q));C>0?(n.push(u.add(F)),n.push(u.sub(o)),n.push(u.add(F)),n.push(u.sub(w))):(n.push(u.add(o)),n.push(u.sub(F)),n.push(u.add(w)),n.push(u.sub(F))),a=v,l=y,o=w}if(!s)switch(n.push(c.add(o)),n.push(c.sub(o)),e.cap){case"square":{let f=a.scale(r/l);n.push(c.add(f).add(o)),n.push(c.add(f).sub(o));break}case"round":{let f=Math.max(r,10),v=Math.PI/f,y=o.scale(1),w=Math.cos(v),C=Math.sin(v);for(let q=0;q<f;q++)y=x(y.x*w-y.y*C,y.x*C+y.y*w),n.push(c),n.push(c.sub(y))}}if(n.length<4)return;let m=n.map(f=>({pos:i.add(f),uv:x(),color:e.color||W.WHITE,opacity:e.opacity??1})),d=[],p=0;for(let f=0;f<n.length-2;f+=2)d[p++]=f+1,d[p++]=f,d[p++]=f+2,d[p++]=f+2,d[p++]=f+3,d[p++]=f+1;s&&(d[p++]=n.length-1,d[p++]=n.length-2,d[p++]=0,d[p++]=0,d[p++]=1,d[p++]=n.length-1),ct(m,d,e.fixed,h.gfx.defTex,e.shader,e.uniform??void 0)}function ul(e){let t=e.pts,n=[],r=(e.width||1)*.5,s=t[0]===t[t.length-1]||t[0].eq(t[t.length-1]),i=e.pos||x(0,0),a;s?a=t[0].sub(t[t.length-2]):a=t[1].sub(t[0]);let l=a.len(),o=a.normal().scale(-r/l),u,c=t[0];if(!s)switch(e.cap){case"square":{let f=a.scale(-r/l);n.push(c.add(f).add(o)),n.push(c.add(f).sub(o));break}case"round":{let f=Math.max(r,10),v=Math.PI/f,y=o.scale(-1),w=Math.cos(v),C=Math.sin(v);for(let q=0;q<f;q++)n.push(c),n.push(c.sub(y)),y=x(y.x*w-y.y*C,y.x*C+y.y*w)}}for(let f=1;f<t.length;f++){if(c===t[f]||c.eq(t[f]))continue;u=c,c=t[f];let v=c.sub(u),y=v.len(),w=v.normal().scale(-r/y),C=a.cross(v);if(Math.abs(C)/(l*y)<.05){n.push(u.add(o)),n.push(u.sub(o)),a.dot(v)<0&&(n.push(u.sub(o)),n.push(u.add(o))),a=v,l=y,o=w;continue}let q=w.sub(o).cross(v)/C,F=o.add(a.scale(q));if(C>0){let M=u.add(F),A=Math.max(r,10),b=ce(o.angleBetween(w)/A),T=o,I=Math.cos(b),B=Math.sin(b);for(let R=0;R<A;R++)n.push(M),n.push(u.sub(T)),T=x(T.x*I-T.y*B,T.x*B+T.y*I)}else{let M=u.sub(F),A=Math.max(r,10),b=ce(o.angleBetween(w)/A),T=o,I=Math.cos(b),B=Math.sin(b);for(let R=0;R<A;R++)n.push(u.add(T)),n.push(M),T=x(T.x*I-T.y*B,T.x*B+T.y*I)}a=v,l=y,o=w}if(!s)switch(n.push(c.add(o)),n.push(c.sub(o)),e.cap){case"square":{let f=a.scale(r/l);n.push(c.add(f).add(o)),n.push(c.add(f).sub(o));break}case"round":{let f=Math.max(r,10),v=Math.PI/f,y=o.scale(1),w=Math.cos(v),C=Math.sin(v);for(let q=0;q<f;q++)y=x(y.x*w-y.y*C,y.x*C+y.y*w),n.push(c),n.push(c.sub(y))}}if(n.length<4)return;let m=n.map(f=>({pos:i.add(f),uv:x(),color:e.color||W.WHITE,opacity:e.opacity??1})),d=[],p=0;for(let f=0;f<n.length-2;f+=2)d[p++]=f+1,d[p++]=f,d[p++]=f+2,d[p++]=f+2,d[p++]=f+3,d[p++]=f+1;s&&(d[p++]=n.length-1,d[p++]=n.length-2,d[p++]=0,d[p++]=0,d[p++]=1,d[p++]=n.length-1),ct(m,d,e.fixed,h.gfx.defTex,e.shader,e.uniform??void 0)}function dl(e){let t=e.pts,n=[],r=(e.width||1)*.5,s=t[0]===t[t.length-1]||t[0].eq(t[t.length-1]),i=e.pos||x(0,0),a;s?a=t[0].sub(t[t.length-2]):a=t[1].sub(t[0]);let l=a.len(),o=a.normal().scale(-r/l),u,c=t[0];if(!s)switch(e.cap){case"square":{let f=a.scale(-r/l);n.push(c.add(f).add(o)),n.push(c.add(f).sub(o));break}case"round":{let f=Math.max(r,10),v=Math.PI/f,y=o.scale(-1),w=Math.cos(v),C=Math.sin(v);for(let q=0;q<f;q++)n.push(c),n.push(c.sub(y)),y=x(y.x*w-y.y*C,y.x*C+y.y*w)}}for(let f=1;f<t.length;f++){if(c===t[f]||c.eq(t[f]))continue;u=c,c=t[f];let v=c.sub(u),y=v.len(),w=v.normal().scale(-r/y),C=a.cross(v);if(Math.abs(C)/(l*y)<.05){n.push(u.add(o)),n.push(u.sub(o)),a.dot(v)<0&&(n.push(u.sub(o)),n.push(u.add(o))),a=v,l=y,o=w;continue}let q=w.sub(o).cross(v)/C,F=o.add(a.scale(q));n.push(u.add(F)),n.push(u.sub(F)),a=v,l=y,o=w}if(!s)switch(n.push(c.add(o)),n.push(c.sub(o)),e.cap){case"square":{let f=a.scale(r/l);n.push(c.add(f).add(o)),n.push(c.add(f).sub(o));break}case"round":{let f=Math.max(r,10),v=Math.PI/f,y=o.scale(1),w=Math.cos(v),C=Math.sin(v);for(let q=0;q<f;q++)y=x(y.x*w-y.y*C,y.x*C+y.y*w),n.push(c),n.push(c.sub(y))}}if(n.length<4)return;let m=n.map(f=>({pos:i.add(f),uv:x(),color:e.color||W.WHITE,opacity:e.opacity??1})),d=[],p=0;for(let f=0;f<n.length-2;f+=2)d[p++]=f+1,d[p++]=f,d[p++]=f+2,d[p++]=f+2,d[p++]=f+3,d[p++]=f+1;s&&(d[p++]=n.length-1,d[p++]=n.length-2,d[p++]=0,d[p++]=0,d[p++]=1,d[p++]=n.length-1),ct(m,d,e.fixed,h.gfx.defTex,e.shader,e.uniform??void 0)}function Gr(e){let t=e.pts,n=e.width??1;if(!t)throw new Error('drawLines() requires property "pts".');if(!(t.length<2)){if(t.length>2)switch(e.join){case"bevel":return ll(e);case"round":return ul(e);case"miter":return dl(e)}if(e.radius&&t.length>=3){Jt(Object.assign({},e,{p1:t[0],p2:t[1]}));for(let r=1;r<t.length-2;r++){let s=t[r],i=t[r+1];Jt(Object.assign({},e,{p1:s,p2:i}))}Jt(Object.assign({},e,{p1:t[t.length-2],p2:t[t.length-1]}))}else for(let r=0;r<t.length-1;r++)Jt(Object.assign({},e,{p1:t[r],p2:t[r+1]})),e.join!=="none"&&Ht(Object.assign({},e,{pos:t[r],radius:n/2}))}}function ei(e,t){let n=t.segments??16,r=[];for(let s=0;s<=n;s++)r.push(e(s/n));Gr({pts:r,width:t.width||1,pos:t.pos,color:t.color,opacity:t.opacity})}function hl(e){ei(t=>Fr(e.pt1,e.pt2,e.pt3,e.pt4,t),e)}var ut=class ti{ctx;src=null;glTex;width;height;constructor(t,n,r,s={}){this.ctx=t;let i=t.gl,a=t.gl.createTexture();if(!a)throw new Error("Failed to create texture");this.glTex=a,t.onDestroy(()=>this.free()),this.width=n,this.height=r;let l={linear:i.LINEAR,nearest:i.NEAREST}[s.filter??t.opts.texFilter??"nearest"],o={repeat:i.REPEAT,clampToEdge:i.CLAMP_TO_EDGE}[s.wrap??"clampToEdge"];this.bind(),n&&r&&i.texImage2D(i.TEXTURE_2D,0,i.RGBA,n,r,0,i.RGBA,i.UNSIGNED_BYTE,null),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,l),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,l),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,o),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,o),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),this.unbind()}static fromImage(t,n,r={}){let s=new ti(t,n.width,n.height,r);return s.update(n),s.src=n,s}update(t,n=0,r=0){let s=this.ctx.gl;this.bind(),s.texSubImage2D(s.TEXTURE_2D,0,n,r,s.RGBA,s.UNSIGNED_BYTE,t),this.unbind()}bind(){this.ctx.pushTexture2D(this.glTex)}unbind(){this.ctx.popTexture2D()}free(){this.ctx.gl.deleteTexture(this.glTex)}},Rn=class{ctx;tex;glFramebuffer;glRenderbuffer;constructor(e,t,n,r={}){this.ctx=e;let s=e.gl;e.onDestroy(()=>this.free()),this.tex=new ut(e,t,n,r);let i=s.createFramebuffer(),a=s.createRenderbuffer();if(!i||!a)throw new Error("Failed to create framebuffer");this.glFramebuffer=i,this.glRenderbuffer=a,this.bind(),s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_STENCIL,t,n),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,this.tex.glTex,0),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,this.glRenderbuffer),this.unbind()}get width(){return this.tex.width}get height(){return this.tex.height}toImageData(){let e=this.ctx.gl,t=new Uint8ClampedArray(this.width*this.height*4);this.bind(),e.readPixels(0,0,this.width,this.height,e.RGBA,e.UNSIGNED_BYTE,t),this.unbind();let n=this.width*4,r=new Uint8Array(n);for(let s=0;s<(this.height/2|0);s++){let i=s*n,a=(this.height-s-1)*n;r.set(t.subarray(i,i+n)),t.copyWithin(i,a,a+n),t.set(r,a)}return new ImageData(t,this.width,this.height)}toDataURL(){let e=document.createElement("canvas"),t=e.getContext("2d");if(e.width=this.width,e.height=this.height,!t)throw new Error("Failed to get 2d context");return t.putImageData(this.toImageData(),0,0),e.toDataURL()}clear(){let e=this.ctx.gl;e.clear(e.COLOR_BUFFER_BIT)}draw(e){this.bind(),e(),this.unbind()}bind(){this.ctx.pushFramebuffer(this.glFramebuffer),this.ctx.pushRenderbuffer(this.glRenderbuffer),this.ctx.pushViewport({x:0,y:0,w:this.width,h:this.height})}unbind(){this.ctx.popFramebuffer(),this.ctx.popRenderbuffer(),this.ctx.popViewport()}free(){let e=this.ctx.gl;e.deleteFramebuffer(this.glFramebuffer),e.deleteRenderbuffer(this.glRenderbuffer),this.tex.free()}},cl=class{ctx;glVBuf;glIBuf;vqueue=[];iqueue=[];stride;maxVertices;maxIndices;vertexFormat;numDraws=0;curPrimitive=null;curTex=null;curShader=null;curUniform={};constructor(e,t,n,r){let s=e.gl;this.vertexFormat=t,this.ctx=e,this.stride=t.reduce((a,l)=>a+l.size,0),this.maxVertices=n,this.maxIndices=r;let i=s.createBuffer();if(!i)throw new Error("Failed to create vertex buffer");this.glVBuf=i,e.pushArrayBuffer(this.glVBuf),s.bufferData(s.ARRAY_BUFFER,n*4,s.DYNAMIC_DRAW),e.popArrayBuffer(),this.glIBuf=s.createBuffer(),e.pushElementArrayBuffer(this.glIBuf),s.bufferData(s.ELEMENT_ARRAY_BUFFER,r*4,s.DYNAMIC_DRAW),e.popElementArrayBuffer()}push(e,t,n,r,s=null,i={}){(e!==this.curPrimitive||s!==this.curTex||r!==this.curShader||!jr(this.curUniform,i)||this.vqueue.length+t.length*this.stride>this.maxVertices||this.iqueue.length+n.length>this.maxIndices)&&this.flush();let a=this.vqueue.length/this.stride;for(let l of t)this.vqueue.push(l);for(let l of n)this.iqueue.push(l+a);this.curPrimitive=e,this.curShader=r,this.curTex=s,this.curUniform=i}flush(){if(!this.curPrimitive||!this.curShader||this.vqueue.length===0||this.iqueue.length===0)return;let e=this.ctx.gl;this.ctx.pushArrayBuffer(this.glVBuf),e.bufferSubData(e.ARRAY_BUFFER,0,new Float32Array(this.vqueue)),this.ctx.pushElementArrayBuffer(this.glIBuf),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,new Uint16Array(this.iqueue)),this.ctx.setVertexFormat(this.vertexFormat),this.curShader.bind(),this.curShader.send(this.curUniform),this.curTex?.bind(),e.drawElements(this.curPrimitive,this.iqueue.length,e.UNSIGNED_SHORT,0),this.curTex?.unbind(),this.curShader.unbind(),this.ctx.popArrayBuffer(),this.ctx.popElementArrayBuffer(),this.vqueue=[],this.iqueue=[],this.numDraws++}free(){let e=this.ctx.gl;e.deleteBuffer(this.glVBuf),e.deleteBuffer(this.glIBuf)}};function gt(e){let t=[],n=i=>{t.push(i),e(i)},r=()=>{t.pop(),e(s()??null)},s=()=>t[t.length-1];return[n,r,s]}function fl(e,t={}){let n=[];function r(M){n.push(M)}function s(){n.forEach(A=>A());let M=e.getExtension("WEBGL_lose_context");M&&M.loseContext()}let i=null;function a(M){if(jr(M,i))return;i=M;let A=M.reduce((b,T)=>b+T.size,0);M.reduce((b,T,I)=>(e.vertexAttribPointer(I,T.size,e.FLOAT,!1,A*4,b),e.enableVertexAttribArray(I),b+T.size*4),0)}let[l,o]=gt(M=>e.bindTexture(e.TEXTURE_2D,M)),[u,c]=gt(M=>e.bindBuffer(e.ARRAY_BUFFER,M)),[m,d]=gt(M=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,M)),[p,f]=gt(M=>e.bindFramebuffer(e.FRAMEBUFFER,M)),[v,y]=gt(M=>e.bindRenderbuffer(e.RENDERBUFFER,M)),[w,C]=gt(M=>{if(!M)return;let{x:A,y:b,w:T,h:I}=M;e.viewport(A,b,T,I)}),[q,F]=gt(M=>e.useProgram(M));return w({x:0,y:0,w:e.drawingBufferWidth,h:e.drawingBufferHeight}),{gl:e,opts:t,onDestroy:r,destroy:s,pushTexture2D:l,popTexture2D:o,pushArrayBuffer:u,popArrayBuffer:c,pushElementArrayBuffer:m,popElementArrayBuffer:d,pushFramebuffer:p,popFramebuffer:f,pushRenderbuffer:v,popRenderbuffer:y,pushViewport:w,popViewport:C,pushProgram:q,popProgram:F,setVertexFormat:a}}var er={};function os(e,t){if(t.override){Object.assign(e,t);return}t.pos&&(e.pos=e.pos.add(t.pos)),t.scale&&(e.scale=e.scale.scale(x(t.scale))),t.angle&&(e.angle+=t.angle),t.color&&e.ch.length===1&&(e.color=e.color.mult(t.color)),t.opacity!=null&&(e.opacity*=t.opacity)}function Ar(e){let t={},n="",r=[],s=String(e),i=a=>{r.length>0&&(t[n.length]=r.slice()),n+=a};for(;s!=="";){if(s[0]==="\\"){if(s.length===1)throw new Error("Styled text error: \\ at end of string");i(s[1]),s=s.slice(2);continue}if(s[0]==="["){let a=/^\[(\/)?(\w+?)\]/.exec(s);if(!a){i(s[0]),s=s.slice(1);continue}let[l,o,u]=a;if(o!==void 0){let c=r.pop();if(c!==u)throw c!==void 0?new Error(`Styled text error: mismatched tags. Expected [/${c}], got [/${u}]`):new Error(`Styled text error: stray end tag [/${u}]`)}else r.push(u);s=s.slice(l.length);continue}i(s[0]),s=s.slice(1)}if(r.length>0)throw new Error(`Styled text error: unclosed tags ${r}`);return{charStyleMap:t,text:n}}function vt(e){if(e.text===void 0)throw new Error('formatText() requires property "text".');let t=Ws(e.font);if(!e.text||e.text===""||t instanceof Le||!t)return{width:0,height:0,chars:[],opt:e,renderedText:""};let{charStyleMap:n,text:r}=Ar(e.text+""),s=to(r);if(t instanceof Cn||typeof t=="string"){let q=t instanceof Cn?t.fontface.family:t,F=t instanceof Cn?{outline:t.outline,filter:t.filter}:{outline:null,filter:cr},M=er[q]??{font:{tex:new ut(h.gfx.ggl,2048,2048,{filter:F.filter}),map:{},size:64},cursor:new E(0),maxHeight:0,outline:F.outline};er[q]||(er[q]=M),t=M.font;for(let A of s)if(!M.font.map[A]){let b=h.fontCacheC2d;if(!b)throw new Error("fontCacheC2d is not defined.");if(!h.fontCacheCanvas)throw new Error("fontCacheCanvas is not defined.");b.clearRect(0,0,h.fontCacheCanvas.width,h.fontCacheCanvas.height),b.font=`${t.size}px ${q}`,b.textBaseline="top",b.textAlign="left",b.fillStyle="#ffffff";let T=b.measureText(A),I=Math.ceil(T.width);if(!I)continue;let B=Math.ceil(Math.abs(T.actualBoundingBoxAscent))+Math.ceil(Math.abs(T.actualBoundingBoxDescent));M.outline&&M.outline.width&&M.outline.color&&(b.lineJoin="round",b.lineWidth=M.outline.width*2,b.strokeStyle=M.outline.color.toHex(),b.strokeText(A,M.outline.width,M.outline.width),I+=M.outline.width*2,B+=M.outline.width*3),b.fillText(A,M.outline?.width??0,M.outline?.width??0);let R=b.getImageData(0,0,I,B);if(M.cursor.x+I>2048&&(M.cursor.x=0,M.cursor.y+=M.maxHeight,M.maxHeight=0,M.cursor.y>2048))throw new Error("Font atlas exceeds character limit");t.tex.update(R,M.cursor.x,M.cursor.y),t.map[A]=new oe(M.cursor.x,M.cursor.y,I,B),M.cursor.x+=I+1,M.maxHeight=Math.max(M.maxHeight,B)}}let i=e.size||t.size,a=x(e.scale??1).scale(i/t.size),l=e.lineSpacing??0,o=e.letterSpacing??0,u=0,c=0,m=0,d=[],p=[],f=0,v=null,y=0,w;for(;f<s.length;){let q=s[f];if(q===`
`)m+=i+l,d.push({width:u-o,chars:p}),v=null,y=0,u=0,p=[],w=void 0;else{let F=t.map[q];if(F){let M=F.w*a.x;e.width&&u+M>e.width&&(m+=i+l,v!=null&&(f-=p.length-v,q=s[f],F=t.map[q],M=F.w*a.x,p=p.slice(0,v-1),u=y),v=null,y=0,d.push({width:u-o,chars:p}),u=w??0,p=[]),p.push({tex:t.tex,width:F.w,height:F.h,quad:new oe(F.x/t.tex.width,F.y/t.tex.height,F.w/t.tex.width,F.h/t.tex.height),ch:q,pos:new E(u,m),opacity:e.opacity??1,color:e.color??W.WHITE,scale:x(a),angle:0}),q===" "&&(v=p.length,y=u),e.indentAll&&w===void 0&&/\S/.test(q)&&(w=u),u+=M,c=Math.max(c,u),u+=o}}f++}d.push({width:u-o,chars:p}),m+=i,e.width&&(c=e.width);let C=[];for(let q=0;q<d.length;q++){let F=(c-d[q].width)*Io(e.align??"left");for(let M of d[q].chars){let A=t.map[M.ch],b=C.length+q;if(M.pos=M.pos.add(F,0).add(A.w*a.x*.5,A.h*a.y*.5),e.transform){let T=typeof e.transform=="function"?e.transform(b,M.ch):e.transform;T&&os(M,T)}if(n[b]){let T=n[b];for(let I of T){let B=e.styles?.[I],R=typeof B=="function"?B(b,M.ch):B;R&&os(M,R)}}C.push(M)}}return{width:c,height:m,chars:C,opt:e,renderedText:r}}function sn(e){if(e.width===void 0||e.height===void 0)throw new Error('drawUVQuad() requires property "width" and "height".');if(e.width<=0||e.height<=0)return;let t=e.width,n=e.height,r=Ot(e.anchor||Un).scale(new E(t,n).scale(-.5)),s=e.quad||new oe(0,0,1,1),i=e.color||_(255,255,255),a=e.opacity??1,l=e.tex?.1/e.tex.width:0,o=e.tex?.1/e.tex.height:0,u=s.x+l,c=s.y+o,m=s.w-l*2,d=s.h-o*2;Fe(),ue(e.pos),Rt(e.angle),nn(e.scale),ue(r),ct([{pos:new E(-t/2,n/2),uv:new E(e.flipX?u+m:u,e.flipY?c:c+d),color:i,opacity:a},{pos:new E(-t/2,-n/2),uv:new E(e.flipX?u+m:u,e.flipY?c+d:c),color:i,opacity:a},{pos:new E(t/2,-n/2),uv:new E(e.flipX?u:u+m,e.flipY?c+d:c),color:i,opacity:a},{pos:new E(t/2,n/2),uv:new E(e.flipX?u:u+m,e.flipY?c:c+d),color:i,opacity:a}],[0,1,3,1,2,3],e.fixed,e.tex,e.shader,e.uniform??void 0),Pe()}function bt(e){Fe(),ue(e.opt.pos),Rt(e.opt.angle),ue(Ot(e.opt.anchor??"topleft").add(1,1).scale(e.width,e.height).scale(-.5)),e.chars.forEach(t=>{sn({tex:t.tex,width:t.width,height:t.height,pos:t.pos,scale:t.scale,angle:t.angle,color:t.color,opacity:t.opacity,quad:t.quad,anchor:"center",uniform:e.opt.uniform,shader:e.opt.shader,fixed:e.opt.fixed})}),Pe()}function He(e){if(e.width===void 0||e.height===void 0)throw new Error('drawRect() requires property "width" and "height".');if(e.width<=0||e.height<=0)return;let t=e.width,n=e.height,r=Ot(e.anchor||Un).add(1,1).scale(new E(t,n).scale(-.5)),s=[new E(0,0),new E(t,0),new E(t,n),new E(0,n)];if(e.radius){let i=Math.min(t,n)/2,a=Array.isArray(e.radius)?e.radius.map(l=>Math.min(i,l)):new Array(4).fill(Math.min(i,e.radius));s=[new E(a[0],0),...a[1]?Wt(new E(t-a[1],a[1]),a[1],a[1],270,360):[x(t,0)],...a[2]?Wt(new E(t-a[2],n-a[2]),a[2],a[2],0,90):[x(t,n)],...a[3]?Wt(new E(a[3],n-a[3]),a[3],a[3],90,180):[x(0,n)],...a[0]?Wt(new E(a[0],a[0]),a[0],a[0],180,270):[]]}lt(Object.assign({},e,{offset:r,pts:s,...e.gradient?{colors:e.horizontal?[e.gradient[0],e.gradient[1],e.gradient[1],e.gradient[0]]:[e.gradient[0],e.gradient[0],e.gradient[1],e.gradient[1]]}:{}}))}function ot(e){Oe();let t=h.gfx.width,n=h.gfx.height;h.gfx.width=h.gfx.viewport.width,h.gfx.height=h.gfx.viewport.height,e(),Oe(),h.gfx.width=t,h.gfx.height=n}function ls(e,t){ot(()=>{let n=x(8);Fe(),ue(e);let r=vt({text:t,font:Bn,size:16,pos:n,color:_(255,255,255),fixed:!0}),s=r.width+n.x*2,i=r.height+n.x*2;e.x+s>=Ae()&&ue(x(-s,0)),e.y+i>=ve()&&ue(x(0,-i)),He({width:s,height:i,color:_(0,0,0),radius:4,opacity:.8,fixed:!0}),bt(r),Pe()})}function ni(e){if(!e.p1||!e.p2||!e.p3)throw new Error('drawTriangle() requires properties "p1", "p2" and "p3".');return lt(Object.assign({},e,{pts:[e.p1,e.p2,e.p3]}))}function pl(){if(h.debug.inspect){let e=null;for(let t of h.game.root.get("*",{recursive:!0}))if(t.has("area")&&t.isHovering()){e=t;break}if(h.game.root.drawInspect(),e){let t=[],n=e.inspect();for(let r in n)n[r]?t.push(`${n[r]}`):t.push(`${r}`);ls(po(h.k.mousePos()),t.join(`
`))}ls(x(8),`FPS: ${h.debug.fps()}`)}h.debug.paused&&ot(()=>{Fe(),ue(Ae(),0),ue(-8,8);let e=32;He({width:e,height:e,anchor:"topright",color:_(0,0,0),opacity:.8,radius:4,fixed:!0});for(let t=1;t<=2;t++)He({width:4,height:e*.6,anchor:"center",pos:x(-e/3*t,e*.5),color:_(255,255,255),radius:2,fixed:!0});Pe()}),h.debug.timeScale!==1&&ot(()=>{Fe(),ue(Ae(),ve()),ue(-8,-8);let e=8,t=vt({text:h.debug.timeScale.toFixed(1),font:Bn,size:16,color:_(255,255,255),pos:x(-e),anchor:"botright",fixed:!0});He({width:t.width+e*2+e*4,height:t.height+e*2,anchor:"botright",color:_(0,0,0),opacity:.8,radius:4,fixed:!0});for(let n=0;n<2;n++){let r=h.debug.timeScale<1;ni({p1:x(-t.width-e*(r?2:3.5),-e),p2:x(-t.width-e*(r?2:3.5),-e-t.height),p3:x(-t.width-e*(r?3.5:2),-e-t.height/2),pos:x(-n*e*1+(r?-e*.5:0),0),color:_(255,255,255),fixed:!0})}bt(t),Pe()}),h.debug.curRecording&&ot(()=>{Fe(),ue(0,ve()),ue(24,-24),Ht({radius:12,color:_(255,0,0),opacity:ms(0,1,h.app.time()*4),fixed:!0}),Pe()}),h.debug.showLog&&h.game.logs.length>0&&ot(()=>{Fe(),ue(0,ve()),ue(8,-8);let e=8,t=[];for(let r of h.game.logs){let s="",i=r.msg instanceof Error?"error":"info";s+=`[time]${r.time.toFixed(2)}[/time]`,s+=" ",s+=`[${i}]${vr(r.msg)}[/${i}]`,t.push(s)}h.game.logs=h.game.logs.filter(r=>h.app.time()-r.time<(h.globalOpt.logTime||4));let n=vt({text:t.join(`
`),font:Bn,pos:x(e,-e),anchor:"botleft",size:16,width:Ae()*.6,lineSpacing:e/2,fixed:!0,styles:{time:{color:_(127,127,127)},info:{color:_(255,255,255)},error:{color:_(255,0,127)}}});He({width:n.width+e*2,height:n.height+e*2,anchor:"botleft",color:_(0,0,0),radius:4,opacity:.8,fixed:!0}),bt(n),Pe()})}function vr(e,t=!1,n=new Set){if(n.has(e))return"<recursive>";var r="",s;return t&&typeof e=="string"&&(e=JSON.stringify(e)),Array.isArray(e)&&(r=["[",e.map(i=>vr(i,!0,n.union(new Set([e])))).join(", "),"]"].join(""),e=r),e===null?"null":(typeof e=="object"&&e.toString===Object.prototype.toString&&(e.constructor!==Object&&(r+=e.constructor.name+" "),r+=["{",(s=Object.getOwnPropertyNames(e).map(i=>`${/^\w+$/.test(i)?i:JSON.stringify(i)}: ${vr(e[i],!0,n.union(new Set([e])))}`).join(", "))?` ${s} `:"","}"].join(""),e=r),String(e).replaceAll(new RegExp("(?<!\\\\)\\[","g"),"\\["))}function gl(){let e=h.game.cam,t=E.fromAngle(me(0,360)).scale(e.shake);e.shake=Te(e.shake,0,5*ye()),e.transform=new $e().translate(Dn()).scale(e.scale).rotate(e.angle).translate((e.pos??Dn()).scale(-1).add(t)),h.game.root.draw(),Oe()}function ml(){let e=At();h.game.events.numListeners("loading")>0?h.game.events.trigger("loading",e):ot(()=>{let t=Ae()/2,n=24,r=x(Ae()/2,ve()/2).sub(x(t/2,n/2));He({pos:x(0),width:Ae(),height:ve(),color:_(0,0,0)}),He({pos:r,width:t,height:n,fill:!1,outline:{width:4}}),He({pos:r,width:t*e,height:n})})}function ri(e,t,n){let r=h.gfx.ggl.gl;Oe(),r.clear(r.STENCIL_BUFFER_BIT),r.enable(r.STENCIL_TEST),r.stencilFunc(r.NEVER,1,255),r.stencilOp(r.REPLACE,r.REPLACE,r.REPLACE),t(),Oe(),r.stencilFunc(n,1,255),r.stencilOp(r.KEEP,r.KEEP,r.KEEP),e(),Oe(),r.disable(r.STENCIL_TEST)}function yl(e,t){let n=h.gfx.ggl.gl;ri(e,t,n.EQUAL)}function Fn(e){if(!e.tex)throw new Error('drawTexture() requires property "tex".');let t=e.quad??new oe(0,0,1,1),n=e.tex.width*t.w,r=e.tex.height*t.h,s=new E(1);if(e.tiled){let i=Ot(e.anchor||Un);(e.pos?.x||0)-(i.x+1)*.5*(e.width||n),(e.pos?.y||0)-(i.y+1)*.5*(e.height||r);let a=(e.width||n)/n,l=(e.height||r)/r,o=Math.floor(a),u=Math.floor(l),c=a-o,m=l-u,d=(o+c?1:0)*(u+m?1:0),p=new Array(d*6),f=new Array(d*4),v=0,y=(w,C,q,F,M)=>{p[v*6+0]=v*4+0,p[v*6+1]=v*4+1,p[v*6+2]=v*4+3,p[v*6+3]=v*4+1,p[v*6+4]=v*4+2,p[v*6+5]=v*4+3,f[v*4+0]={pos:new E(w-i.x,C-i.y),uv:new E(M.x,M.y),color:e.color||W.WHITE,opacity:e.opacity||1},f[v*4+1]={pos:new E(w+q-i.x,C-i.y),uv:new E(M.x+M.w,M.y),color:e.color||W.WHITE,opacity:e.opacity||1},f[v*4+2]={pos:new E(w+q-i.x,C+F-i.y),uv:new E(M.x+M.w,M.y+M.h),color:e.color||W.WHITE,opacity:e.opacity||1},f[v*4+3]={pos:new E(w-i.x,C+F-i.y),uv:new E(M.x,M.y+M.h),color:e.color||W.WHITE,opacity:e.opacity||1},v++};for(let w=0;w<u;w++){for(let C=0;C<o;C++)y(C*n,w*r,n,r,t);c&&y(o*n,w*r,n*c,r,new oe(t.x,t.y,t.w*c,t.h))}if(m){for(let w=0;w<o;w++)y(w*n,u*r,n,r*m,new oe(t.x,t.y,t.w,t.h*m));c&&y(o*n,u*r,n*c,r*m,new oe(t.x,t.y,t.w*c,t.h*m))}ct(f,p,e.fixed,e.tex,e.shader,e.uniform??void 0)}else e.width&&e.height?(s.x=e.width/n,s.y=e.height/r):e.width?(s.x=e.width/n,s.y=s.x):e.height&&(s.y=e.height/r,s.x=s.y),sn(Object.assign({},e,{scale:s.scale(e.scale||new E(1)),tex:e.tex,quad:t,width:n,height:r}))}function wl(e){if(!e.sprite)throw new Error('drawSprite() requires property "sprite"');let t=Mn(e.sprite);if(!t||!t.data)return;let n=t.data.frames[e.frame??0];if(!n)throw new Error(`Frame not found: ${e.frame??0}`);Fn(Object.assign({},e,{tex:t.data.tex,quad:n.scale(e.quad??new oe(0,0,1,1))}))}function Al(e,t){let n=h.gfx.ggl.gl;ri(e,t,n.NOTEQUAL)}function us(e){bt(vt(e))}var vl=(e,t)=>{let n=Ur(t,fr,pr),r=e.pixelDensity??1,s=e.scale??1,{gl:i}=t,a=ut.fromImage(t,new ImageData(new Uint8ClampedArray([255,255,255,255]),1,1)),l=e.width&&e.height?new Rn(t,e.width*r*s,e.height*r*s):new Rn(t,i.drawingBufferWidth,i.drawingBufferHeight),o=null,u=1;e.background&&(typeof e.background=="string"?o=_(e.background):(o=_(...e.background),u=e.background[3]??1),i.clearColor(o.r/255,o.g/255,o.b/255,u??1)),i.enable(i.BLEND),i.blendFuncSeparate(i.ONE,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA);let c=new cl(t,Or,ja,La),m=ut.fromImage(t,new ImageData(new Uint8ClampedArray([128,128,128,255,190,190,190,255,190,190,190,255,128,128,128,255]),2,2),{wrap:"repeat",filter:"nearest"});return{lastDrawCalls:0,ggl:t,defShader:n,defTex:a,frameBuffer:l,postShader:null,postShaderUniform:null,renderer:c,transform:new $e,transformStack:[],bgTex:m,bgColor:o,bgAlpha:u,width:e.width??i.drawingBufferWidth/r/s,height:e.height??i.drawingBufferHeight/r/s,viewport:{x:0,y:0,width:i.drawingBufferWidth,height:i.drawingBufferHeight,scale:1},fixed:!1}};function yt(e){return e.fixed?!0:e.parent?yt(e.parent):!1}function xt(e){return{color:e.color,opacity:e.opacity,anchor:e.anchor,outline:e.outline,shader:e.shader,uniform:e.uniform}}function bl(e,t={}){return{id:"circle",radius:e,draw(){Ht(Object.assign(xt(this),{radius:this.radius,fill:t.fill}))},renderArea(){return new re(new E(this.anchor?0:-this.radius),this.radius*2,this.radius*2)},inspect(){return`radius: ${Math.ceil(this.radius)}`}}}function si(...e){return{id:"color",color:_(...e),inspect(){return`color: ${this.color.toString()}`}}}function xl(e){return{add(){this.canvas=e}}}function Sl(e=1){let t,n=0,r=!1;return{require:["opacity"],add(){t=this.opacity,this.opacity=0},update(){r||(n+=ye(),this.opacity=Je(n,0,e,0,t),n>=e&&(this.opacity=t,r=!0))}}}function El(e="intersect"){return{id:"mask",mask:e}}function ii(e){return{id:"opacity",opacity:e??1,fadeIn(t=1,n=h.k.easings.linear){return h.game.root.tween(0,this.opacity,t,r=>this.opacity=r,n)},fadeOut(t=1,n=h.k.easings.linear){return h.game.root.tween(this.opacity,0,t,r=>this.opacity=r,n)},inspect(){return`opacity: ${gr(this.opacity,1)}`}}}function Ml(e=1,t=_(0,0,0),n=1,r="miter",s=10,i="butt"){return{id:"outline",outline:{width:e,color:t,opacity:n,join:r,miterLimit:s,cap:i},inspect(){return`outline: ${this.outline.width}px, ${this.outline.color}`}}}var Cl=class{pos=x(0);vel=x(0);acc=x(0);angle=0;angularVelocity=0;damping=0;t;lt=null;gc;constructor(){this.t=0,this.gc=!0}get progress(){return this.lt?this.t/this.lt:this.t}};function Pl(e,t){let n=t.lifetime,r=[],s=e.colors||[W.WHITE],i=e.opacities||[1],a=e.quads||[new oe(0,0,1,1)],l=e.scales||[1],o=e.lifeTime,u=t.direction,c=t.spread,m=e.speed||[0,0],d=e.angle||[0,0],p=e.angularVelocity||[0,0],f=e.acceleration||[x(0),x(0)],v=e.damping||[0,0],y=[],w=new Array(e.max),C=0,q=0;for(let A=0;A<e.max;A++){y[A*6+0]=A*4+0,y[A*6+1]=A*4+1,y[A*6+2]=A*4+3,y[A*6+3]=A*4+1,y[A*6+4]=A*4+2,y[A*6+5]=A*4+3;for(let b=0;b<4;b++)w[A*4+b]={pos:new E(0,0),uv:new E(0,0),color:_(255,255,255),opacity:1};r[A]=new Cl}let F=new Se;function M(A=0){for(;A<e.max;){if(r[A].gc)return A;A++}return null}return{id:"particles",emit(A){let b=0;for(let T=0;T<A;T++){if(b=M(b),b==null)return;let I=me(u-c,u+c),B=E.fromAngle(I).scale(me(m[0],m[1])),R=me(d[0],d[1]),H=me(p[0],p[1]),V=x(me(f[0].x,f[1].x),me(f[0].y,f[1].y)),X=me(v[0],v[1]),Q=o?me(o[0],o[1]):null,U=t.shape?t.shape.random():x(),j=r[b];j.lt=Q,j.pos=U,j.vel=B,j.acc=V,j.angle=R,j.angularVelocity=H,j.damping=X,j.angularVelocity=H,j.gc=!1}C+=A},update(){if(n!==void 0&&n<=0)return;let A=ye();for(let b of r)if(!b.gc){if(b.t+=A,b.lt&&b.t>=b.lt){b.gc=!0,C--;continue}b.vel=b.vel.add(b.acc.scale(A)).scale(1-b.damping*A),b.pos=b.pos.add(b.vel.scale(A)),b.angle+=b.angularVelocity*A}for(n!==void 0&&(n-=A,n<=0&&F.trigger()),q+=A;C<e.max&&t.rate&&q>t.rate;)this.emit(1),C++,q-=t.rate},draw(){if(!(n!==void 0&&n<=0)){for(let A=0;A<r.length;A++){let b=r[A];if(b.gc)continue;let T=b.progress,I=Math.floor(b.progress*s.length),B=I<s.length-1?Te(s[I],s[I+1],Je(T,I/s.length,(I+1)/s.length,0,1)):s[I],R=Math.floor(b.progress*i.length),H=R<i.length-1?Te(i[R],i[R+1],Je(T,R/i.length,(R+1)/i.length,0,1)):i[R],V=Math.floor(b.progress*a.length),X=a[V],Q=Math.floor(b.progress*l.length),U=l[Q],j=Math.cos(b.angle*Math.PI/180),ie=Math.sin(b.angle*Math.PI/180),J=(e.texture?e.texture.width:10)*X.w/2,ee=(e.texture?e.texture.height:10)*X.h/2,we=A*4,N=w[we];N.pos.x=b.pos.x+-J*U*j- -ee*U*ie,N.pos.y=b.pos.y+-J*U*ie+-ee*U*j,N.uv.x=X.x,N.uv.y=X.y,N.color.r=B.r,N.color.g=B.g,N.color.b=B.b,N.opacity=H,N=w[we+1],N.pos.x=b.pos.x+J*U*j- -ee*U*ie,N.pos.y=b.pos.y+J*U*ie+-ee*U*j,N.uv.x=X.x+X.w,N.uv.y=X.y,N.color.r=B.r,N.color.g=B.g,N.color.b=B.b,N.opacity=H,N=w[we+2],N.pos.x=b.pos.x+J*U*j-ee*U*ie,N.pos.y=b.pos.y+J*U*ie+ee*U*j,N.uv.x=X.x+X.w,N.uv.y=X.y+X.h,N.color.r=B.r,N.color.g=B.g,N.color.b=B.b,N.opacity=H,N=w[we+3],N.pos.x=b.pos.x+-J*U*j-ee*U*ie,N.pos.y=b.pos.y+-J*U*ie+ee*U*j,N.uv.x=X.x,N.uv.y=X.y+X.h,N.color.r=B.r,N.color.g=B.g,N.color.b=B.b,N.opacity=H}ct(w,y,this.fixed,e.texture,this.shader,this.uniform)}},onEnd(A){return F.add(A)},inspect(){return`count: ${C}/${e.max}`}}}function Tl(e,t={}){if(e.length<3)throw new Error(`Polygon's need more than two points, ${e.length} points provided`);return{id:"polygon",pts:e,colors:t.colors,uv:t.uv,tex:t.tex,radius:t.radius,draw(){lt(Object.assign(xt(this),{pts:this.pts,colors:this.colors,uv:this.uv,tex:this.tex,radius:this.radius,fill:t.fill,triangulate:t.triangulate}))},renderArea(){return new Ee(this.pts)},inspect(){return`polygon: ${this.pts.map(n=>`[${n.x},${n.y}]`).join(",")}`}}}function ai(e,t,n){let r;return h.game.root.get("area").forEach(s=>{if(n&&n.some(a=>s.is(a)))return;let i=s.worldArea().raycast(e,t);i&&(r?i.fraction<r.fraction&&(r=i,r.object=s):(r=i,r.object=s))}),r}function oi(e,t,n={}){return{id:"rect",width:e,height:t,radius:n.radius||0,draw(){He(Object.assign(xt(this),{width:this.width,height:this.height,radius:this.radius,fill:n.fill}))},renderArea(){return new re(x(0),this.width,this.height)},inspect(){return`rect: (${Math.ceil(this.width)}w, ${Math.ceil(this.height)}h)`}}}function ql(e,t){return{id:"shader",shader:e,...typeof t=="function"?{uniform:t(),update(){this.uniform=t()}}:{uniform:t},inspect(){return`shader: ${e}`}}}function Il(e,t){if(!t.tileWidth||!t.tileHeight)throw new Error("Must provide tileWidth and tileHeight.");let n=h.game.root.add([On(t.pos??x(0))]),r=e.length,s=0,i=null,a=null,l=null,o=null,u=A=>A.x+A.y*s,c=A=>x(Math.floor(A%s),Math.floor(A/s)),m=()=>{i=[];for(let A of n.children)d(A)},d=A=>{let b=u(A.tilePos);i[b]?i[b].push(A):i[b]=[A]},p=A=>{let b=u(A.tilePos);if(i[b]){let T=i[b].indexOf(A);T>=0&&i[b].splice(T,1)}},f=()=>{let A=!1;for(let b of n.children){let T=n.pos2Tile(b.pos);(b.tilePos.x!=T.x||b.tilePos.y!=T.y)&&(A=!0,p(b),b.tilePos.x=T.x,b.tilePos.y=T.y,d(b))}A&&n.trigger("spatialMapChanged")},v=()=>{let A=n.getSpatialMap(),b=n.numRows()*n.numColumns();a?a.length=b:a=new Array(b),a.fill(1,0,b);for(let T=0;T<A.length;T++){let I=A[T];if(I){let B=0;for(let R of I)if(R.isObstacle){B=1/0;break}else B+=R.cost;a[T]=B||1}}},y=()=>{let A=n.getSpatialMap(),b=n.numRows()*n.numColumns();l?l.length=b:l=new Array(b),l.fill(15,0,b);for(let T=0;T<A.length;T++){let I=A[T];if(I){let B=I.length,R=15;for(let H=0;H<B;H++)R|=I[H].edgeMask;l[T]=R}}},w=()=>{let A=n.numRows()*n.numColumns(),b=(I,B)=>{let R=[];for(R.push(I);R.length>0;){let H=R.pop();F(H).forEach(V=>{o[V]<0&&(o[V]=B,R.push(V))})}};o?o.length=A:o=new Array(A),o.fill(-1,0,A);let T=0;for(let I=0;I<a.length;I++){if(o[I]>=0){T++;continue}b(I,T),T++}},C=(A,b)=>a[b],q=(A,b)=>{let T=c(A),I=c(b);return T.dist(I)},F=(A,b)=>{let T=[],I=Math.floor(A%s),B=I>0&&l[A]&1&&a[A-1]!==1/0,R=A>=s&&l[A]&2&&a[A-s]!==1/0,H=I<s-1&&l[A]&4&&a[A+1]!==1/0,V=A<s*r-s-1&&l[A]&8&&a[A+s]!==1/0;return b?(B&&(R&&T.push(A-s-1),T.push(A-1),V&&T.push(A+s-1)),R&&T.push(A-s),H&&(R&&T.push(A-s+1),T.push(A+1),V&&T.push(A+s+1)),V&&T.push(A+s)):(B&&T.push(A-1),R&&T.push(A-s),H&&T.push(A+1),V&&T.push(A+s)),T},M={id:"level",tileWidth(){return t.tileWidth},tileHeight(){return t.tileHeight},spawn(A,...b){let T=x(...b),I=(()=>{if(typeof A=="string"){if(t.tiles[A]){if(typeof t.tiles[A]!="function")throw new Error("Level symbol def must be a function returning a component list");return t.tiles[A](T)}else if(t.wildcardTile)return t.wildcardTile(A,T)}else{if(Array.isArray(A))return A;throw new Error("Expected a symbol or a component list")}})();if(!I)return null;let B=!1,R=!1;for(let V of I)V.id==="tile"&&(R=!0),V.id==="pos"&&(B=!0);B||I.push(On(this.tile2Pos(T))),R||I.push(Mi());let H=n.add(I);return B&&(H.tilePosOffset=H.pos.clone()),H.tilePos=T,H.transform=$t(H),i&&(d(H),this.trigger("spatialMapChanged"),this.trigger("navigationMapInvalid")),H},numColumns(){return s},numRows(){return r},levelWidth(){return s*this.tileWidth()},levelHeight(){return r*this.tileHeight()},tile2Pos(...A){return x(...A).scale(this.tileWidth(),this.tileHeight())},pos2Tile(...A){let b=x(...A);return x(Math.floor(b.x/this.tileWidth()),Math.floor(b.y/this.tileHeight()))},getSpatialMap(){return i||m(),i},removeFromSpatialMap:p,insertIntoSpatialMap:d,onSpatialMapChanged(A){return this.on("spatialMapChanged",A)},onNavigationMapInvalid(A){return this.on("navigationMapInvalid",A)},getAt(A){i||m();let b=u(A);return i[b]||[]},raycast(A,b){let T=this.toWorld(A),I=this.toWorld(A.add(b)).sub(T),B=1/this.tileWidth(),R=A.scale(B),H=da(R,b,V=>{let X=this.getAt(V);if(X.some(U=>U.isObstacle))return!0;let Q=null;for(let U of X)if(U.has("area")){let j=U.worldArea().raycast(T,I);j&&(Q?j.fraction<Q.fraction&&(Q=j,Q.object=U):(Q=j,Q.object=U))}return Q&&(Q.point=this.fromWorld(Q.point).scale(B)),Q||!1},64);return H&&(H.point=H.point.scale(this.tileWidth())),H},update(){i&&f()},invalidateNavigationMap(){a=null,l=null,o=null},onNavigationMapChanged(A){return this.on("navigationMapChanged",A)},getTilePath(A,b,T={}){if(a||v(),l||y(),o||w(),A.x<0||A.x>=s||A.y<0||A.y>=r||b.x<0||b.x>=s||b.y<0||b.y>=r)return null;let I=u(A),B=u(b);if(a[B]===1/0)return null;if(I===B)return[];if(o[I]!=-1&&o[I]!==o[B])return null;let R=new Ls((j,ie)=>j.cost<ie.cost);R.insert({cost:0,node:I});let H=new Map;H.set(I,I);let V=new Map;for(V.set(I,0);R.length!==0;){let j=R.remove()?.node;if(j===B)break;let ie=F(j,T.allowDiagonals);for(let J of ie){let ee=(V.get(j)||0)+C(j,J)+q(J,B);(!V.has(J)||ee<V.get(J))&&(V.set(J,ee),R.insert({cost:ee,node:J}),H.set(J,j))}}let X=[],Q=B,U=c(Q);for(X.push(U);Q!==I;){let j=H.get(Q);if(j===void 0)throw new Error("Bug in pathfinding algorithm");Q=j;let ie=c(Q);X.push(ie)}return X.reverse()},getPath(A,b,T={}){let I=this.tileWidth(),B=this.tileHeight(),R=this.getTilePath(this.pos2Tile(A),this.pos2Tile(b),T);return R?[A,...R.slice(1,-1).map(H=>H.scale(I,B).add(I/2,B/2)),b]:null}};return n.use(M),n.onNavigationMapInvalid(()=>{n.invalidateNavigationMap(),n.trigger("navigationMapChanged")}),e.forEach((A,b)=>{let T=A.split("");s=Math.max(T.length,s),T.forEach((I,B)=>{n.spawn(I,x(B,b))})}),n}function Be(e,t,n){return h.game.objEvents.registers[e]||(h.game.objEvents.registers[e]=new Hs),h.game.objEvents.on(e,(r,...s)=>{r.is(t)&&n(r,...s)})}var Bl=(e,t,...n)=>{for(let r of h.game.root.children)r.is(t)&&r.trigger(e,n)},Dl=se(e=>{let t=h.game.root.add([{fixedUpdate:e}]);return{get paused(){return t.paused},set paused(n){t.paused=n},cancel:()=>t.destroy()}},(e,t)=>Be("fixedUpdate",e,t)),li=se(e=>{let t=h.game.root.add([{update:e}]);return{get paused(){return t.paused},set paused(n){t.paused=n},cancel:()=>t.destroy()}},(e,t)=>Be("update",e,t)),Rl=se(e=>{let t=h.game.root.add([{draw:e}]);return{get paused(){return t.hidden},set paused(n){t.hidden=n},cancel:()=>t.destroy()}},(e,t)=>Be("draw",e,t)),ui=se(e=>h.game.events.on("add",e),(e,t)=>Be("add",e,t)),Fl=se(e=>h.game.events.on("destroy",e),(e,t)=>Be("destroy",e,t)),Ol=se(e=>h.game.events.on("use",e),(e,t)=>Be("use",e,t)),Hl=se(e=>h.game.events.on("unuse",e),(e,t)=>Be("unuse",e,t)),di=se(e=>h.game.events.on("tag",e),(e,t)=>Be("tag",e,t)),jl=se(e=>h.game.events.on("untag",e),(e,t)=>Be("untag",e,t));function Ll(e,t,n){return Be("collide",e,(r,s,i)=>s.is(t)&&n(r,s,i))}function Nl(e,t,n){return Be("collideUpdate",e,(r,s,i)=>s.is(t)&&n(r,s,i))}function Ul(e,t,n){return Be("collideEnd",e,(r,s,i)=>s.is(t)&&n(r,s,i))}function zn(e,t){h.game.root.get(e,{recursive:!0}).forEach(t),ui(e,t),di((n,r)=>{r===e&&t(n)})}var Gl=se(e=>h.app.onMousePress(e),(e,t)=>{let n=[];return zn(e,r=>{if(!r.area)throw new Error("onClick() requires the object to have area() component");n.push(r.onClick(()=>t(r)))}),St.join(n)});function Kl(e,t){let n=[];return zn(e,r=>{if(!r.area)throw new Error("onHover() requires the object to have area() component");n.push(r.onHover(()=>t(r)))}),St.join(n)}function zl(e,t){let n=[];return zn(e,r=>{if(!r.area)throw new Error("onHoverUpdate() requires the object to have area() component");n.push(r.onHoverUpdate(()=>t(r)))}),St.join(n)}function Yl(e,t){let n=[];return zn(e,r=>{if(!r.area)throw new Error("onHoverEnd() requires the object to have area() component");n.push(r.onHoverEnd(()=>t(r)))}),St.join(n)}function Vl(e){h.game.events.on("loading",e)}function Xl(e){h.app.onResize(e)}function Wl(e){h.game.events.on("error",e)}function Kr(e){h.assets.loaded?e():h.game.events.on("load",e)}function Ql(e){if(h.assets.loaded)Ys().forEach(t=>e(...t));else return h.game.events.on("loadError",e)}function hi(...e){h.game.cam.pos=x(...e)}function ci(){return h.game.cam.pos?h.game.cam.pos.clone():Dn()}function fi(...e){h.game.cam.scale=x(...e)}function pi(){return h.game.cam.scale.clone()}function gi(e){h.game.cam.angle=e}function mi(){return h.game.cam.angle}function Jl(){return h.game.cam.transform.clone()}function yi(e=_(255,255,255),t=1){let n=h.game.root.add([oi(Ae(),ve()),si(e),ii(1),Ti()]),r=n.fadeOut(t);return r.onEnd(()=>Ei(n)),r}function Zl(){return h.game.cam.transform.clone()}function $l(e=12){h.game.cam.shake+=e}function br(e){return h.game.cam.transform.multVec2(e)}function wi(e){return h.game.cam.transform.invert().multVec2(e)}function _l(...e){return Ft("camPos","setCamPos / getCamPos"),e.length>0&&hi(...e),ci()}function kl(...e){return Ft("camScale","setCamScale / getCamScale"),e.length>0&&fi(...e),pi()}function eu(e){return Ft("camRot","setCamRot / getCamRot"),e!==void 0&&gi(e),mi()}function tu(e=_(255,255,255),t=1){return Ft("camFlash","flash"),yi(e,t)}function zr(e=[]){let t=new Map,n=[],r={},s=new en,i=[],a=new Set("*"),l=h.globalOpt.tagsAsComponents,o=null,u=!1,c={id:co(),hidden:!1,transform:new $e,children:[],parent:null,set paused(d){if(d!==u){u=d;for(let p of i)p.paused=d}},get paused(){return u},get tags(){return Array.from(a)},add(d){let p=Array.isArray(d)?zr(d):d;if(p.parent)throw new Error("Cannot add a game obj that already has a parent.");return p.parent=this,p.transform=$t(p),this.children.push(p),p.trigger("add",p),h.game.events.trigger("add",p),p},readd(d){let p=this.children.indexOf(d);return p!==-1&&(this.children.splice(p,1),this.children.push(d)),d},remove(d){let p=this.children.indexOf(d);if(p!==-1){d.parent=null,this.children.splice(p,1);let f=v=>{v.trigger("destroy"),h.game.events.trigger("destroy",v),v.children.forEach(y=>f(y))};f(d)}},removeAll(d){if(d)this.get(d).forEach(p=>this.remove(p));else for(let p of[...this.children])this.remove(p)},fixedUpdate(){this.paused||(this.children.forEach(d=>d.fixedUpdate()),this.trigger("fixedUpdate"))},update(){this.paused||(this.children.forEach(d=>d.update()),this.trigger("update"))},draw(){if(this.hidden)return;this.canvas&&(Oe(),this.canvas.bind());let d=h.gfx.fixed;this.fixed&&(h.gfx.fixed=!0),Fe(),ue(this.pos),nn(this.scale),Rt(this.angle);let p=this.children.sort((f,v)=>{let y=f.layerIndex??h.game.defaultLayerIndex,w=v.layerIndex??h.game.defaultLayerIndex;return y-w||(f.z??0)-(v.z??0)});if(this.mask){let f={intersect:h.k.drawMasked,subtract:h.k.drawSubtracted}[this.mask];if(!f)throw new Error(`Invalid mask func: "${this.mask}"`);f(()=>{p.forEach(v=>v.draw())},()=>{this.trigger("draw")})}else this.trigger("draw"),p.forEach(f=>f.draw());Pe(),h.gfx.fixed=d,this.canvas&&(Oe(),this.canvas.unbind())},drawInspect(){this.hidden||(Fe(),ue(this.pos),nn(this.scale),Rt(this.angle),this.children.forEach(d=>d.drawInspect()),this.trigger("drawInspect"),Pe())},use(d){if(typeof d=="string")return a.add(d);if(!d||typeof d!="object")throw new Error(`You can only pass a component or a string to .use(), you passed a "${typeof d}"`);let p=[];d.id?(this.unuse(d.id),r[d.id]=[],p=r[d.id],t.set(d.id,d),l&&a.add(d.id)):n.push(d);for(let v in d){if(Ga.has(v))continue;let y=Object.getOwnPropertyDescriptor(d,v);if(y)if(typeof y.value=="function"&&(d[v]=d[v].bind(this)),y.set&&Object.defineProperty(d,v,{set:y.set.bind(this)}),y.get&&Object.defineProperty(d,v,{get:y.get.bind(this)}),Ka.has(v)){let w=v==="add"?()=>{o=C=>p.push(C),d[v]?.(),o=null}:d[v];p.push(this.on(v,w).cancel)}else if(this[v]===void 0)Object.defineProperty(this,v,{get:()=>d[v],set:w=>d[v]=w,configurable:!0,enumerable:!0}),p.push(()=>delete this[v]);else{let w=t.values().find(C=>C[v]!==void 0)?.id;throw new Error(`Duplicate component property: "${v}" while adding component "${d.id}"`+(w?` (originally added by "${w}")`:""))}}let f=()=>{if(d.require){for(let v of d.require)if(!this.c(v))throw new Error(`Component "${d.id}" requires component "${v}"`)}};d.destroy&&p.push(d.destroy.bind(this)),this.exists()?(f(),d.add&&(o=v=>p.push(v),d.add.call(this),o=null),d.id&&(this.trigger("use",d.id),h.game.events.trigger("use",this,d.id))):d.require&&p.push(this.on("add",f).cancel)},unuse(d){if(t.has(d)){for(let p of t.values())if(p.require&&p.require.includes(d))throw new Error(`Can't unuse. Component "${p.id}" requires component "${d}"`);t.delete(d),this.trigger("unuse",d),h.game.events.trigger("unuse",this,d)}else l&&a.has(d)&&a.delete(d);r[d]&&(r[d].forEach(p=>p()),delete r[d])},c(d){return t.get(d)??null},get(d,p={}){let f=(y,w)=>p.only==="comps"?y.has(w):p.only==="tags"?y.is(w):y.is(w)||y.has(w),v=p.recursive?this.children.flatMap(function y(w){return[w,...w.children.flatMap(y)]}):this.children;if(v=v.filter(y=>d?f(y,d):!0),p.liveUpdate){let y=C=>p.recursive?this.isAncestorOf(C):C.parent===this,w=[];w.push(h.k.onAdd(C=>{y(C)&&f(C,d)&&v.push(C)})),w.push(h.k.onDestroy(C=>{if(y(C)&&f(C,d)){let q=v.findIndex(F=>F.id===C.id);q!==-1&&v.splice(q,1)}})),this.onDestroy(()=>{for(let C of w)C.cancel()})}return v},query(d){let p=d.hierarchy||"children",f=d.include,v=d.exclude,y=[];switch(p){case"children":y=this.children;break;case"siblings":y=this.parent?this.parent.children.filter(C=>C!==this):[];break;case"ancestors":let w=this.parent;for(;w;)y.push(w),w=w.parent;break;case"descendants":y=this.children.flatMap(function C(q){return[q,...q.children.flatMap(C)]});break}if(f&&((d.includeOp||"and")==="and"||!Array.isArray(d.include)?y=y.filter(w=>w.is(f)):y=y.filter(w=>d.include.some(C=>w.is(C)))),v&&((d.includeOp||"and")==="and"||!Array.isArray(d.include)?y=y.filter(w=>!w.is(v)):y=y.filter(w=>!d.exclude.some(C=>w.is(C)))),d.visible===!0&&(y=y.filter(w=>w.visible)),d.distance){if(!this.pos)throw Error("Can't do a distance query from an object without pos");let w=d.distanceOp||"near",C=d.distance*d.distance;w==="near"?y=y.filter(q=>q.pos&&this.pos.sdist(q.pos)<=C):y=y.filter(q=>q.pos&&this.pos.sdist(q.pos)>C)}return d.name&&(y=y.filter(w=>w.name===d.name)),y},isAncestorOf(d){return d.parent?d.parent===this||this.isAncestorOf(d.parent):!1},exists(){return h.game.root.isAncestorOf(this)},is(d,p="and"){return Array.isArray(d)?p==="and"?d.every(f=>a.has(f)):d.some(f=>a.has(f)):a.has(d)},tag(d){if(Array.isArray(d))for(let p of d)a.add(p),this.trigger("tag",p),h.game.events.trigger("tag",this,p);else a.add(d),this.trigger("tag",d),h.game.events.trigger("tag",this,d)},untag(d){if(Array.isArray(d))for(let p of d)a.delete(p),this.trigger("untag",p),h.game.events.trigger("untag",this,p);else a.delete(d),this.trigger("untag",d),h.game.events.trigger("untag",this,d)},has(d,p="and"){return Array.isArray(d)?p==="and"?d.every(f=>t.has(f)):d.some(f=>t.has(f)):t.has(d)},on(d,p){let f=s.on(d,p.bind(this));return o&&o(()=>f.cancel()),f},trigger(d,...p){s.trigger(d,...p),h.game.objEvents.trigger(d,this,...p)},destroy(){this.parent&&this.parent.remove(this)},inspect(){let d={};for(let[p,f]of t)d[p]=f.inspect?.()??null;for(let[p,f]of n.entries()){if(f.inspect){d[p]=f.inspect();continue}for(let[v,y]of Object.entries(f))typeof y!="function"&&(d[v]=`${v}: ${y}`)}return d},onAdd(d){return this.on("add",d)},onFixedUpdate(d){return this.on("fixedUpdate",d)},onUpdate(d){return this.on("update",d)},onDraw(d){return this.on("draw",d)},onDestroy(d){return this.on("destroy",d)},onUse(d){return this.on("use",d)},onUnuse(d){return this.on("unuse",d)},clearEvents(){s.clear()}},m=["onKeyPress","onKeyPressRepeat","onKeyDown","onKeyRelease","onMousePress","onMouseDown","onMouseRelease","onMouseMove","onCharInput","onMouseMove","onTouchStart","onTouchMove","onTouchEnd","onScroll","onGamepadButtonPress","onGamepadButtonDown","onGamepadButtonRelease","onGamepadStick","onButtonPress","onButtonDown","onButtonRelease"];for(let d of m)c[d]=(...p)=>{let f=h.app[d]?.(...p);return i.push(f),c.onDestroy(()=>f.cancel()),c.on("sceneEnter",()=>{i.splice(i.indexOf(f),1);let v=h.app[d]?.(...p);St.replace(f,v),i.push(f)}),f};for(let d of e)c.use(d);return c}var nu=()=>({events:new en,objEvents:new en,root:zr([]),gravity:null,scenes:{},currentScene:null,layers:null,defaultLayerIndex:0,logs:[],cam:{pos:null,scale:new E(1),angle:0,shake:0,transform:new $e}});function ru(e){h.game.gravity=e?(h.game.gravity||x(0,1)).unit().scale(e):null}function su(){return h.game.gravity?h.game.gravity.len():0}function iu(e){h.game.gravity=e.unit().scale(h.game.gravity?h.game.gravity.len():1)}function kt(){return h.game.gravity?h.game.gravity.unit():x(0,1)}var au=Gi("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"),ou=()=>(()=>{let e=new(window.AudioContext||window.webkitAudioContext),t=e.createGain();t.connect(e.destination);let n=new rn(Bo(e));return e.decodeAudioData(au.buffer.slice(0)).then(r=>{n.buf=r}).catch(r=>{console.error("Failed to load burp: ",r)}),{ctx:e,masterNode:t,burpSnd:n}})();function lu(e,t={}){let n=new Se,r=new Audio(e);r.crossOrigin="anonymous",r.loop=!!t.loop,h.audio.ctx.createMediaElementSource(r).connect(h.audio.masterNode);function s(){h.debug.paused||h.app.isHidden()&&!h.globalOpt.backgroundAudio||h.audio.ctx.resume()}function i(){s(),r.play()}return t.paused||i(),r.onended=()=>n.trigger(),{play(){i()},seek(a){r.currentTime=a},stop(){r.pause(),this.seek(0)},set loop(a){r.loop=a},get loop(){return r.loop},set paused(a){a?r.pause():i()},get paused(){return r.paused},time(){return r.currentTime},duration(){return r.duration},set volume(a){r.volume=Ze(a,0,1)},get volume(){return r.volume},set speed(a){r.playbackRate=Math.max(a,0)},get speed(){return r.playbackRate},set detune(a){},get detune(){return 0},onEnd(a){return n.add(a)},then(a){return this.onEnd(a)}}}function uu(e,t={}){if(typeof e=="string"&&h.assets.music[e])return lu(h.assets.music[e],t);let n=h.audio.ctx,r=t.paused??!1,s=n.createBufferSource(),i=new Se,a=n.createGain(),l=n.createStereoPanner(),o=t.seek??0,u=0,c=0,m=!1;s.loop=!!t.loop,s.detune.value=t.detune??0,s.playbackRate.value=t.speed??1,s.connect(l),s.onended=()=>{f()>=(s.buffer?.duration??Number.POSITIVE_INFINITY)&&i.trigger()},l.pan.value=t.pan??0,l.connect(a),a.connect(h.audio.masterNode),a.gain.value=t.volume??1;let d=y=>{s.buffer=y.buf,r||(u=n.currentTime,s.start(0,o),m=!0)},p=il(e);p instanceof Le&&p.onLoad(d);let f=()=>{if(!s.buffer)return 0;let y=r?c-u:n.currentTime-u,w=s.buffer.duration;return s.loop?y%w:Math.min(y,w)},v=y=>{let w=n.createBufferSource();return w.buffer=y.buffer,w.loop=y.loop,w.playbackRate.value=y.playbackRate.value,w.detune.value=y.detune.value,w.onended=y.onended,w.connect(l),w};return{stop(){this.paused=!0,this.seek(0)},set paused(y){if(r!==y)if(r=y,y)m&&(s.stop(),m=!1),c=n.currentTime;else{s=v(s);let w=c-u;s.start(0,w),m=!0,u=n.currentTime-w,c=0}},get paused(){return r},play(y=0){this.seek(y),this.paused=!1},seek(y){s.buffer?.duration&&(y>s.buffer.duration||(r?(s=v(s),u=c-y):(s.stop(),s=v(s),u=n.currentTime-y,s.start(0,y),m=!0,c=0)))},set speed(y){s.playbackRate.value=y},get speed(){return s.playbackRate.value},set detune(y){s.detune.value=y},get detune(){return s.detune.value},set volume(y){a.gain.value=Math.max(y,0)},get volume(){return a.gain.value},set pan(y){l.pan.value=y},get pan(){return l.pan.value},set loop(y){s.loop=y},get loop(){return s.loop},duration(){return s.buffer?.duration??0},time(){return f()%this.duration()},onEnd(y){return i.add(y)},then(y){return this.onEnd(y)}}}function Ai(e){return h.k.play(h.audio.burpSnd,e)}function vi(e){h.audio.masterNode.gain.value=e}function bi(){return h.audio.masterNode.gain.value}function du(e){return Ft("volume","setVolume / getVolume"),e!==void 0&&vi(e),bi()}function xi(){h.app.onHide(()=>{h.globalOpt.backgroundAudio||h.audio.ctx.suspend()}),h.app.onShow(()=>{!h.globalOpt.backgroundAudio&&!h.debug.paused&&h.audio.ctx.resume()}),h.app.onResize(()=>{if(h.app.isFullscreen())return;let e=h.globalOpt.width&&h.globalOpt.height;e&&!h.globalOpt.stretch&&!h.globalOpt.letterbox||(h.canvas.width=h.canvas.offsetWidth*h.pixelDensity,h.canvas.height=h.canvas.offsetHeight*h.pixelDensity,Gs(),e||(h.gfx.frameBuffer.free(),h.gfx.frameBuffer=new Rn(h.gfx.ggl,h.gfx.ggl.gl.drawingBufferWidth,h.gfx.ggl.gl.drawingBufferHeight),h.gfx.width=h.gfx.ggl.gl.drawingBufferWidth/h.pixelDensity/h.gscale,h.gfx.height=h.gfx.ggl.gl.drawingBufferHeight/h.pixelDensity/h.gscale))}),h.globalOpt.debug!==!1&&(h.app.onKeyPress(h.globalOpt.debugKey??"f1",()=>h.debug.inspect=!h.debug.inspect),h.app.onKeyPress("f2",()=>h.debug.clearLog()),h.app.onKeyPress("f8",()=>h.debug.paused=!h.debug.paused),h.app.onKeyPress("f7",()=>{h.debug.timeScale=gr(Ze(h.debug.timeScale-.2,0,2),1)}),h.app.onKeyPress("f9",()=>{h.debug.timeScale=gr(Ze(h.debug.timeScale+.2,0,2),1)}),h.app.onKeyPress("f10",()=>h.debug.stepFrame())),h.globalOpt.burp&&h.app.onKeyPress("b",()=>Ai())}function hu(e,t={}){let n=h.game.root.add([On(e),Pi()]),r=(t.speed||1)*5,s=t.scale||1;n.add([xr(h.boomSprite),Hn(0),Mr("center"),hs(r,s),...t.comps??[]]);let i=n.add([xr(h.kaSprite),Hn(0),Mr("center"),Sr(),...t.comps??[]]);return i.wait(.4/r,()=>i.use(hs(r,s))),i.onDestroy(()=>n.destroy()),n}function Si(e,t){if(h.game.layers)throw Error("Layers can only be assigned once.");let n=e.indexOf(t);if(n==-1)throw Error("The default layer name should be present in the layers list.");h.game.layers=e,h.game.defaultLayerIndex=n}function cu(){return h.game.layers}function fu(){return h.game.layers?.[h.game.defaultLayerIndex]??null}function pu(e,t){Ft("layers","setLayers"),Si(e,t)}function Ei(e){e.destroy()}function gu(){return h.game.root}function mu(e,t){h.game.scenes[e]=t}function yu(e,...t){if(!h.game.scenes[e])throw new Error(`Scene not found: ${e}`);h.game.events.onOnce("frameEnd",()=>{h.game.events.trigger("sceneLeave",e),h.app.events.clear(),h.game.events.clear(),h.game.objEvents.clear(),[...h.game.root.children].forEach(n=>{!n.stay||n.scenesToStay&&!n.scenesToStay.includes(e)?h.game.root.remove(n):n.trigger("sceneEnter",e)}),h.game.root.clearEvents(),xi(),h.game.cam={pos:null,scale:x(1),angle:0,shake:0,transform:new $e},h.game.scenes[e](...t)}),h.game.currentScene=e}function wu(e){return h.game.events.on("sceneLeave",e)}function Au(){return h.game.currentScene}function xr(e,t={}){let n=null,r=null,s=null,i=new Se;if(!e)throw new Error("Please pass the resource name or data to sprite()");let a=(u,c,m,d)=>{let p=x(1,1);return m&&d?(p.x=m/(u.width*c.w),p.y=d/(u.height*c.h)):m?(p.x=m/(u.width*c.w),p.y=p.x):d&&(p.y=d/(u.height*c.h),p.x=p.y),p},l=(u,c)=>{if(!c)return;let m=c.frames[0].clone();t.quad&&(m=m.scale(t.quad));let d=a(c.tex,m,t.width,t.height);if(u.width=c.tex.width*m.w*d.x,u.height=c.tex.height*m.h*d.y,c.anims)for(let p in c.anims){let f=c.anims[p];typeof f!="number"&&(f.frames=o(f))}n=c,i.trigger(n),t.anim&&u.play(t.anim)},o=u=>{if(u.frames)return u.frames;let c=[];if(u.from===void 0||u.to===void 0)throw new Error("Sprite anim 'from' and 'to' must be defined if 'frames' is not defined");let m=Math.abs(u.to-u.from)+1;for(let d=0;d<m;d++)c.push(u.from+d*Math.sign(u.to-u.from));if(u.pingpong)for(let d=m-2;d>0;d--)c.push(c[d]);return c};return{id:"sprite",width:0,height:0,frame:t.frame||0,quad:t.quad||new oe(0,0,1,1),animSpeed:t.animSpeed??1,flipX:t.flipX??!1,flipY:t.flipY??!1,get sprite(){return e.toString()},set sprite(u){let c=Mn(u);c&&c.onLoad(m=>l(this,m))},get animFrame(){if(!n||!r||s===null)return this.frame;let u=n.anims[r.name];return typeof u=="number"?u:u.from===void 0||u.to===void 0?r.frameIndex:this.frame-Math.min(u.from,u.to)},draw(){if(!n)return;let u=n.frames[this.frame??0];if(!u)throw new Error(`Frame not found: ${this.frame??0}`);if(n.slice9){let{left:c,right:m,top:d,bottom:p}=n.slice9,f=n.tex.width*u.w,v=n.tex.height*u.h,y=this.width-c-m,w=this.height-d-p,C=c/f,q=m/f,F=1-C-q,M=d/v,A=p/v,b=1-M-A,T=[he(0,0,C,M),he(C,0,F,M),he(C+F,0,q,M),he(0,M,C,b),he(C,M,F,b),he(C+F,M,q,b),he(0,M+b,C,A),he(C,M+b,F,A),he(C+F,M+b,q,A),he(0,0,c,d),he(c,0,y,d),he(c+y,0,m,d),he(0,d,c,w),he(c,d,y,w),he(c+y,d,m,w),he(0,d+w,c,p),he(c,d+w,y,p),he(c+y,d+w,m,p)];for(let I=0;I<9;I++){let B=T[I],R=T[I+9];Fn(Object.assign(xt(this),{pos:R.pos(),tex:n.tex,quad:u.scale(B),flipX:this.flipX,flipY:this.flipY,tiled:t.tiled,width:R.w,height:R.h}))}}else Fn(Object.assign(xt(this),{tex:n.tex,quad:u.scale(this.quad??new oe(0,0,1,1)),flipX:this.flipX,flipY:this.flipY,tiled:t.tiled,width:this.width,height:this.height}))},add(){let u=Mn(e);u?u.onLoad(c=>l(this,c)):Kr(()=>l(this,Mn(e).data))},update(){if(!n||!r||s===null)return;let u=n.anims[r.name];if(typeof u=="number"){this.frame=u;return}if(u.speed===0)throw new Error("Sprite anim speed cannot be 0");if(r.timer+=ye()*this.animSpeed,r.timer>=1/r.speed){r.timer=0,r.frameIndex+=s;let c=u.frames;if(r.frameIndex>=c.length)if(r.pingpong&&!u.pingpong)s=-1,r.frameIndex=c.length-2;else if(r.loop)r.frameIndex=0;else{this.frame=c.at(-1),r.onEnd(),this.stop();return}else if(r.frameIndex<0)if(r.pingpong&&r.loop)s=1,r.frameIndex=1;else if(r.loop)r.frameIndex=c.length-1;else{this.frame=c[0],r.onEnd(),this.stop();return}this.frame=c[r.frameIndex]}},play(u,c={}){if(!n){i.add(()=>this.play(u,c));return}let m=n.anims[u];if(m===void 0)throw new Error(`Anim not found: ${u}`);r&&this.stop(),r=typeof m=="number"?{name:u,timer:0,loop:!1,pingpong:!1,speed:0,frameIndex:0,onEnd:()=>{}}:{name:u,timer:0,loop:c.loop??m.loop??!1,pingpong:c.pingpong??m.pingpong??!1,speed:c.speed??m.speed??10,frameIndex:0,onEnd:c.onEnd??(()=>{})},s=typeof m=="number"?null:1,this.frame=typeof m=="number"?m:m.frames[0],this.trigger("animStart",u)},stop(){if(!r)return;let u=r.name;r=null,this.trigger("animEnd",u)},numFrames(){return n?.frames.length??0},getCurAnim(){return r},curAnim(){return r?.name},getAnim(u){return n?.anims[u]??null},hasAnim(u){return!!this.getAnim(u)},onAnimEnd(u){return this.on("animEnd",u)},onAnimStart(u){return this.on("animStart",u)},renderArea(){return new re(x(0),this.width,this.height)},inspect(){return typeof e=="string"?`sprite: "${e}"`:null}}}function vu(e,t={}){function n(s){let i=vt(Object.assign(xt(s),{text:s.text+"",size:s.textSize,font:s.font,width:t.width&&s.width,align:s.align,letterSpacing:s.letterSpacing,lineSpacing:s.lineSpacing,transform:s.textTransform,styles:s.textStyles,indentAll:t.indentAll}));return t.width||(s.width=i.width/(s.scale?.x||1)),s.height=i.height/(s.scale?.y||1),i}let r={id:"text",set text(s){e=s,n(this),this.renderedText=Ar(e).text},get text(){return e},textSize:t.size??36,font:t.font,width:t.width??0,height:0,align:t.align,lineSpacing:t.lineSpacing,letterSpacing:t.letterSpacing,textTransform:t.transform,textStyles:t.styles,renderedText:e?Ar(e).text:"",add(){Kr(()=>n(this))},draw(){bt(n(this))},renderArea(){return new re(x(0),this.width,this.height)}};return n(r),r}function bu(e,t){return{id:"rect",width:e,height:t,draw(){sn(Object.assign(xt(this),{width:this.width,height:this.height}))},renderArea(){return new re(x(0),this.width,this.height)},inspect(){return`uvquad: (${Math.ceil(this.width)}w, ${Math.ceil(this.height)})h`}}}function xu(e={}){let t=null,n=null,r=null,s=null;return{id:"agent",require:["pos","tile"],agentSpeed:e.speed??100,allowDiagonals:e.allowDiagonals??!0,getDistanceToTarget(){return t?this.pos.dist(t):0},getNextLocation(){return n&&r?n[r]:null},getPath(){return n?n.slice():null},getTarget(){return t},isNavigationFinished(){return n?r===null:!0},isTargetReachable(){return n!==null},isTargetReached(){return t?this.pos.eq(t):!0},setTarget(i){t=i,n=this.getLevel().getPath(this.pos,t,{allowDiagonals:this.allowDiagonals}),r=n?0:null,n&&r!==null?(s||(s=this.getLevel().onNavigationMapChanged(()=>{t&&n&&r!==null&&(n=this.getLevel().getPath(this.pos,t,{allowDiagonals:this.allowDiagonals}),n?(r=0,this.trigger("navigationNext",this,n[r])):(r=null,this.trigger("navigationEnded",this)))}),this.onDestroy(()=>s?.cancel())),this.trigger("navigationStarted",this),this.trigger("navigationNext",this,n[r])):this.trigger("navigationEnded",this)},update(){if(t&&n&&r!==null){if(this.pos.sdist(n[r])<2)if(r===n.length-1){this.pos=t.clone(),r=null,this.trigger("navigationEnded",this),this.trigger("targetReached",this);return}else r++,this.trigger("navigationNext",this,n[r]);this.moveTo(n[r],this.agentSpeed)}},onNavigationStarted(i){return this.on("navigationStarted",i)},onNavigationNext(i){return this.on("navigationNext",i)},onNavigationEnded(i){return this.on("navigationEnded",i)},onTargetReached(i){return this.on("targetReached",i)},inspect(){return"agent: "+JSON.stringify({target:JSON.stringify(t),path:JSON.stringify(n)})}}}function Su(e){let t=e.graph;return{id:"pathfinder",require:["pos"],navigateTo(n){return this.graph?.getWaypointPath(this.pos,n,e.navigationOpt)},get graph(){if(t)return t;let n=this.parent;for(;n;){if(n.has("pathfinderMap"))return n.graph;n=n.parent}},set graph(n){t=n}}}function Eu(e={}){let t=e.waypoints,n=e.speed||100,r=e.endBehavior||"stop",s=0,i=t!=null;return{id:"patrol",require:["pos"],get patrolSpeed(){return n},set patrolSpeed(a){n=a},get waypoints(){return t},set waypoints(a){t=a,s=0,i=!1},get nextLocation(){return t?t[s]:void 0},update(){let a=this.nextLocation;if(!(!t||!a||i)&&(this.moveTo(a,n),this.pos.sdist(a)<9))switch(r){case"loop":s=(s+1)%t.length;break;case"ping-pong":s=s+1,s==t.length&&(t.reverse(),s=0);break;case"stop":s<t.length-1?s+=1:i||(i=!0,this.trigger("patrolFinished",this));break}},onPatrolFinished(a){return this.on("patrolFinished",a)}}}function Mu(e,t={}){let n=typeof e=="function"?e:()=>h.game.root.query(e),r=t.checkFrequency||1,s=typeof t.direction=="number"?E.fromAngle(t.direction):t.direction,i=0;return{id:"sentry",require:["pos"],direction:typeof t.direction=="number"?E.fromAngle(t.direction):t.direction,spotted:[],set directionAngle(a){this.direction=a!==void 0?E.fromAngle(a):void 0},get directionAngle(){return this.direction?this.direction.angle():void 0},fieldOfView:t.fieldOfView||200,isWithinFieldOfView(a,l,o){let u=(typeof l=="number"?E.fromAngle(l):l)||s,c=o||t.fieldOfView;if(!u||!c||c>=360)return!0;let m=c/2;return a.pos&&u.angleBetween(a.pos.sub(this.pos))<=m},hasLineOfSight(a){let l=ai(this.pos,a.pos.sub(this.pos),t.raycastExclude);return l!=null&&l.object===a},update(){if(i+=ye(),i>r){i-=r;let a=n();if(a.length&&s&&this.fieldOfView&&this.fieldOfView<360){let l=this.fieldOfView/2;a=a.filter(o=>o.pos&&s.angleBetween(o.pos.sub(this.pos))<=l)}a.length&&t.lineOfSight&&(a=a.filter(l=>l.pos&&this.hasLineOfSight(l))),a.length>0&&(this.spotted=a,this.trigger("objectSpotted",a))}},onObjectsSpotted(a){return this.on("objectSpotted",a)}}}function Mi(e={}){let t=x(0),n=e.isObstacle??!1,r=e.cost??0,s=e.edges??[],i=()=>{let l={left:1,top:2,right:4,bottom:8};return s.map(o=>l[o]||0).reduce((o,u)=>o|u,0)},a=i();return{id:"tile",tilePosOffset:e.offset??x(0),set tilePos(l){let o=this.getLevel();t=l.clone(),this.pos=x(this.tilePos.x*o.tileWidth(),this.tilePos.y*o.tileHeight()).add(this.tilePosOffset)},get tilePos(){return t},set isObstacle(l){n!==l&&(n=l,this.getLevel().invalidateNavigationMap())},get isObstacle(){return n},set cost(l){r!==l&&(r=l,this.getLevel().invalidateNavigationMap())},get cost(){return r},set edges(l){s=l,a=i(),this.getLevel().invalidateNavigationMap()},get edges(){return s},get edgeMask(){return a},getLevel(){return this.parent},tileMove(l){let o=this.getLevel();o.removeFromSpatialMap(this),this.tilePos=this.tilePos.add(l),o.insertIntoSpatialMap(this),o.trigger("spatialMapChanged")},moveLeft(){this.tileMove(x(-1,0))},moveRight(){this.tileMove(x(1,0))},moveUp(){this.tileMove(x(0,-1))},moveDown(){this.tileMove(x(0,1))}}}var Yr=class{name;duration;loops;direction;easing;interpolation;isFinished;timing;easings;relative;constructor(e,t,n){this.name=e,this.duration=t.duration,this.loops=t.loops||0,this.direction=t.direction||"forward",this.easing=t.easing||tn.linear,this.interpolation=t.interpolation||"linear",this.isFinished=!1,this.timing=t.timing,this.easings=t.easings,this.relative=n}update(e,t){return!0}getLowerKeyIndexAndRelativeTime(e,t,n){let r=t-1,s=e/this.duration;if(this.loops!==0&&s>=this.loops)return[r,0,!0];let i=Math.trunc(s);if(s-=i,(this.direction=="reverse"||this.direction=="ping-pong"&&i&1)&&(s=1-s),n){let a=0;for(;n[a+1]!==void 0&&n[a+1]<s;)a++;return a>=r?[r,0,!0]:[a,(s-n[a])/(n[a+1]-n[a]),!1]}else{let a=Math.floor((t-1)*s);return[a,(s-a/r)*r,!1]}}setValue(e,t,n){if(this.relative)switch(t){case"pos":e.pos=e.base.pos.add(n);break;case"angle":e.angle=e.base.angle+n;break;case"scale":e.scale=e.base.scale.scale(n);break;case"opacity":e.opacity=e.base.opacity*n;break;default:e[t]=n}else e[t]=n}serialize(){let e={duration:this.duration,keys:[]};return this.loops&&(e.loops=this.loops),this.direction!=="forward"&&(e.direction=this.direction),this.easing!=tn.linear&&(e.easing=this.easing.name),this.interpolation!=="linear"&&(e.interpolation=this.interpolation),this.timing&&(e.timing=this.timing),this.easings&&(e.easings=this.easings.map(t=>this.easing.name)),e}};function ds(e,t){return t.add(t.sub(e))}var Cu=class extends Yr{keys;constructor(e,t,n,r){super(e,n,r),this.keys=t}update(e,t){let[n,r,s]=this.getLowerKeyIndexAndRelativeTime(t,this.keys.length,this.timing);if(r==0||this.interpolation==="none")this.setValue(e,this.name,this.keys[n]);else{let i=this.easings?this.easings[n]:this.easing;this.setValue(e,this.name,Te(this.keys[n],this.keys[n+1],i(r)))}return s}serialize(){return Object.assign(super.serialize(),{keys:this.keys})}},Pu=class extends Yr{keys;curves;dcurves;constructor(e,t,n,r,s){if(super(e,n,r),this.keys=t,this.interpolation==="spline"){this.curves=[],s&&(this.dcurves=[]);for(let i=0;i<this.keys.length-1;i++){let a=this.keys[i],l=i+1,o=this.keys[l],u=i>0?this.keys[i-1]:ds(o,a),c=l<this.keys.length-1?this.keys[l+1]:ds(a,o);this.curves.push(In(u,a,o,c)),s&&this.dcurves?.push(In(u,a,o,c,Sa))}}}update(e,t){let[n,r,s]=this.getLowerKeyIndexAndRelativeTime(t,this.keys.length,this.timing);if(r==0||this.interpolation==="none")this.setValue(e,this.name,this.keys[n]);else{let i=this.easings?this.easings[n]:this.easing;switch(this.interpolation){case"linear":this.setValue(e,this.name,this.keys[n].lerp(this.keys[n+1],i(r)));break;case"slerp":this.setValue(e,this.name,this.keys[n].slerp(this.keys[n+1],i(r)));break;case"spline":if(this.curves){this.setValue(e,this.name,this.curves[n](i(r))),this.dcurves&&this.setValue(e,"angle",this.dcurves[n](i(r)).angle());break}}}return s}serialize(){return Object.assign(super.serialize(),{keys:this.keys.map(e=>[e.x,e.y])})}},Tu=class extends Yr{keys;constructor(e,t,n,r){super(e,n,r),this.keys=t}update(e,t){let[n,r,s]=this.getLowerKeyIndexAndRelativeTime(t,this.keys.length,this.timing);if(r==0||this.interpolation=="none")this.setValue(e,this.name,this.keys[n]);else{let i=this.easings?this.easings[n]:this.easing;this.setValue(e,this.name,this.keys[n].lerp(this.keys[n+1],i(r)))}return s}serialize(){return Object.assign(super.serialize(),{keys:this.keys})}};function qu(e={}){let t=[],n=0,r=!1;return{id:"animate",require:e.followMotion?["rotate"]:void 0,base:{pos:x(0,0),angle:0,scale:x(1,1),opacity:1},animation:{paused:!1,seek(s){n=Ze(s,0,this.duration),t.forEach(i=>{i.isFinished=!1}),r=!1},get duration(){return t.reduce((s,i)=>Math.max(i.duration,s),0)}},add(){e.relative&&(this.has("pos")&&(this.base.pos=this.pos.clone()),this.has("rotate")&&(this.base.angle=this.angle),this.has("scale")&&(this.base.scale=this.scale),this.has("opacity")&&(this.base.opacity=this.opacity))},update(){if(this.animation.paused)return;let s=!0,i;n+=ye();for(let a of t)i=a.update(this,n),i&&!a.isFinished&&(a.isFinished=!0,this.trigger("animateChannelFinished",a.name)),s&&=i;s&&!r&&(r=!0,this.trigger("animateFinished"))},animate(s,i,a){r=!1,this.unanimate(s),typeof i[0]=="number"?t.push(new Cu(s,i,a,e.relative||!1)):i[0]instanceof E?t.push(new Pu(s,i,a,e.relative||!1,s==="pos"&&(e.followMotion||!1))):i[0]instanceof W&&t.push(new Tu(s,i,a,e.relative||!1))},unanimate(s){let i=t.findIndex(a=>a.name===s);i>=0&&t.splice(i,1)},unanimateAll(){t.splice(0,t.length)},onAnimateFinished(s){return this.on("animateFinished",s)},onAnimateChannelFinished(s){return this.on("animateChannelFinished",s)},serializeAnimationChannels(){return t.reduce((s,i)=>(s[i.name]=i.serialize(),s),{})},serializeAnimationOptions(){let s={};return e.followMotion&&(s.followMotion=!0),e.relative&&(s.relative=!0),s}}}function Ci(e,t){let n={name:e.name};return e.has("animate")&&(n.channels=e.serializeAnimationChannels(),Object.assign(n,e.serializeAnimationOptions())),e.children.length>0&&(n.children=e.children.filter(r=>r.has("named")).map(r=>Ci(r,r.name))),n}function hs(e=2,t=1){let n=0;return{require:["scale"],update(){let r=Math.sin(n*e)*t;r<0&&this.destroy(),this.scale=x(r),n+=ye()}}}function Iu(e,t){if(e==null)throw new Error("health() requires the initial amount of hp");return{id:"health",hurt(n=1){this.setHP(e-n),this.trigger("hurt",n)},heal(n=1){let r=e;this.setHP(e+n),this.trigger("heal",e-r)},hp(){return e},maxHP(){return t??null},setMaxHP(n){t=n},setHP(n){e=t?Math.min(t,n):n,e<=0&&this.trigger("death")},onHurt(n){return this.on("hurt",n)},onHeal(n){return this.on("heal",n)},onDeath(n){return this.on("death",n)},inspect(){return`health: ${e}`}}}function Bu(e,t={}){if(e==null)throw new Error("lifespan() requires time");let n=t.fade??0;return{id:"lifespan",require:["opacity"],add(){h.game.root.wait(e,()=>{this.opacity=this.opacity??1,n>0?h.game.root.tween(this.opacity,0,n,r=>this.opacity=r,tn.linear).onEnd(()=>{this.destroy()}):this.destroy()})}}}function Du(e){return{id:"named",name:e}}function Ru(e,t,n){if(!e)throw new Error("state() requires an initial state");let r={};function s(o){r[o]||(r[o]={enter:new Se,end:new Se,update:new Se,draw:new Se})}function i(o,u,c){return s(u),r[u][o].add(c)}function a(o,u,...c){s(u),r[u][o].trigger(...c)}let l=!1;return{id:"state",state:e,enterState(o,...u){if(l=!0,t&&!t.includes(o))throw new Error(`State not found: ${o}`);let c=this.state;if(n){if(!n?.[c])return;let m=typeof n[c]=="string"?[n[c]]:n[c];if(!m.includes(o))throw new Error(`Cannot transition state from "${c}" to "${o}". Available transitions: ${m.map(d=>`"${d}"`).join(", ")}`)}a("end",c,...u),this.state=o,a("enter",o,...u),a("enter",`${c} -> ${o}`,...u)},onStateTransition(o,u,c){return i("enter",`${o} -> ${u}`,c)},onStateEnter(o,u){return i("enter",o,u)},onStateUpdate(o,u){return i("update",o,u)},onStateDraw(o,u){return i("draw",o,u)},onStateEnd(o,u){return i("end",o,u)},update(){l||(a("enter",e),l=!0),a("update",this.state)},draw(){a("draw",this.state)},inspect(){return`state: ${this.state}`}}}function Pi(e){return{id:"stay",stay:!0,scenesToStay:e}}function Fu(e=!0,t){let n,r;return{id:"textInput",hasFocus:e,require:["text"],typedText:"",add(){let s=()=>{this.text=this.typedText.replace(/([\[\\])/g,"\\$1")};n=h.k.onCharInput(i=>{this.hasFocus&&(!t||this.typedText.length<t)&&(h.k.isKeyDown("shift")?this.typedText+=i.toUpperCase():this.typedText+=i,s())}),r=h.k.onKeyPressRepeat("backspace",()=>{this.hasFocus&&(this.typedText=this.typedText.slice(0,-1),s())})},destroy(){n.cancel(),r.cancel()}}}function Sr(e=1e3){return{id:"timer",maxLoopsPerFrame:e,loop(t,n,r=1/0,s=!1){let i=s?0:t,a=new Se,l=this.onUpdate(()=>{i+=h.app.state.dt;for(let o=0;i>=t&&o<this.maxLoopsPerFrame;o++)if(r--,n(),i-=t,r<=0){l.cancel(),a.trigger();return}});return{get paused(){return l.paused},set paused(o){l.paused=o},cancel:l.cancel,onEnd(o){a.add(o)},then(o){return a.add(o),this}}},wait(t,n){return this.loop(t,n??(()=>{}),1,!0)},tween(t,n,r,s,i=tn.linear){let a=0,l=[],o=this.onUpdate(()=>{a+=h.app.state.dt;let u=Math.min(a/r,1);s(Te(t,n,i(u))),u===1&&(o.cancel(),s(n),l.forEach(c=>c()))});return{get paused(){return o.paused},set paused(u){o.paused=u},onEnd(u){l.push(u)},then(u){return this.onEnd(u),this},cancel(){o.cancel()},finish(){o.cancel(),s(n),l.forEach(u=>u())}}}}}var Er=0;function Ou(){return Er>0}function Hu(e={}){let t={},n=new Set,r=[];return{id:"area",collisionIgnore:e.collisionIgnore??[],add(){Er++,this.area.cursor&&r.push(this.onHover(()=>h.app.setCursor(this.area.cursor))),r.push(this.onCollideUpdate((s,i)=>{if(!s.id)throw new Error("area() requires the object to have an id");t[s.id]||this.trigger("collide",s,i),i&&(t[s.id]=i,n.add(s.id))}))},destroy(){Er--;for(let s of r)s.cancel()},fixedUpdate(){for(let s in t)n.has(Number(s))||(this.trigger("collideEnd",t[s].target),delete t[s]);n.clear()},drawInspect(){let s=this.localArea();Fe(),ue(this.area.offset);let i={outline:{width:4/Ks(),color:_(0,0,255)},anchor:this.anchor,fill:!1,fixed:yt(this)};s instanceof re?He({...i,pos:s.pos,width:s.width*this.area.scale.x,height:s.height*this.area.scale.y}):s instanceof Ee?lt({...i,pts:s.pts,scale:this.area.scale}):s instanceof qe&&Ht({...i,pos:s.center,radius:s.radius}),Pe()},area:{shape:e.shape??null,scale:e.scale?x(e.scale):x(1),offset:e.offset??x(0),cursor:e.cursor??null},isClicked(){return h.app.isMousePressed()&&this.isHovering()},isHovering(){let s=yt(this)?h.k.mousePos():h.k.toWorld(h.k.mousePos());return this.hasPoint(s)},checkCollision(s){if(!s.id)throw new Error("checkCollision() requires the object to have an id");return t[s.id]??null},getCollisions(){return Object.values(t)},isColliding(s){if(!s.id)throw new Error("isColliding() requires the object to have an id");return!!t[s.id]},isOverlapping(s){if(!s.id)throw new Error("isOverlapping() requires the object to have an id");let i=t[s.id];return i&&i.hasOverlap()},onClick(s,i="left"){let a=this.onMousePress(i,()=>{this.isHovering()&&s()});return r.push(a),a},onHover(s){let i=!1;return this.onUpdate(()=>{i?i=this.isHovering():this.isHovering()&&(i=!0,s())})},onHoverUpdate(s){return this.onUpdate(()=>{this.isHovering()&&s()})},onHoverEnd(s){let i=!1;return this.onUpdate(()=>{i?this.isHovering()||(i=!1,s()):i=this.isHovering()})},onCollide(s,i){if(typeof s=="function"&&i===void 0)return this.on("collide",s);if(typeof s=="string")return this.onCollide((a,l)=>{a.is(s)&&i?.(a,l)});throw new Error("onCollide() requires either a function or a tag")},onCollideUpdate(s,i){if(typeof s=="function"&&i===void 0)return this.on("collideUpdate",s);if(typeof s=="string")return this.on("collideUpdate",(a,l)=>a.is(s)&&i?.(a,l));throw new Error("onCollideUpdate() requires either a function or a tag")},onCollideEnd(s,i){if(typeof s=="function"&&i===void 0)return this.on("collideEnd",s);if(typeof s=="string")return this.on("collideEnd",a=>a.is(s)&&i?.(a));throw new Error("onCollideEnd() requires either a function or a tag")},hasPoint(s){return dt(this.worldArea(),s)},resolveCollision(s){let i=this.checkCollision(s);i&&!i.resolved&&(this.pos=this.pos.add(i.displacement),i.resolved=!0)},localArea(){return this.area.shape?this.area.shape:this.renderArea()},worldArea(){let s=this.localArea();if(!(s instanceof Ee||s instanceof re))throw new Error("Only support polygon and rect shapes for now");let i=this.transform.clone().translate(this.area.offset).scale(x(this.area.scale??1));if(s instanceof re){let a=Ot(this.anchor||Un).add(1,1).scale(-.5).scale(s.width,s.height);i.translate(a)}return s.transform(i)},screenArea(){let s=this.worldArea();return yt(this)?s:s.transform(h.game.cam.transform)},inspect(){return this.area.scale?.x==this.area.scale?.y?`area: ${this.area.scale?.x?.toFixed(1)}x`:`area: (${this.area.scale?.x?.toFixed(1)}x, ${this.area.scale.y?.toFixed(1)}y)`}}}function ju(e={}){let t=null,n=null,r=!1,s=x(0),i=null,a=null,l;return{id:"body",require:["pos"],vel:x(0),drag:e.drag??0,jumpForce:e.jumpForce??za,gravityScale:e.gravityScale??1,isStatic:e.isStatic??!1,mass:e.mass??1,add(){if(i=this.pos.clone(),a=this.pos.clone(),l=this.pos.clone(),this.mass===0)throw new Error("Can't set body mass to 0");this.has("area")&&(this.onCollideUpdate((o,u)=>{if(!u||!o.has("body")||u.resolved)return;this.trigger("beforePhysicsResolve",u);let c=u.reverse();if(o.trigger("beforePhysicsResolve",c),!(u.resolved||c.resolved)&&!(this.isStatic&&o.isStatic)){if(!this.isStatic&&!o.isStatic){let m=this.mass+o.mass;this.pos=this.pos.add(u.displacement.scale(o.mass/m)),o.pos=o.pos.add(u.displacement.scale(-this.mass/m)),this.transform=$t(this),o.transform=$t(o)}else{let m=!this.isStatic&&o.isStatic?u:u.reverse();m.source.pos=m.source.pos.add(m.displacement),m.source.transform=$t(m.source)}u.resolved=!0,this.trigger("physicsResolve",u),o.trigger("physicsResolve",u.reverse())}}),this.onPhysicsResolve(o=>{if(h.game.gravity)if(o.isBottom()&&this.isFalling()){this.vel=this.vel.reject(h.game.gravity.unit());let u=t;t=o.target,u!=t&&(n=o.target.pos),r?r=!1:u||(this.trigger("ground",t),o.target.trigger("land",this))}else o.isTop()&&this.isJumping()&&(this.vel=this.vel.reject(h.game.gravity.unit()),this.trigger("headbutt",o.target),o.target.trigger("headbutted",this))}))},update(){t&&this.isColliding(t)&&t.exists()&&t.has("body")&&(n&&!t.pos.eq(n)&&e.stickToPlatform!==!1&&this.moveBy(t.pos.sub(n)),n=t.pos);let o=yr();o&&(this.pos.x==l.x&&(this.pos.x=Te(i.x,a.x,o/mr()),l.x=this.pos.x),this.pos.y==l.y&&(this.pos.y=Te(i.y,a.y,o/mr()),l.y=this.pos.y))},fixedUpdate(){if(i&&(this.pos.x==l.x&&(this.pos.x=i.x),this.pos.y==l.y&&(this.pos.y=i.y),i=null),h.game.gravity&&!this.isStatic){r&&(t=null,n=null,this.trigger("fallOff"),r=!1),t&&(!this.isColliding(t)||!t.exists()||!t.has("body"))&&(r=!0);let o=this.vel.clone();this.vel=this.vel.add(h.game.gravity.scale(this.gravityScale*ye()));let u=e.maxVelocity??Ya;this.vel.slen()>u*u&&(this.vel=this.vel.unit().scale(u)),o.dot(h.game.gravity)<0&&this.vel.dot(h.game.gravity)>=0&&this.trigger("fall")}if(this.vel.x+=s.x*ye(),this.vel.y+=s.y*ye(),this.vel.x*=1-this.drag*ye(),this.vel.y*=1-this.drag*ye(),this.move(this.vel),yr()){i=this.pos.clone();let o=this.vel.add(s.scale(ye()));a=this.pos.add(o.scale(ye())),l=this.pos.clone()}s.x=0,s.y=0},onPhysicsResolve(o){return this.on("physicsResolve",o)},onBeforePhysicsResolve(o){return this.on("beforePhysicsResolve",o)},curPlatform(){return t},isGrounded(){return t!==null},isFalling(){return this.vel.dot(kt())>0},isJumping(){return this.vel.dot(kt())<0},applyImpulse(o){this.isStatic||(this.vel=this.vel.add(o))},addForce(o){this.isStatic||(s.x+=o.x/this.mass,s.y+=o.y/this.mass)},jump(o){this.isStatic||(t=null,n=null,this.vel=kt().scale(-o||-this.jumpForce))},onGround(o){return this.on("ground",o)},onFall(o){return this.on("fall",o)},onFallOff(o){return this.on("fallOff",o)},onHeadbutt(o){return this.on("headbutt",o)},onLand(o){return this.on("land",o)},onHeadbutted(o){return this.on("headbutted",o)},inspect(){return`gravityScale: ${this.gravityScale}x`}}}function Lu(e=2){let t=e;return{id:"doubleJump",require:["body"],numJumps:e,add(){this.onGround(()=>{t=this.numJumps})},doubleJump(n){t<=0||(t<this.numJumps&&this.trigger("doubleJump"),t--,this.jump(n))},onDoubleJump(n){return this.on("doubleJump",n)},inspect(){return`jumpsLeft: ${t}`}}}function Nu(e){return{id:"surfaceEffector",require:["area"],speed:e.speed,speedVariation:e.speedVariation??0,forceScale:e.speedVariation??.9,add(){this.onCollideUpdate("body",(t,n)=>{let r=n?.normal.normal(),s=t.vel.project(r),i=r?.scale(this.speed)?.sub(s);t.addForce(i?.scale(t.mass*this.forceScale))})}}}function Uu(e){return{id:"areaEffector",require:["area"],useGlobalAngle:e.useGlobalAngle||!1,forceAngle:e.forceAngle,forceMagnitude:e.forceMagnitude,forceVariation:e.forceVariation??0,linearDrag:e.linearDrag??0,add(){this.onCollideUpdate("body",(t,n)=>{if(!t.has("body"))return;let r=E.fromAngle(this.forceAngle).scale(this.forceMagnitude);t.addForce(r),this.linearDrag&&t.addForce(t.vel.scale(-this.linearDrag))})}}}function Gu(e){return{id:"pointEffector",require:["area","pos"],forceMagnitude:e.forceMagnitude,forceVariation:e.forceVariation??0,distanceScale:e.distanceScale??1,forceMode:e.forceMode||"inverseLinear",linearDrag:e.linearDrag??0,add(){this.onCollideUpdate("body",(t,n)=>{let r=this.pos.sub(t.pos),s=r.len(),i=s*this.distanceScale/10,a=this.forceMode==="constant"?1:this.forceMode==="inverseLinear"?1/i:1/i**2,l=r.scale(this.forceMagnitude*a/s);t.addForce(l),this.linearDrag&&t.addForce(t.vel.scale(-this.linearDrag))})}}}function Ku(e){return{id:"constantForce",require:["body"],force:e.force,update(){this.force&&this.addForce(this.force)}}}function zu(e){return{id:"platformEffector",require:["area","body"],surfaceArc:e.surfaceArc??180,useOneWay:e.useOneWay??!1,add(){this.onBeforePhysicsResolve(t=>{let n=t.target.vel,r=kt().scale(-1).angleBetween(n);Math.abs(r)>this.surfaceArc/2&&t.preventResolution()})}}}function Yu(e){return{id:"buoyancyEffector",require:["area"],surfaceLevel:e.surfaceLevel,density:e.density??1,linearDrag:e.linearDrag??1,angularDrag:e.angularDrag??.2,flowAngle:e.flowAngle??0,flowMagnitude:e.flowMagnitude??0,flowVariation:e.flowVariation??0,add(){this.onCollideUpdate("body",(t,n)=>{let r=t,s=r.worldArea(),[i,a]=s.cut(x(-100,this.surfaceLevel),x(100,this.surfaceLevel));i&&(this.applyBuoyancy(r,i),this.applyDrag(r,i)),this.flowMagnitude&&r.addForce(E.fromAngle(this.flowAngle).scale(this.flowMagnitude))})},applyBuoyancy(t,n){let r=this.density*n.area(),s=x(0,1).scale(-r);t.addForce(s)},applyDrag(t,n){let r=t.vel,s=this.density*this.linearDrag,i=r.scale(-s);t.addForce(i)}}}function Mr(e){if(!e)throw new Error("Please define an anchor");return{id:"anchor",anchor:e,inspect(){return typeof this.anchor=="string"?"anchor: "+this.anchor:"anchor: "+this.anchor.toString()}}}function Ti(){return{id:"fixed",fixed:!0}}function Vu(e,t){return{id:"follow",require:["pos"],follow:{obj:e,offset:t??x(0)},add(){e.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))},update(){e.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))}}}function Xu(e){let t=h.game.layers?.indexOf(e);return{id:"layer",get layerIndex(){return t??null},get layer(){return t?h.game.layers?.[t]??null:null},set layer(n){if(t=h.game.layers?.indexOf(n),t==-1)throw Error("Invalid layer name")},inspect(){return`layer: ${this.layer}`}}}function Wu(e,t){let n=typeof e=="number"?E.fromAngle(e):e.unit();return{id:"move",require:["pos"],update(){this.move(n.scale(t))}}}function Qu(e={}){let t=!1,n=new re(x(0),Ae(),ve()),r=new re(x(0),0,0),s=i=>{i.isOffScreen()?(t||(i.trigger("exitView"),t=!0),e.hide&&(i.hidden=!0),e.pause&&(i.paused=!0),e.destroy&&i.destroy()):(t&&(i.trigger("enterView"),t=!1),e.hide&&(i.hidden=!1),e.pause&&(i.paused=!1))};return{id:"offscreen",require:["pos"],offscreenDistance:e.distance??_r,isOffScreen(){let i=this.screenPos();if(!i)return!1;if(n.width=Ae(),n.height=ve(),!this.offscreenDistance&&this.width&&this.height)return r.width=this.width,r.height=this.height,r.pos=this.pos,r.collides(n);let a=this.offscreenDistance?this.offscreenDistance:_r;return!jn(n,i)&&n.sdistToPoint(i)>a*a},onExitScreen(i){return this.on("exitView",i)},onEnterScreen(i){return this.on("enterView",i)},add(){e.pause&&e.unpause?li(()=>s(this)):this.onUpdate(()=>s(this))}}}function On(...e){return{id:"pos",pos:x(...e),moveBy(...t){this.pos=this.pos.add(x(...t))},move(...t){this.moveBy(x(...t).scale(ye()))},moveTo(...t){if(typeof t[0]=="number"&&typeof t[1]=="number")return this.moveTo(x(t[0],t[1]),t[2]);let n=t[0],r=t[1];if(r===void 0){this.pos=x(n);return}let s=n.sub(this.pos);if(s.len()<=r*ye()){this.pos=x(n);return}this.move(s.unit().scale(r))},worldPos(t=null){return t?(this.pos=this.pos.add(this.fromWorld(t)),null):this.parent?this.parent.transform.multVec2(this.pos):this.pos},toWorld(t){return this.parent?this.parent.transform.multVec2(this.pos.add(t)):this.pos.add(t)},fromWorld(t){return this.parent?this.parent.transform.invert().multVec2(t).sub(this.pos):t.sub(this.pos)},screenPos(t=null){if(t)return this.pos=this.pos.add(this.fromScreen(t)),null;{let n=this.worldPos();return n?yt(this)?n:br(n):null}},toScreen(t){let n=this.toWorld(t);return yt(this)?n:br(n)},fromScreen(t){return yt(this)?this.fromWorld(t):this.fromWorld(wi(t))},toOther(t,n){return t.fromWorld(this.toWorld(n))},fromOther(t,n){return t.toOther(this,n)},inspect(){return`pos: (${Math.round(this.pos.x)}x, ${Math.round(this.pos.y)}y)`},drawInspect(){Ht({color:_(255,0,0),radius:4/Ks()})}}}function Ju(e){return{id:"rotate",angle:e??0,rotateBy(t){this.angle+=t},rotateTo(t){this.angle=t},inspect(){return`angle: ${Math.round(this.angle)}`}}}function Hn(...e){if(e.length===0)return Hn(1);let t=x(...e);return{id:"scale",set scale(n){if(!(n instanceof E))throw Error("The scale property on scale is a vector. Use scaleTo or scaleBy to set the scale with a number.");t=x(n)},get scale(){return t},scaleTo(...n){t=x(...n)},scaleBy(...n){t=t.scale(x(...n))},inspect(){return t.x==t.y?`scale: ${t.x.toFixed(1)}x`:`scale: (${t.x.toFixed(1)}x, ${t.y.toFixed(1)}y)`}}}function Zu(e){return{id:"z",z:e,inspect(){return`z: ${this.z}`}}}var $u="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOcAAACDCAYAAAB2kQxsAAAAAXNSR0IArs4c6QAABqxJREFUeJztnU1yFDkQRtMEB+AG7Fk6fBPO6ZsQLGc/N5gbMAtosJvqKv2kpPxS763A0W5XSXqVqZ+SngzgF58/fflx/7N///vnacW1gBkFD2Z2LOYNBF3Dx9UXAGs5kxLWwhNxU2qlJHrOhwLfkNZoiaBzIa3dCFJYLXgSboKXmETPeVDQyamR8vX55fe/v37/9vBzCDoH0tqktEpZ+t0IOh4KOBm16euZmETPtVDAiRgRLRF0HRRuEkrFrE1hzR4Lipxj+bD6AqCPz5++/Bgp5tXfdv1CeAdPPmFmSkn0nE+a0drdFm6XiOkdKWEuKRptTXqlLuqqFNaM6Dkb+T5nbb+npo8WjZVinqFantFJk9bWojaRThq7HzKN8wiPJ7aCoJHEZN5zHvJp7RE1DTV6SnZ1fa/PL1MjJtF5HmnT2tJF3GZ/BIj05I8ULUtR6ypER7ogjxpw61rRGxEal4KYjNyORzatbUlHSxr06tFcBTHPiN5NUEJWzlZKG/aKRqYk5tl1IKgPafucZ7w+vxSluLP6olHnL6MQQfYV6bpk/+BRZXm+cXHEiApSipZHlE6tRBDMkxmyysl5VsmtjXiFoJmiZU35ZWK0oNv1OY+omSv0GDDKJCaMI42cHg25dvFCi6QZxVS6ViVSpLUz38A4oiS9ySjlW2althGWKZrN6XNuOVpbwq0ReIzqZhfTrHwE/PZZuEYqcnqO0tZQGxVqRylprLGIEDXNkLOKEakbYsYiiphmiQaEZuD9BghixiKSmGYJIueqBt4TRZEyHtHENCNyNtMaRREzHhHFNBOKnKv7myVcVXKka4WfRBXTjMjpypl8iBmP6MsOmed0Bgk1UHjxXlpORIAWIqeybyGtha1QEdNMRM5s7wLCGpTENBORE6AXNTHNkBM2QFFMM4F5ToX5TYiLqphmRE7YmMhimiEnJEb9XBdJOUlp4Qp1Mc1E5QQ4I/qyvFJCy8n8JnijEjXNAi3fQ0TwIEM6e2OqnAgII8kkptkgOZEQZlN6BquZjqhVFxlBOkZq4Z6WASAFQQ8jZwQJ70FK8CTiaeb3fDSLJyMiwiwiS/q0SkwEBE+85jYjSTpcTiSE2WQRtVlOpAMVemVdtjXmlZxICFlQk/TJjHcmYS96JJ0p6KmcZggKeWmVdPopYwgKuxJVUuQE+EU0Sd99KYICxJH0ry9DUIA/rFy3WyWnGYLCnqyQ9PCXERTgmJmSPvwlBAU4p1bUWklPP1yytA9JYWdGRtLLDyEowDUjomiRwQgKUIZnJC3OgREUoByPSDpkDyEkBfhJj6RNQ7xEUYA6aiS9Cdo8SUoUBaijVtCuFQwICtBGiajdawARFKCNK0HdVtEjKUAd0+Q0q9v/FklhJ1rmP4e8JEoUBejfq2jYNgtEUdgJzwN7u6dSSkBQyMSME7O7FyHUQpoLCqw8rv5o+d6Uw3NvfzjagUkAZvOlLH1lLMyx8wCzWBEhW3ZDmLZ7NTsrwCpmyui5A1+IPidigjcjhZy14/vytBYxwRsPMVcf/2c2QU72wQUVIgj5lqFyIiZEJ5qQb1me1gLMJLKM93wY9cVETYiGkphmg+RETFhJljY2LHICQB/uchI1AXxwlRMxAfwgrYVtUHvxwk1OoiaAL8MjJ2ICtOEip1q6APnJEBS6VwiRzp4vtM5YBvf3m/EeI8DyvUZK33z4+v1bqsZ7dN+3n2W6zwgMO44hY0X1vIqkXh419x7lXh9ds8oyviFyRqmcXrxf2FUtF89ymFkG6nI2p7WZB4FGvUWfLcVt4ahsdy+TR7ifz6lc0F5v0GfalmXldpE3esrr6PrTR84sjNjS4kpQhQhaUi4lD6KR1xK9DHupfoKoR02vSFDy9FWNoKVivv1/lG7OfZkqR043OZUbWgmtFaomaGl51ZTHCnFv5bqNnFGjZvRtEFUEHSHmI1ZHWgVBXZ5+sxvX7ANlPChpjKsknSllKaPlRU4nZo0Yjq6wiIJGFPMML2mj3M8ZRRe4QkzF6FhCJEFbBn4i0iKswn11yenZiLLKeMRqQdWiZSmlkqrcV9d0gPfksAcqBW+2ZqAoq5gZGSrnTtGwlVmCIqUepxWxerj7iIyNZ7SgiKmJhJw7NJpRgiKmLuHl3KnReA4UIaU+y+WkcbzHQ1DEzMGQ9aJH0BDK6RE0y9wlTDp2HuppERQxc0FFBaZGUMTMB5UlQG/fHyk1odJEaBUUMXWh4oSoFRQxtaHyxMi2uBseQwUKciUoYuaAShTlkaCImQcqUph7QREzF/8DSS/2GZ2/N/sAAAAASUVORK5CYII=",_u="data:image/png;base64,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",ku=Ki.version,h={k:null,globalOpt:null,gfx:null,game:null,app:null,assets:null,fontCacheCanvas:null,fontCacheC2d:null,debug:null,audio:null,pixelDensity:null,canvas:null,gscale:null,kaSprite:null,boomSprite:null},ed=(e={tagsAsComponents:!0})=>{h.k&&(console.warn("KAPLAY already initialized, you are calling kaplay() multiple times, it may lead bugs!"),h.k.quit()),h.globalOpt=e;let t=e.root??document.body;t===document.body&&(document.body.style.width="100%",document.body.style.height="100%",document.body.style.margin="0px",document.documentElement.style.width="100%",document.documentElement.style.height="100%");let n=e.canvas??t.appendChild(document.createElement("canvas"));h.canvas=n;let r=e.scale??1;h.gscale=r;let s=e.width&&e.height&&!e.stretch&&!e.letterbox;s?(n.width=e.width*r,n.height=e.height*r):(n.width=n.parentElement.offsetWidth,n.height=n.parentElement.offsetHeight);let i=["outline: none","cursor: default"];if(s){let O=n.width,G=n.height;i.push(`width: ${O}px`),i.push(`height: ${G}px`)}else i.push("width: 100%"),i.push("height: 100%");e.crisp&&(i.push("image-rendering: pixelated"),i.push("image-rendering: crisp-edges")),n.style.cssText=i.join(";");let a=e.pixelDensity||1;h.pixelDensity=a,n.width*=a,n.height*=a,n.tabIndex=0;let l=document.createElement("canvas");l.width=256,l.height=256,h.fontCacheCanvas=l;let o=l.getContext("2d",{willReadFrequently:!0});h.fontCacheC2d=o;let u=vo({canvas:n,touchToMouse:e.touchToMouse,gamepads:e.gamepads,pixelDensity:e.pixelDensity,maxFPS:e.maxFPS,buttons:e.buttons});h.app=u;let c=[],m=u.canvas.getContext("webgl",{antialias:!0,depth:!0,stencil:!0,alpha:!0,preserveDrawingBuffer:!0});if(!m)throw new Error("WebGL not supported");let d=m,p=fl(d,{texFilter:e.texFilter}),f=vl(e,p);h.gfx=f;let v=ou();h.audio=v;let y=Wo(p,e.spriteAtlasPadding??0);h.assets=y;let w=nu();h.game=w,w.root.use(Sr());function C(O,G){let Y=new Rn(p,O,G);return{clear:()=>Y.clear(),free:()=>Y.free(),toDataURL:()=>Y.toDataURL(),toImageData:()=>Y.toImageData(),width:Y.width,height:Y.height,draw:ne=>{Oe(),Y.bind(),ne(),Oe(),Y.unbind()},get fb(){return Y}}}function q(){d.clear(d.COLOR_BUFFER_BIT),f.frameBuffer.bind(),d.clear(d.COLOR_BUFFER_BIT),f.bgColor||ot(()=>{sn({width:Ae(),height:ve(),quad:new oe(0,0,Ae()/64,ve()/64),tex:f.bgTex,fixed:!0})}),f.renderer.numDraws=0,f.fixed=!1,f.transformStack.length=0,f.transform=new $e}function F(O,G){f.postShader=O,f.postShaderUniform=G??null}function M(){Oe(),f.lastDrawCalls=f.renderer.numDraws,f.frameBuffer.unbind(),d.viewport(0,0,d.drawingBufferWidth,d.drawingBufferHeight);let O=f.width,G=f.height;f.width=d.drawingBufferWidth/a,f.height=d.drawingBufferHeight/a,Fn({flipY:!0,tex:f.frameBuffer.tex,pos:new E(f.viewport.x,f.viewport.y),width:f.viewport.width,height:f.viewport.height,shader:f.postShader,uniform:typeof f.postShaderUniform=="function"?f.postShaderUniform():f.postShaderUniform,fixed:!0}),Oe(),f.width=O,f.height=G}let A=!1,b={inspect:!1,set timeScale(O){h.app.state.timeScale=O},get timeScale(){return h.app.state.timeScale},showLog:!0,fps:()=>u.fps(),numFrames:()=>u.numFrames(),stepFrame:Mt,drawCalls:()=>f.lastDrawCalls,clearLog:()=>w.logs=[],log:(...O)=>{let G=e.logMax??8,Y=O.length>1?O.concat(" ").join(" "):O[0];w.logs.unshift({msg:Y,time:u.time()}),w.logs.length>G&&(w.logs=w.logs.slice(0,G))},error:O=>b.log(new Error(O.toString?O.toString():O)),curRecording:null,numObjects:()=>U("*",{recursive:!0}).length,get paused(){return A},set paused(O){A=O,O?v.ctx.suspend():v.ctx.resume()}};h.debug=b;function T(O,G){try{return JSON.parse(window.localStorage[O])}catch{return G?(I(O,G),G):null}}function I(O,G){window.localStorage[O]=JSON.stringify(G)}function B(O,...G){let Y=O(Xe),ne;typeof Y=="function"?ne=Y(...G)(Xe):ne=Y;for(let pe in ne)Xe[pe]=ne[pe],e.global!==!1&&(window[pe]=ne[pe]);return Xe}function R(O){let G=u.canvas.captureStream(O),Y=v.ctx.createMediaStreamDestination();v.masterNode.connect(Y);let ne=new MediaRecorder(G),pe=[];return ne.ondataavailable=Z=>{Z.data.size>0&&pe.push(Z.data)},ne.onerror=()=>{v.masterNode.disconnect(Y),G.getTracks().forEach(Z=>Z.stop())},ne.start(),{resume(){ne.resume()},pause(){ne.pause()},stop(){return ne.stop(),v.masterNode.disconnect(Y),G.getTracks().forEach(Z=>Z.stop()),new Promise(Z=>{ne.onstop=()=>{Z(new Blob(pe,{type:"video/mp4"}))}})},download(Z="kaboom.mp4"){this.stop().then(xe=>kr(Z,xe))}}}function H(){return document.activeElement===u.canvas}let V=w.root.add.bind(w.root),X=w.root.readd.bind(w.root),Q=w.root.removeAll.bind(w.root),U=w.root.get.bind(w.root),j=w.root.wait.bind(w.root),ie=w.root.loop.bind(w.root),J=w.root.query.bind(w.root),ee=w.root.tween.bind(w.root),we=_t(null,_u),N=_t(null,$u);h.kaSprite=we,h.boomSprite=N;function ft(){w.root.fixedUpdate()}function Mt(){w.root.update()}class Lt{source;target;normal;distance;resolved=!1;constructor(G,Y,ne,pe,Z=!1){this.source=G,this.target=Y,this.normal=ne,this.distance=pe,this.resolved=Z}get displacement(){return this.normal.scale(this.distance)}reverse(){return new Lt(this.target,this.source,this.normal.scale(-1),this.distance,this.resolved)}hasOverlap(){return!this.displacement.isZero()}isLeft(){return this.displacement.cross(w.gravity||x(0,1))>0}isRight(){return this.displacement.cross(w.gravity||x(0,1))<0}isTop(){return this.displacement.dot(w.gravity||x(0,1))>0}isBottom(){return this.displacement.dot(w.gravity||x(0,1))<0}preventResolution(){this.resolved=!0}}function ln(){if(!Ou())return;let O={},G=e.hashGridSize||64,Y=new $e,ne=[];function pe(Z){if(ne.push(Y.clone()),Z.pos&&Y.translate(Z.pos),Z.scale&&Y.scale(Z.scale),Z.angle&&Y.rotate(Z.angle),Z.transform=Y.clone(),Z.c("area")&&!Z.paused){let xe=Z,rt=xe.worldArea().bbox(),Xn=Math.floor(rt.pos.x/G),Wn=Math.floor(rt.pos.y/G),Qn=Math.ceil((rt.pos.x+rt.width)/G),Jn=Math.ceil((rt.pos.y+rt.height)/G),hn=new Set;for(let We=Xn;We<=Qn;We++)for(let st=Wn;st<=Jn;st++)if(!O[We])O[We]={},O[We][st]=[xe];else if(!O[We][st])O[We][st]=[xe];else{let cn=O[We][st];e:for(let Me of cn){if(Me.paused||!Me.exists()||hn.has(Me.id))continue;for(let _e of xe.collisionIgnore)if(Me.is(_e))continue e;for(let _e of Me.collisionIgnore)if(xe.is(_e))continue e;let Nt=qa(xe.worldArea(),Me.worldArea());if(Nt){let _e=new Lt(xe,Me,Nt.normal,Nt.distance);xe.trigger("collideUpdate",Me,_e);let fn=_e.reverse();fn.resolved=_e.resolved,Me.trigger("collideUpdate",xe,fn)}hn.add(Me.id)}cn.push(xe)}}Z.children.forEach(pe),Y=ne.pop()}pe(w.root)}function un(O){console.error(O),v.ctx.suspend();let G=O.message??String(O)??"Unknown error, check console for more info";u.run(()=>{},()=>{q(),ot(()=>{let Y=Ae(),ne=ve(),pe={size:36,width:Y-64,letterSpacing:4,lineSpacing:4,font:Bn,fixed:!0};He({width:Y,height:ne,color:_(0,0,255),fixed:!0});let Z=vt({...pe,text:"Error",pos:x(32),color:_(255,128,0),fixed:!0});bt(Z),us({...pe,text:G,pos:x(32,32+Z.height+16),fixed:!0}),Pe(),w.events.trigger("error",O)}),M()})}function Yn(O){c.push(O)}function Vn(){w.events.onOnce("frameEnd",()=>{u.quit(),d.clear(d.COLOR_BUFFER_BIT|d.DEPTH_BUFFER_BIT|d.STENCIL_BUFFER_BIT);let O=d.getParameter(d.MAX_TEXTURE_IMAGE_UNITS);for(let G=0;G<O;G++)d.activeTexture(d.TEXTURE0+G),d.bindTexture(d.TEXTURE_2D,null),d.bindTexture(d.TEXTURE_CUBE_MAP,null);d.bindBuffer(d.ARRAY_BUFFER,null),d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,null),d.bindRenderbuffer(d.RENDERBUFFER,null),d.bindFramebuffer(d.FRAMEBUFFER,null),p.destroy(),c.forEach(G=>G())})}let Ct=!0;u.run(()=>{try{y.loaded&&(b.paused||ft(),ln())}catch(O){un(O)}},(O,G)=>{try{O(),y.loaded||At()===1&&!Ct&&(y.loaded=!0,Ys().forEach(Y=>w.events.trigger("loadError",...Y)),w.events.trigger("load")),!y.loaded&&e.loadingScreen!==!1||Ct?(q(),ml(),M()):(b.paused||Mt(),ln(),q(),gl(),e.debug!==!1&&pl(),M()),Ct&&(Ct=!1),w.events.trigger("frameEnd"),G()}catch(Y){un(Y)}}),Gs(),xi();let Xe={_k:h,VERSION:ku,loadRoot:Yo,loadProgress:At,loadSprite:_t,loadSpriteAtlas:_s,loadSound:al,loadMusic:ol,loadBitmapFont:ko,loadFont:$o,loadShader:rl,loadShaderURL:sl,loadAseprite:Zo,loadPedit:el,loadBean:Jo,loadJSON:Vo,load:wr,getSound:$s,getFont:Qs,getBitmapFont:Js,getSprite:Vs,getShader:Zs,getAsset:Xo,Asset:Le,SpriteData:ht,SoundData:rn,width:Ae,height:ve,center:Dn,dt:ye,fixedDt:mr,restDt:yr,time:u.time,screenshot:u.screenshot,record:R,isFocused:H,setCursor:u.setCursor,getCursor:u.getCursor,setCursorLocked:u.setCursorLocked,isCursorLocked:u.isCursorLocked,setFullscreen:u.setFullscreen,isFullscreen:u.isFullscreen,isTouchscreen:u.isTouchscreen,onLoad:Kr,onLoadError:Ql,onLoading:Vl,onResize:Xl,onGamepadConnect:u.onGamepadConnect,onGamepadDisconnect:u.onGamepadDisconnect,onError:Wl,onCleanup:Yn,flash:yi,setCamPos:hi,getCamPos:ci,setCamRot:gi,getCamRot:mi,setCamScale:fi,getCamScale:pi,getCamTransform:Jl,camPos:_l,camScale:kl,camFlash:tu,camRot:eu,camTransform:Zl,shake:$l,toScreen:br,toWorld:wi,setGravity:ru,getGravity:su,setGravityDirection:iu,getGravityDirection:kt,setBackground:Lo,getBackground:No,getGamepads:u.getGamepads,getTreeRoot:gu,add:V,make:zr,destroy:Ei,destroyAll:Q,get:U,query:J,readd:X,pos:On,scale:Hn,rotate:Ju,color:si,opacity:ii,anchor:Mr,area:Hu,sprite:xr,text:vu,polygon:Tl,rect:oi,circle:bl,uvquad:bu,outline:Ml,particles:Pl,body:ju,platformEffector:zu,surfaceEffector:Nu,areaEffector:Uu,pointEffector:Gu,buoyancyEffector:Yu,constantForce:Ku,doubleJump:Lu,shader:ql,textInput:Fu,timer:Sr,fixed:Ti,stay:Pi,health:Iu,lifespan:Bu,named:Du,state:Ru,z:Zu,layer:Xu,move:Wu,offscreen:Qu,follow:Vu,fadeIn:Sl,mask:El,drawon:xl,raycast:ai,tile:Mi,animate:qu,serializeAnimation:Ci,agent:xu,sentry:Mu,patrol:Eu,pathfinder:Su,trigger:Bl,on:Be,onFixedUpdate:Dl,onUpdate:li,onDraw:Rl,onAdd:ui,onDestroy:Fl,onTag:di,onUntag:jl,onUse:Ol,onUnuse:Hl,onClick:Gl,onCollide:Ll,onCollideUpdate:Nl,onCollideEnd:Ul,onHover:Kl,onHoverUpdate:zl,onHoverEnd:Yl,onKeyDown:u.onKeyDown,onKeyPress:u.onKeyPress,onKeyPressRepeat:u.onKeyPressRepeat,onKeyRelease:u.onKeyRelease,onMouseDown:u.onMouseDown,onMousePress:u.onMousePress,onMouseRelease:u.onMouseRelease,onMouseMove:u.onMouseMove,onCharInput:u.onCharInput,onTouchStart:u.onTouchStart,onTouchMove:u.onTouchMove,onTouchEnd:u.onTouchEnd,onScroll:u.onScroll,onHide:u.onHide,onShow:u.onShow,onGamepadButtonDown:u.onGamepadButtonDown,onGamepadButtonPress:u.onGamepadButtonPress,onGamepadButtonRelease:u.onGamepadButtonRelease,onGamepadStick:u.onGamepadStick,onButtonPress:u.onButtonPress,onButtonDown:u.onButtonDown,onButtonRelease:u.onButtonRelease,mousePos:u.mousePos,mouseDeltaPos:u.mouseDeltaPos,isKeyDown:u.isKeyDown,isKeyPressed:u.isKeyPressed,isKeyPressedRepeat:u.isKeyPressedRepeat,isKeyReleased:u.isKeyReleased,isMouseDown:u.isMouseDown,isMousePressed:u.isMousePressed,isMouseReleased:u.isMouseReleased,isMouseMoved:u.isMouseMoved,isGamepadButtonPressed:u.isGamepadButtonPressed,isGamepadButtonDown:u.isGamepadButtonDown,isGamepadButtonReleased:u.isGamepadButtonReleased,getGamepadStick:u.getGamepadStick,isButtonPressed:u.isButtonPressed,isButtonDown:u.isButtonDown,isButtonReleased:u.isButtonReleased,setButton:u.setButton,getButton:u.getButton,pressButton:u.pressButton,releaseButton:u.releaseButton,getLastInputDeviceType:u.getLastInputDeviceType,charInputted:u.charInputted,loop:ie,wait:j,play:uu,setVolume:vi,getVolume:bi,volume:du,burp:Ai,audioCtx:v.ctx,Line:Ie,Rect:re,Circle:qe,Ellipse:nt,Point:ha,Polygon:Ee,Vec2:E,Color:W,Mat4:$e,Quad:oe,RNG:ys,rand:me,randi:ws,randSeed:Wi,vec2:x,rgb:_,hsl2rgb:zi,quad:he,choose:Zi,chooseMultiple:Ji,shuffle:As,chance:Qi,lerp:Te,tween:ee,easings:tn,map:Je,mapc:Yi,wave:ms,deg2rad:ce,rad2deg:wt,clamp:Ze,evaluateQuadratic:fa,evaluateQuadraticFirstDerivative:pa,evaluateQuadraticSecondDerivative:ga,evaluateBezier:Fr,evaluateBezierFirstDerivative:ma,evaluateBezierSecondDerivative:ya,evaluateCatmullRom:wa,evaluateCatmullRomFirstDerivative:Aa,curveLengthApproximation:qs,normalizedCurve:va,hermite:on,cardinal:Is,catmullRom:In,bezier:ba,kochanekBartels:xa,easingSteps:Ta,easingLinear:Ca,easingCubicBezier:Pa,testLineLine:Tr,testRectRect:vs,testRectLine:qr,testRectPoint:jn,testCirclePolygon:Nn,testLinePoint:Ir,testLineCircle:an,isConvex:Fa,triangulate:Ds,NavMesh:Ho,drawSprite:wl,drawText:us,formatText:vt,drawRect:He,drawLine:Jt,drawLines:Gr,drawTriangle:ni,drawCircle:Ht,drawEllipse:ks,drawUVQuad:sn,drawPolygon:lt,drawCurve:ei,drawBezier:hl,drawFormattedText:bt,drawMasked:yl,drawSubtracted:Al,pushTransform:Fe,popTransform:Pe,pushTranslate:ue,pushScale:nn,pushRotate:Rt,pushMatrix:Uo,usePostEffect:F,makeCanvas:C,debug:b,scene:mu,getSceneName:Au,go:yu,onSceneLeave:wu,layers:pu,getLayers:cu,setLayers:Si,getDefaultLayer:fu,addLevel:Il,getData:T,setData:I,download:Hr,downloadJSON:Za,downloadText:Ns,downloadBlob:kr,plug:B,ASCII_CHARS:Rs,canvas:u.canvas,addKaboom:hu,LEFT:E.LEFT,RIGHT:E.RIGHT,UP:E.UP,DOWN:E.DOWN,RED:W.RED,GREEN:W.GREEN,BLUE:W.BLUE,YELLOW:W.YELLOW,MAGENTA:W.MAGENTA,CYAN:W.CYAN,WHITE:W.WHITE,BLACK:W.BLACK,quit:Vn,KEvent:Se,KEventHandler:en,KEventController:St,cancel:()=>Os};h.k=Xe;let dn=e.plugins;if(dn&&dn.forEach(B),e.global!==!1)for(let O in Xe)window[O]=Xe[O];return e.focus!==!1&&u.canvas.focus(),Xe},td=ed;const k=td({width:1280,height:720,letterbox:!0,global:!1});let tr=null;function jt(){function e(){let t=null,n=null,r=!1,s="english",i=30,a={},l=!1,o=null;return{setPreviousScene(u){t=u},getPreviousScene(){return t},setCurrentScene(u){n=u},getCurrentScene(){return n},setFreezePlayer(u){r=u},getFreezePlayer(){return r},setFontSize(u){i=u},getFontSize(){return i},setLanguage(u){s=u},getLanguage(){return s},setChestOpened(u){a[u]=!0},getChestOpened(u){return!!a[u]},getOpenedChests(){return a},setPrisonDoorOpened(u){l=u},getPrisonDoorOpened(){return l},setCurrentSong(u){o=u},getCurrentSong(){return o},pauseCurrentSong(){o&&typeof o.pause=="function"&&(o.pause(),o=null)}}}return{getInstance(){return tr||(tr=e()),tr}}}function nd(){let e=null;function t(){let n=0;return{setNbTimesTalkedOldman(r){n=r},getNbTimesTalkedOldman(){return n}}}return{getInstance(){return e||(e=t()),e}}}function rd(){let e=null;function t(){let n=0,r=!1;return{setNbTimesTalkedLumberjack(s){n=s},getNbTimesTalkedLumberjack(){return n},getHasMentionedGift(){return r},setHasMentionedGift(s){r=s}}}return{getInstance(){return e||(e=t()),e}}}function sd(){let e=null;function t(){let n=!0;const r=3;let s=r,i=!1,a=0,l=[],o=!1,u=!1;return{setIsSwordEquipped(c){n=c},getIsSwordEquipped(){return n},setHealth(c){s=Math.max(0,Math.min(c,r))},getHealth(){return s},setHasKey(c){hasKey=c},getHasKey(){return hasKey},getMaxHealth(){return r},getPotions(){return a},addPotion(c=1){a+=c,c>0&&(o=!0)},usePotion(){return a>0?(a--,!0):!1},debug(){console.log(`Health: ${s}/${r}, Potions: ${a}`)},setHasHadPotion(c){o=c},getHasHadPotion(){return o},setHasBasementKey(c){i=c},getHasBasementKey(){return i},setKeys(c){l=c},getKeys(){return[...l]},addKey(c){l.includes(c)||l.push(c)},hasKey(c){return l.includes(c)},setHasPrisonKey(c){u=c},getHasPrisonKey(){return u}}}return{getInstance(){return e||(e=t()),e}}}function id(){let e=null;function t(){let n=0;return{setNbOfTimesTalkedShopkeeper(r){n=r},getNbOfTimesTalkedShopkeeper(){return n}}}return{getInstance(){return e||(e=t()),e}}}function ad(){let e=null;function t(){let n=0;return{setNbTimesTalkedPrisoner(r){n=r},getNbTimesTalkedPrisoner(){return n}}}return{getInstance(){return e||(e=t()),e}}}function od(){let e=null;function t(){let n=0;return{setNbOfTimesTalkedWizard(r){n=r},getNbOfTimesTalkedWizard(){return n}}}return{getInstance(){return e||(e=t()),e}}}function ld(){let e=null;function t(){let n=0;return{setNbTimesTalkedGuard(r){n=r},getNbTimesTalkedGuard(){return n}}}return{getInstance(){return e||(e=t()),e}}}function ud(){let e=null;function t(){let n=0;return{setNbTimesTalkedFarmer(r){n=r},getNbTimesTalkedFarmer(){return n}}}return{getInstance(){return e||(e=t()),e}}}function dd(){let e=null,t=!1,n=!1,r=!1,s=!1;function i(){let a=[];return{setChickenHealth(l,o){a[l]=o},getChickenHealth(){return a},isAnyChickenHurt(){return this.getChickenHealth().reduce((l,o)=>l+(o||0),0)<6},isAnyChickenDead(){return a.some(l=>l<=0)},isAnyChickenAlive(){return a.some(l=>l>0)},isInitialized(){return t},setInitialized(l){t=l},resetChickenHealth(l){a=Array(l).fill(2),t=!0},hasTriggeredHurtInteraction(){return n},setTriggeredHurtInteraction(l){n=l},hasTriggeredDeadInteraction(){return r},setTriggeredDeadInteraction(l){r=l},hasTriggeredOneDeadInteraction(){return s},setTriggeredOneDeadInteraction(l){s=l},isSomeButNotAllDead(){const l=this.getChickenHealth(),o=l.filter(c=>c===0).length,u=l.length;return o>0&&o<u}}}return{getInstance(){return e||(e=i()),e}}}function hd(){let e=null;function t(){let n=0;return{setNbTimesTalkedBartender(r){n=r},getNbTimesTalkedBartender(){return n}}}return{getInstance(){return e||(e=t()),e}}}const z=jt().getInstance(),yn=nd().getInstance(),it=rd().getInstance(),K=sd().getInstance(),wn=id().getInstance(),An=ad().getInstance(),vn=od().getInstance(),nr=ld().getInstance(),rr=ud().getInstance(),te=dd().getInstance(),bn=hd().getInstance();function fe(e){let t=Math.floor(K.getHealth()),n=!1,r=K.getPotions(),s=K.getKeys().length,i=K.getIsSwordEquipped(),a=K.getHasHadPotion(),l=K.getHasBasementKey(),o=0;const u=e.add([e.pos(20,20),e.fixed(),"heartsContainer"]);for(let m=0;m<t;m++)u.add([e.sprite("full-heart"),e.pos(o,0)]),o+=48;K.getHealth()-t===.5&&(n=!0,u.add([e.sprite("half-heart"),e.pos(o,0)]),o+=48);let c=K.getMaxHealth()-t-(n?1:0);for(let m=0;m<c;m++)u.add([e.sprite("empty-heart"),e.pos(o,0)]),o+=48;return i===!0&&u.add([e.sprite("sword-icon"),e.pos(0,48)]),a===!0&&(u.add([e.sprite("health-potion"),e.pos(o+24,0)]),u.add([e.text(`x${r}`,{font:"gameboy",size:24}),e.pos(o+76,16)]),o+=98),l===!0&&(u.add([e.sprite("key"),e.pos(o+24,0)]),u.add([e.text(`x${s}`,{font:"gameboy",size:24}),e.pos(o+76,16)])),u}function cd(e){return K.getPotions()>0&&K.getHealth()<K.getMaxHealth()?(K.usePotion(),K.setHealth(Math.min(K.getHealth()+2,K.getMaxHealth())),!0):!1}function L(e,t){e.curAnim()!==t&&e.play(t)}function qi(e,t){for(const n of t)if(e.isKeyDown(n))return!0;return!1}function Ne(e,t,n,r){e.add([e.rect(e.width(),e.height()),e.color(t,n,r),e.fixed()])}async function Ue(e){return await(await fetch(e)).json()}function Ge(e,t,n,r,s,i){let a=0;const l=e.vec2(0,0);function o(u){let c=null;for(const m of i)u>=m.firstgid&&(c=m);return c}for(const u of n.data){if(a%n.width===0?(l.x=0,l.y+=r):l.x+=s,a++,u===0||u<0||u>1e4)continue;const c=o(u);if(!c)continue;let m;c.image&&c.image.split("/").pop()==="topdownasset.png"?m="sprites":c.source?m=c.source.split("/").pop().replace(".tsx",""):c.name?m=c.name:m=c.image?c.image.split("/").pop().replace(".png",""):"unknown";const d=u-c.firstgid;d<0||c.tilecount&&d>=c.tilecount||t.add([e.sprite(m,{frame:d}),e.pos(l),e.offscreen()])}}function fd(e,t,n,r,s){return[e.rect(t,n),e.pos(r.x,r.y+16),e.area(),e.body({isStatic:!0}),e.opacity(0),e.offscreen(),s]}function Ke(e,t,n,r){for(const s of n.objects){const{x:i,y:a,width:l,height:o}=s;t.add(fd(e,l,o,e.vec2(i,a),s.name))}}async function pd(e,t,n,r){t.vel=e.vec2(n.x*r,n.y*r),await e.wait(.12),t.vel=e.vec2(0,0)}async function Vr(e,t,n=1,r=.08){for(let s=0;s<n;s++)t.color=e.rgb(255,255,255),await e.wait(r),t.color=e.rgb(255,0,0),await e.wait(r*2);t.color=e.rgb(255,255,255)}async function gd(e,t,n=3,r=.12){for(let s=0;s<n;s++)await e.wait(s*r,()=>{t.opacity=.5,Vr(e,t,1,r/2)}),await e.wait(s*r,()=>{t.opacity=1})}async function Ii(e,t,n){t.onCollide("swordHitBox",async()=>{if(t.isAttacking)return;if(t.hp()<=0){await gd(e,t),e.destroy(t);return}const r=n();let s=e.vec2(0,0);switch(r.direction){case"left":s=e.vec2(-1,0);break;case"right":s=e.vec2(1,0);break;case"up":s=e.vec2(0,-1);break;case"down":s=e.vec2(0,1);break}Vr(e,t),pd(e,t,s,200),t.hurt(n.attackPower)})}function md(e,t){t.onCollide("player",async n=>{n.isAttacking||(K.setHealth(K.getHealth()-t.attackPower),e.destroyAll("healthContainer"),fe(e),e.play("player-hurt"),await Vr(e,n),K.getHealth()<=0&&(K.setHealth(K.getMaxHealth()),e.go("world")))})}let sr=!1;function ze(e){e.onKeyPress("m",()=>{sr?(e.setVolume(.3),sr=!1):(e.setVolume(0),sr=!0)})}function Ye(e){e.onKeyPress("h",()=>{if(cd())e.play&&e.play("drink",{volume:.8}),e.destroyAll("heartsContainer"),fe(e);else if(K.getHealth()===K.getMaxHealth()&&K.getHasHadPotion()===!0){const t=e.add([e.text("Health is already full!",{size:24,font:"gameboy"}),e.anchor("center"),e.pos(e.width()/2,e.height()/2-200),e.fixed(),"tempMessage"]);e.wait(1,()=>{e.destroy(t)})}else if(K.getPotions()===0&&K.getHasHadPotion()===!0){const t=e.add([e.text("You are out of potions!",{size:24,font:"gameboy"}),e.anchor("center"),e.pos(e.width()/2,e.height()/2-200),e.fixed(),"tempMessage"]);e.wait(1,()=>{e.destroy(t)})}})}function yd(e,t,n){n==="health-potion"&&(K.addPotion(1),K.setHasHadPotion(!0),e.destroyAll("heartsContainer"),fe(e)),n==="basement-key"&&(K.addKey("basement-key"),K.setHasBasementKey(!0)),n==="prison-key"&&(K.addKey("prison-key"),K.setHasPrisonKey(!0))}function Bi(e,t,n,r=16){if(n.isFollowing)return;n.isFollowing=!0,n.startFollowing=!1;const s=["left","a","right","d","up","w","down","s"];e.onKeyPress(s,()=>{n.startFollowing=!0}),e.onUpdate(()=>{if(!n.exists()||!t.exists()||!n.startFollowing)return;let i=e.vec2(0,0);switch(t.direction){case"left":i=e.vec2(r,0);break;case"right":i=e.vec2(-r,0);break;case"up":i=e.vec2(0,r);break;case"down":i=e.vec2(0,-r);break;default:i=e.vec2(0,r)}if(n.pos=n.pos.lerp(t.pos.add(i),.1),n.flipX=t.direction==="left",t.curAnim&&n.curAnim&&t.curAnim()){const a=wd[t.curAnim()];n.curAnim()!==a&&n.play(a)}})}const wd={"player-idle-down":"prisoner-idle-down","player-down":"prisoner-down","player-idle-side":"prisoner-idle-side","player-side":"prisoner-side","player-idle-up":"prisoner-idle-up","player-up":"prisoner-up"};function le(e,t){return[e.sprite("sprites",{anim:"player-idle-down"}),e.area({shape:new e.Rect(e.vec2(3,4),10,12)}),e.body(),e.pos(t),e.opacity(),{speed:100,attackPower:1,direction:"down",isAttacking:!1,inventory:[]},"player"]}function at(e,t,n,r,s,i,a){if(n===r&&!qi(e,s)){switch(i==="left"?t.flipX=!0:i==="right"&&(t.flipX=!1),i){case"left":case"right":L(t,"player-side");break;case"up":L(t,"player-up");break;case"down":L(t,"player-down");break}t.move(a),t.direction=i}}function Ve(e,t){e.onKeyDown(n=>{if(!t.isAttacking){if(z.getFreezePlayer()){t.stop();return}at(e,t,n,"left",["up","w","down","s"],"left",e.vec2(-t.speed,0)),at(e,t,n,"a",["up","w","down","s","left"],"left",e.vec2(-t.speed,0)),at(e,t,n,"right",["up","w","down","s"],"right",e.vec2(t.speed,0)),at(e,t,n,"d",["up","w","down","s","right"],"right",e.vec2(t.speed,0)),at(e,t,n,"up",["down","s"],"up",e.vec2(0,-t.speed)),at(e,t,n,"w",["down","s","up"],"up",e.vec2(0,-t.speed)),at(e,t,n,"down",["up","w"],"down",e.vec2(0,t.speed)),at(e,t,n,"s",["up","w","down"],"down",e.vec2(0,t.speed))}}),e.onKeyPress(n=>{if(n==="space"&&!z.getFreezePlayer()&&K.getIsSwordEquipped()&&!t.isAttacking){if(t.isAttacking=!0,t.stop(),e.get("swordHitBox").length===0){const r={left:t.worldPos().x-2,right:t.worldPos().x+10,up:t.worldPos().x+5,down:t.worldPos().x+2},s={left:t.worldPos().y+5,right:t.worldPos().y+5,up:t.worldPos().y,down:t.worldPos().y+10};e.add([e.area({shape:new e.Rect(e.vec2(0),10,10)}),e.pos(r[t.direction],s[t.direction]),"swordHitBox"]),e.wait(.1,()=>{e.destroyAll("swordHitBox")}),e.wait(.25,()=>{t.direction==="left"||t.direction==="right"?(L(t,"player-side"),t.stop()):(L(t,`player-${t.direction}`),t.stop()),t.isAttacking=!1})}e.play("sword-swing"),L(t,`player-attack-${t.direction}`)}}),e.onKeyRelease(()=>{t.isAttacking||qi(e,["left","a","right","d","up","w","down","s"])||(t.direction==="left"||t.direction==="right"?L(t,"player-idle-side"):t.direction==="up"?L(t,"player-idle-up"):t.direction==="down"&&L(t,"player-idle-down"),t.stop())})}function cs(e,t){const n=e.getCamPos(),r=4,s=1280,i=720,a=s/r,l=i/r,o=n.x-a/2,u=n.x+a/2,c=n.y-l/2,m=n.y+l/2,d=t.worldPos?t.worldPos():t.pos,p=t.area?t.area:null;let f=d.x,v=d.x,y=d.y,w=d.y;return p&&p.shape&&p.shape.w&&p.shape.h&&(f=d.x,v=d.x+p.shape.w,y=d.y,w=d.y+p.shape.h),f<u&&v>o&&y<m&&w>c}const Cr=["left","right","up","down"];function Di(e,t){return[e.sprite("sprites",{anim:"slime-idle-down"}),e.area({shape:new e.Rect(e.vec2(1,5),14,12)}),e.body(),e.pos(t),e.offscreen(),e.opacity(),e.state("idle",["idle",...Cr]),e.health(3),{speed:30,attackPower:.5},"slime"]}function Ad(e,t){e.onUpdate(()=>{if(!(t.health<=0)&&cs(e,t))switch(t.state){case"idle":t.move(0);break;case"left":t.move(-t.speed,0);break;case"right":t.move(t.speed,0);break;case"up":t.move(0,-t.speed);break;case"down":t.move(0,t.speed);break}});const n=t.onStateEnter("idle",async()=>{t.stop(),await e.wait(3),cs(e,t)?t.enterState(Cr[Math.floor(Math.random()*Cr.length)]):t.enterState("idle")}),r=t.onStateEnter("right",async()=>{t.flipX=!1,L(t,"slime-side");const l=e.rand(1,5);let o=0,u=!1;for(;o<l;)if(await e.wait(.1),o+=.1,t.getCollisions().length>0){u=!0;break}if(u){t.enterState("left");return}t.enterState("idle")}),s=t.onStateEnter("left",async()=>{t.flipX=!0,L(t,"slime-side");const l=e.rand(1,5);let o=0,u=!1;for(;o<l;)if(await e.wait(.1),o+=.1,t.getCollisions().length>0){u=!0;break}if(u){t.enterState("idle");return}t.enterState("idle")}),i=t.onStateEnter("up",async()=>{L(t,"slime-up");const l=e.rand(1,5);let o=0,u=!1;for(;o<l;)if(await e.wait(.1),o+=.1,t.getCollisions().length>0){u=!0;break}if(u){t.enterState("idle");return}t.enterState("idle")}),a=t.onStateEnter("down",async()=>{L(t,"slime-down");const l=e.rand(1,5);let o=0,u=!1;for(;o<l;)if(await e.wait(.1),o+=.1,t.getCollisions().length>0){u=!0;break}if(u){t.enterState("idle");return}t.enterState("idle")});e.onSceneLeave(()=>{n.cancel(),r.cancel(),s.cancel(),i.cancel(),a.cancel()})}async function fs(e,t,n,r=10){e.play("dialogue",{volume:1});for(const s of n)await new Promise(i=>setTimeout(()=>{t.text+=s,i()},r))}async function be(e,t,n,r={}){z.setFreezePlayer(!0);const s=e.add([e.rect(800,200),e.pos(t),e.fixed()]),i=s.add([e.text("",{font:"gameboy",width:700,lineSpacing:15,size:z.getFontSize()}),e.color(27,29,52),e.pos(20,20),e.fixed()]);let a=0;const l=r.speed??10;r.onLine&&r.onLine(a),await fs(e,i,n[a],l);let o=!0;const u=e.onKeyPress(["space","enter"],async()=>{if(o){if(a++,!n[a]){e.destroy(s),u.cancel(),z.setFreezePlayer(!1);return}i.text="",o=!1,r.onLine&&r.onLine(a),await fs(e,i,n[a],l),o=!0}})}const vd=[["These slimes are a real nuisance.","I'm sure that wizard up north has something to do with this.","Be sure to check in on my wife. She mentioned something about a gift for you."],["Well I better get back to work..."],["These trees won't chop themselves!"],["Did you get that gift from my wife?"],["Why are you looking at me like that?"],["I can see you got that potion! I bet it will come in handy against those slimes."]],bd=[["essir slimungar eru alveg otholandi!","Eg er viss um ad galdrakallin upp i nordrinu hefur eitthvad med thetta ad gera.","Kiktu vid hja konunni minni. Hun myndist eitthvad a gjof handa ther."],["Jaeja, Eg aetti ad halda afram a vinna..."],["Fekkstu gjofinna fra konunni minni?"],["Hvers vegna horfirdu svona a mig?"]],xd={english:vd,icelandic:bd};function Sd(e,t){return[e.sprite("sprites",{anim:"lumberjack-idle-down"}),e.area({shape:new e.Rect(e.vec2(2,6),12,13)}),e.body({isStatic:!0}),e.pos(t),e.offscreen(),e.opacity(),{speed:30},"lumberjack"]}async function Ed(e,t,n){n.direction==="left"&&(t.flipX=!1,L(t,"lumberjack-idle-side")),n.direction==="right"&&(t.flipX=!0,L(t,"lumberjack-idle-side")),n.direction==="up"&&L(t,"lumberjack-idle-down"),n.direction==="down"&&L(t,"lumberjack-idle-up");const r=xd[z.getLanguage()];let s=it.getNbTimesTalkedLumberjack();if(K.getHasHadPotion()&&!it.getHasMentionedGift()&&K.getPotions()>0){await be(e,e.vec2(250,500),r[5],{speed:10}),it.setHasMentionedGift(!0);return}s>4&&(it.setNbTimesTalkedLumberjack(1),s=it.getNbTimesTalkedLumberjack());let i=s;it.getHasMentionedGift()&&(s===2||s===0)&&(i=4,it.setNbTimesTalkedLumberjack(4)),r[i]&&(await be(e,e.vec2(250,500),r[i],{speed:10}),it.setNbTimesTalkedLumberjack(s+1))}function Ri(e,t,n,r=!1){return[e.sprite("Sprite-0005",{anim:r?"chest-opened":"chest-closed"}),e.area({shape:new e.Rect(e.vec2(1,0),14,10)}),e.body({isStatic:!0}),e.pos(t),e.offscreen(),"chest",{isOpen:r,contents:n}]}function Md(e){const t=`${Math.round(e.pos.x)},${Math.round(e.pos.y)}`;jt().getInstance().setChestOpened(t)}async function Fi(e,t,n){t.isOpen||(e.play("chest-open"),t.isOpen=!0,t.use(e.sprite("Sprite-0005",{anim:"chest-opened"})),yd(e,n,t.contents),Md(t),e.get("heartsContainer").forEach(r=>r.destroy()),fe(e),await be(e,e.vec2(250,500),[`You found a ${t.contents.replace("-"," ")}`]))}async function Cd(e){ze(e),Ye(e);const t=z.getPreviousScene();Ne(e,8,148,236);const n=await Ue("./assets/maps/world.json"),r=e.add([e.pos(0,0)]),s={player:null,slimes:[],chests:[]},i=n.layers;for(const a of i){if(a.name==="Boundaries"){Ke(e,r,a);continue}if(a.name==="SpawnPointsShop"){for(const l of a.objects)if(l.name==="player-shop"&&t==="shop"&&!s.player){s.player=r.add(le(e,e.vec2(l.x,l.y)));continue}}if(a.name==="SpawnPointsTower"){for(const l of a.objects)if(l.name==="player-tower"&&t==="tower"&&!s.player){s.player=r.add(le(e,e.vec2(l.x,l.y)));continue}}if(a.name==="SpawnPointsChest"){for(const l of a.objects)if(l.name==="chest"){const o=l.contents||l.properties?.find(d=>d.name==="contents")?.value||"health-potion",u=`${Math.round(l.x)},${Math.round(l.y)}`,c=z.getChestOpened(u),m=r.add(Ri(e,e.vec2(l.x,l.y),o,c));s.chests.push(m)}}if(a.name==="SpawnPointsHouse"){for(const l of a.objects)if(l.name==="player-house"&&t==="house"&&!s.player){s.player=r.add(le(e,e.vec2(l.x,l.y)));continue}}if(a.name==="SpawnPoints"){for(const l of a.objects){if(l.name==="player"&&!s.player){s.player=r.add(le(e,e.vec2(l.x,l.y)));continue}if(l.name==="slime"){s.slimes.push(r.add(Di(e,e.vec2(l.x,l.y))));continue}if(l.name==="lumberjack"){s.lumberjack=r.add(Sd(e,e.vec2(l.x,l.y)));continue}}continue}a.type==="tilelayer"&&Ge(e,r,a,n.tileheight,n.tilewidth,n.tilesets)}s.player.onCollide("door-entrance",null),s.player.onCollide("shop-entrance",null),s.player.onCollide("tower-entrance",null),s.player.onCollide("chest",null),s.player.onCollide("lumberjack",null),s.player.onCollideEnd("lumberjack",null),s.player.onCollide("door-entrance",()=>{e.play("door-open"),e.go("house")}),s.player.onCollide("shop-entrance",()=>{e.play("door-open"),e.go("shop")}),s.player.onCollide("tower-entrance",()=>{e.play("door-open"),e.go("tower")}),s.player.onCollide("chest",a=>{Fi(e,a,s.player)}),s.player.onCollide("lumberjack",()=>{Ed(e,s.lumberjack,s.player)}),s.player.onCollideEnd("lumberjack",async()=>{await new Promise(a=>setTimeout(a,500)),L(s.lumberjack,"lumberjack-idle-down")});for(const a of s.slimes)Ad(e,a),Ii(e,a,()=>s.player),md(e,a);e.setCamScale(4),e.setCamPos(s.player.worldPos()),e.onUpdate(()=>{s.player.pos.dist(e.getCamPos())>6&&e.tween(e.getCamPos(),s.player.worldPos(),.15,a=>{e.setCamPos(a)},e.easings.linear)}),Ve(e,s.player),fe(e),e.add([e.text(`FPS: ${Math.round(1/e.dt())}`,{size:16,font:"gameboy"}),e.pos(12,12),e.fixed(),{layer:"ui"},{update(){this.text=`FPS: ${Math.round(1/e.dt())}`}}])}const Pd=[["Where have you been?","Can you go take care of those slimes over by the bridge for me?",`Take this sword, 
press space to use it.`],["Press space to use your sword!"],["Well, what are you waiting for?","Take care of those slimes!"],["Did you defeat the slimes yet?","Slay them with your sword! Press space to use it."]],Td=[["Geturdu drepid thessa slimunga vid bruna fyrir mig?","Taktu thetta sverd, yttu a 'space' til ad nota thad."],["Yttu a 'space' til ad nota sverdid thitt!"],["Jaeja, eftir hverju ertu ad bida?","Sjadu um thessa slimunga!"],["Hefurdu drepid slimungana?","Dreptu tha med sverdinu thinu! Yttu a 'space' til ad nota thad."]],qd={english:Pd,icelandic:Td};function Id(e,t){return[e.sprite("sprites",{anim:"oldman-idle-down"}),e.area({shape:new e.Rect(e.vec2(2,6),12,23)}),e.body({isStatic:!0}),e.pos(t),e.offscreen(),"oldman"]}async function Bd(e,t,n){n.direction==="left"&&(t.flipX=!0,L(t,"oldman-idle-side")),n.direction==="right"&&(t.flipX=!1,L(t,"oldman-idle-side")),n.direction==="up"&&L(t,"oldman-idle-down"),n.direction==="down"&&L(t,"oldman-idle-up");const r=qd[z.getLanguage()];let s=yn.getNbTimesTalkedOldman();if(s>r.length-1&&(yn.setNbTimesTalkedOldman(1),s=yn.getNbTimesTalkedOldman()),r[s]){let i={};s===0&&(i.onLine=a=>{a===2&&e.play&&(e.play("item"),K.setIsSwordEquipped(!0),e.destroyAll("heartsContainer"),fe(e))}),await be(e,e.vec2(250,500),r[s],i),yn.setNbTimesTalkedOldman(s+1)}}async function Dd(e){Ye(e),ze(e),Ne(e,27,29,52);const t=await Ue("./assets/maps/house.json"),n=e.add([e.pos(100,192)]),r={player:null,oldman:[]},s=t.layers;for(const i of s){if(i.name==="Boundaries"){Ke(e,n,i);continue}if(i.name==="SpawnPoints")for(const a of i.objects){if(a.name==="player"){r.player=n.add(le(e,e.vec2(a.x,a.y)));continue}else if(a.name==="oldman"){r.oldman=n.add(Id(e,e.vec2(a.x,a.y)));continue}if(a.name==="door-entrance"){n.add(generateColliderBoxComponents(e,a.width,a.height,e.vec2(a.x,a.y),"door-entrance"));continue}}i.type==="tilelayer"&&Ge(e,n,i,t.tileheight,t.tilewidth,t.tilesets)}e.setCamScale(4),Ve(e,r.player),r.player.onCollide("door-exit",()=>{z.setPreviousScene("house"),e.play("door-open"),e.go("world")}),r.player.onCollide("oldman",()=>{Bd(e,r.oldman,r.player)}),r.player.onCollideEnd("oldman",async()=>{await new Promise(i=>setTimeout(i,500)),L(r.oldman,"oldman-idle-down")}),fe(e)}const Rd=[["Good morning sugar. How's your uncle doing?",`Well anyway... 
I just got finished making these potions. Here, take one.`,"You can drink them by pressing 'H'. They'll heal any wounds you have."],["Did you see my husband outside?","I'm just so worried about him ever since these slimes showed up."]],Fd=[["Godan daginn elskan. Hvernig hefur fraendi inn ad?","Allavegana... Eg er nybuin a bua til essi seyi. Herna, taktu eitt.","u getur drukki a me vi a smella a 'H'. eir graeda oll sarin in."],["Sastu manninn minn fyrir utan?","Eg er svo ahyggjufull yfir honum sian essir slmungar komu fram."]],Od={english:Rd,icelandic:Fd};function Hd(e,t){return[e.sprite("sprites",{anim:"shopkeeper-idle-down"}),e.area({shape:new e.Rect(e.vec2(2,6),12,18)}),e.body({isStatic:!0}),e.pos(t),e.offscreen(),"shopkeeper"]}async function xn(e,t,n,r={}){if(r.overrideDialogue&&Array.isArray(r.overrideDialogue)){t.flipX=!0,L(t,"shopkeeper-idle-side"),await be(e,e.vec2(250,500),r.overrideDialogue),setTimeout(()=>{L(t,"shopkeeper-idle-down")},7e3);return}else n.direction==="left"&&(t.flipX=!1,L(t,"shopkeeper-idle-side")),n.direction==="right"&&(t.flipX=!0,L(t,"shopkeeper-idle-side")),n.direction==="up"&&L(t,"shopkeeper-idle-down"),n.direction==="down"&&L(t,"shopkeeper-idle-up");const s=Od[z.getLanguage()];let i=wn.getNbOfTimesTalkedShopkeeper(),a={};i===0&&(a.onLine=o=>{o===1&&e.play&&(K.setHasHadPotion(!0),e.destroyAll("heartsContainer"),fe(e))}),i>s.length-1&&(wn.setNbOfTimesTalkedShopkeeper(1),i=wn.getNbOfTimesTalkedShopkeeper());let l=!1;i===0&&(K.addPotion(1),l=!0),s[i]&&(await be(e,e.vec2(250,500),s[i],a),wn.setNbOfTimesTalkedShopkeeper(i+1),l&&(e.destroyAll("heartsContainer"),fe(e),e.play&&e.play("item")))}const jd=[["Please, you have to get me out of here!","I was collecting herbs for the wizard when that lumberjack attacked me.","The next thing I know, I'm locked up in here!"],["Please, you have to get me out of here!"],["I need you to find a way to free me."]],Ld=[["Thank you for freeing me!","I don't think I would have survived much longer.","Could you help me get out of here?"]],Nd=[["Gerdu ad, u verdur bjarga mer!","Eg var ad safna jurtum fyrir galdrakallinn egar thessi skogarhogsmadur rest a mig.","Naesta sem eg veit, a er eg fastur herna!"],["u verdur ad koma mer hedan! Gerdu ad!"],["u arft a finna leid til ad opna hurdina."]],Ud=[["Takk fyrir ad bjarga mer!","Eg held ad eg hefdi ekki lifad etta af mikid lengur.","Geturdu hjalpad mer a komast hedan ut?"]],Gd={english:jd,icelandic:Nd},Kd={english:Ld,icelandic:Ud};function Oi(e,t){return[e.sprite("sprites",{anim:"prisoner-idle-down"}),e.area({shape:new e.Rect(e.vec2(2,6),12,50)}),e.body({isStatic:!0}),e.pos(t),e.offscreen(),"prisoner"]}async function zd(e,t,n){if(n.direction==="left"&&(t.flipX=!1,L(t,"prisoner-idle-side")),n.direction==="right"&&(t.flipX=!0,L(t,"prisoner-idle-side")),n.direction==="up"&&L(t,"prisoner-idle-down"),n.direction==="down"&&L(t,"prisoner-idle-up"),z.getPrisonDoorOpened()){const i=Kd[z.getLanguage()][0];await be(e,e.vec2(250,500),i),t.unuse("body"),Bi(e,n,t);return}const r=Gd[z.getLanguage()];let s=An.getNbTimesTalkedPrisoner();s>r.length-1&&(An.setNbTimesTalkedPrisoner(1),s=An.getNbTimesTalkedPrisoner()),r[s]&&(await be(e,e.vec2(250,500),r[s]),An.setNbTimesTalkedPrisoner(s+1))}async function Yd(e){Ye(e),ze(e);const t=z.getPreviousScene();console.log("Previous scene:",t),Ne(e,27,29,52);const n=await Ue("./assets/maps/shop.json"),r=e.add([e.pos(-240,-372)]),s={player:null,shopkeeper:null,prisoner:null},i=n.layers;for(const l of i){if(l.name==="Boundaries"){Ke(e,r,l);continue}if(l.name==="SpawnPointsShop"){for(const o of l.objects)if(o.name==="player-shop"&&!s.player&&t==="basement"){s.player=r.add(le(e,e.vec2(o.x,o.y)));continue}}if(l.name==="SpawnPointsShopSecondFloor"){for(const o of l.objects)if(o.name==="player-shop-second-floor"&&!s.player&&t==="shop-second-floor"){s.player=r.add(le(e,e.vec2(o.x,o.y)));continue}}if(l.name==="SpawnPoints")for(const o of l.objects){if(o.name==="player"&&!s.player&&t!=="basement"&&t!=="shop-second-floor"){s.player=r.add(le(e,e.vec2(o.x,o.y)));continue}if(o.name==="shopkeeper"){s.shopkeeper=r.add(Hd(e,e.vec2(o.x,o.y)));continue}if(o.name==="prisoner"){s.prisoner=r.add(Oi(e,e.vec2(o.x,o.y)));continue}if(o.name==="basement-entrance"){r.add(le(e,o.width,o.height,e.vec2(o.x,o.y)));continue}}l.type==="tilelayer"&&Ge(e,r,l,n.tileheight,n.tilewidth,n.tilesets)}if(!s.player)return;e.setCamScale(4),e.setCamPos(s.player.worldPos()),e.onUpdate(()=>{s.player.pos.dist(e.getCamPos())&&e.tween(e.getCamPos(),s.player.worldPos(),.15,l=>{e.setCamPos(l)},e.easings.linear)}),Ve(e,s.player),s.prisoner&&s.player&&z.getPrisonDoorOpened()?(s.prisoner.use({opacity:1}),s.prisoner.unuse("body"),Bi(e,s.player,s.prisoner,20)):(s.prisoner.use({opacity:0}),s.prisoner.unuse("area")),s.player.onCollide("shop-exit",()=>{z.setPreviousScene("shop"),e.go("world")}),s.player.onCollide("shop-second-floor",()=>{z.setPreviousScene("shop"),e.go("shop-second-floor")}),s.player.onCollide("shopkeeper",()=>{xn(e,s.shopkeeper,s.player)});let a=0;s.player.onCollide("basement-entrance",()=>{K.hasKey("basement-key")?(z.setPreviousScene("shop"),e.go("basement")):(a=(a||0)+1,a===1?xn(e,s.shopkeeper,s.player,{overrideDialogue:["What do you think you're doing?"]}):a===2?xn(e,s.shopkeeper,s.player,{overrideDialogue:["Get away from there!"]}):a===3&&xn(e,s.shopkeeper,s.player,{overrideDialogue:["You won't get down there without a key, honey."]}))}),fe(e)}async function Vd(e){Ye(e),ze(e);const t=z.getPreviousScene();Ne(e,27,29,52);const n=await Ue("./assets/maps/shop-second-floor.json"),r=e.add([e.pos(-240,-372)]),s={player:null},i=n.layers;for(const a of i){if(a.name==="Boundaries"){Ke(e,r,a);continue}if(a.name==="SpawnPoints"){for(const l of a.objects)if(l.name==="player"&&!s.player&&t!=="basement"){s.player=r.add(le(e,e.vec2(l.x,l.y)));continue}}a.type==="tilelayer"&&Ge(e,r,a,n.tileheight,n.tilewidth,n.tilesets)}e.setCamScale(4),e.setCamPos(s.player.worldPos()),e.onUpdate(()=>{s.player.pos.dist(e.getCamPos())&&e.tween(e.getCamPos(),s.player.worldPos(),.15,a=>{e.setCamPos(a)},e.easings.linear)}),Ve(e,s.player),s.player.onCollide("shop",()=>{z.setPreviousScene("shop-second-floor"),e.go("shop")}),fe(e)}function Xd(e,t,n,r=!1){return[e.sprite("sprites",{anim:r?"prison-door-opened":"prison-door-closed"}),e.area({shape:new e.Rect(e.vec2(1,0),14,10)}),e.body({isStatic:!0}),e.pos(t),e.offscreen(),"prison-door",{isOpen:r}]}function Wd(e){const t=`${Math.round(e.pos.x)},${Math.round(e.pos.y)}`;jt().getInstance().setPrisonDoorOpened(t)}function Qd(e,t,n=!1){return[e.sprite("sprites",{anim:"secret-passage"}),e.area({shape:new e.Rect(e.vec2(0,0),16,16)}),e.body({isStatic:!n}),e.pos(t),e.offscreen(),"secret-passage"]}function Jd(e,t){return[e.area({shape:new e.Rect(e.vec2(0,0),16,16)}),e.pos(t),e.offscreen(),"transition"]}function Zd(e,t,n=!1){return[e.sprite("sprites",{anim:"pressure-plate-up"}),e.area({shape:new e.Rect(e.vec2(0,0),16,16)}),e.pos(t),e.offscreen(),"pressure-plate"]}function $d(e,t){return[e.sprite("dungeonDoor",{anim:"dungeon-door-1"}),e.area({shape:new e.Rect(e.vec2(0,0),48,48)}),e.body({isStatic:!0}),e.pos(t),e.offscreen(),"dungeon-door"]}const Kt=jt().getInstance();async function _d(e){Ye(e),ze(e),Kt.getPreviousScene(),Ne(e,27,29,52);const t=await Ue("./assets/maps/basement.json"),n=e.add([e.pos(-380,-392)]),r={player:null,chests:[],prisonDoor:null,secretPassage:null,pressurePlates:[],prisoner:null,dungeonDoor:null};for(const l of t.layers){if(l.name==="Boundaries"){Ke(e,n,l);continue}if(l.name==="SpawnPointsChest"){for(const o of l.objects)if(o.name==="chest"){const u=o.contents||o.properties?.find(p=>p.name==="contents")?.value||"health-potion",c=`${Math.round(o.x)},${Math.round(o.y)}`,m=Kt.getChestOpened(c),d=n.add(Ri(e,e.vec2(o.x,o.y),u,m));r.chests.push(d)}}if(l.name==="SpawnPoints"){for(const o of l.objects)if(!(!o||typeof o.x!="number"||typeof o.y!="number")){if(o.name==="player"){r.player=n.add(le(e,e.vec2(o.x,o.y)));continue}if(o.name==="prisoner"){r.prisoner=n.add(Oi(e,e.vec2(o.x,o.y)));continue}if(o.name==="prison-door"){r.prisonDoor=n.add(Xd(e,e.vec2(o.x,o.y)));continue}if(o.name==="secret-passage"){r.secretPassage=n.add(Qd(e,e.vec2(o.x,o.y),!1));continue}if(o.name==="transition"){n.add(Jd(e,e.vec2(o.x,o.y)));continue}if(o.name==="pressure-plate"){const u=n.add(Zd(e,e.vec2(o.x,o.y)));r.pressurePlates.push(u);continue}if(o.name==="dungeon-door"){r.dungeonDoor=n.add($d(e,e.vec2(o.x,o.y)));continue}}}l.type==="tilelayer"&&Ge(e,n,l,t.tileheight,t.tilewidth,t.tilesets)}function s(){return r.pressurePlates.length>0&&r.pressurePlates.every(l=>l.isDown)}r.player.onCollide("pressure-plate",l=>{l._colliderCount===void 0&&(l._colliderCount=0),l._colliderCount++,l.isDown||(l.isDown=!0,l.play("pressure-plate-down"),s()&&a())}),r.secretPassage&&r.secretPassage.onCollide("pressure-plate",l=>{l._colliderCount===void 0&&(l._colliderCount=0),l._colliderCount++,l.isDown||(l.isDown=!0,l.play("pressure-plate-down"),s()&&a())}),r.player.onCollide("chest",l=>{Fi(e,l,r.player)}),r.prisoner&&r.player.onCollide("prisoner",()=>{r.prisoner.isFollowing||zd(e,r.prisoner,r.player)}),r.player.onCollide("prison-door",()=>{K.getHasPrisonKey()&&r.prisonDoor&&!r.prisonDoor.isOpen&&(r.prisonDoor.isOpen=!0,e.play("door-open"),r.prisonDoor.play("prison-door-opened"),r.prisonDoor.unuse("body"),Wd(r.prisonDoor),r.prisoner.unuse("area"),r.prisoner.use(e.area({shape:new e.Rect(e.vec2(2,6),15,12)})),r.secretPassage&&(r.secretPassage.unuse("body"),r.secretPassage.use(e.body({isStatic:!1}))))});let i=!1;r.player.onCollide("transition",async()=>{if(i)return;Kt.setFreezePlayer(!0);const l=r.player.pos.y,o=l-100,u=1;r.player.play("player-up"),await e.tween(l,o,u,c=>{r.player.pos.y=c},e.easings.linear),r.player.play("player-idle-up"),await e.tween(e.getCamPos(),r.player.worldPos(),.5,c=>{e.setCamPos(c)},e.easings.easeInOutSine),await e.wait(.3),i=!0,Kt.setFreezePlayer(!1)}),r.player.onCollide("basement-exit",()=>{r.prisoner&&r.prisoner.isFollowing?be(e,e.vec2(250,500),["Wait! It's too dangerous.","That old woman is very powerful.","Do you see that cracked wall next to the chest?","We might be able to break through."]):(Kt.setPreviousScene("basement"),e.go("shop"))}),r.player.onCollide("castle",()=>{e.go("castle")}),e.setCamScale(4),e.onUpdate(()=>{if(i){const l=e.getCamPos(),o=r.player.worldPos(),u=l.lerp(o,.1);e.setCamPos(u)}}),Ve(e,r.player),fe(e),r.player.onCollideEnd("pressure-plate",l=>{l._colliderCount===void 0&&(l._colliderCount=0),l._colliderCount=Math.max(0,l._colliderCount-1),l._colliderCount===0&&l.isDown&&(l.isDown=!1,l.play("pressure-plate-up"))}),r.secretPassage&&r.secretPassage.onCollideEnd("pressure-plate",l=>{l._colliderCount===void 0&&(l._colliderCount=0),l._colliderCount=Math.max(0,l._colliderCount-1),l._colliderCount===0&&l.isDown&&(l.isDown=!1,l.play("pressure-plate-up"))});async function a(){r.dungeonDoor&&(await r.dungeonDoor.play("dungeon-door-2"),await e.wait(.5),await r.dungeonDoor.play("dungeon-door-3"),await e.wait(.5),await r.dungeonDoor.play("dungeon-door-4"),r.dungeonDoor.unuse("body"))}}const kd=[[`What are you doing here? 
I don't like visitors`,`Well since you're here... 
I need some help.`,`My apprentice has gone missing. 
Can you help me find him?`,"The last time I saw him, he was heading south to the forest to gather herbs."],[`Have you found my apprentice? 
I haven't seen him for days.`],["The last time I saw him, he was heading south to the forest to gather herbs."],["Could you... leave me alone?"],["I'm a little busy here..."]],eh=[[`Hva ertu a gera herna? 
Eg vil ekki gesti`,`Jaeja, fyrst  ert herna... 
Eg arf sma hjalp.`,`Laerlingurinn minn er horfinn. 
Geturu hjalpad mer ad finna hann?`,"Seinast egar eg sa hann, var hann a fara sudur i skoginn til ad safna jurtum."],[`Hefuru fundi laerlinginn minn? 
Eg hef ekki sed hann i marga daga`],["Getur u lati mig i fridi?"],["Eg er sma upptekin herna."]],th={english:kd,icelandic:eh};function nh(e,t){return[e.sprite("sprites",{anim:"wizard-idle-down"}),e.area({shape:new e.Rect(e.vec2(2,6),12,18)}),e.body({isStatic:!0}),e.pos(t),e.offscreen(),"wizard"]}async function rh(e,t,n,r={}){if(r.overrideDialogue&&Array.isArray(r.overrideDialogue)){t.flipX=!0,L(t,"wizard-idle-side"),await be(e,e.vec2(250,500),r.overrideDialogue),setTimeout(()=>{L(t,"wizard-idle-down")},7e3);return}else n.direction==="left"&&(t.flipX=!1,L(t,"wizard-idle-side")),n.direction==="right"&&(t.flipX=!0,L(t,"wizard-idle-side")),n.direction==="up"&&L(t,"wizard-idle-up"),n.direction==="down"&&L(t,"wizard-idle-down");K.setIsSwordEquipped(!0);const s=th[z.getLanguage()];let i=vn.getNbOfTimesTalkedWizard();i>s.length-1&&(vn.setNbOfTimesTalkedWizard(1),i=vn.getNbOfTimesTalkedWizard()),s[i]&&(await be(e,e.vec2(250,500),s[i]),vn.setNbOfTimesTalkedWizard(i+1))}async function sh(e){Ye(e),ze(e);const t=z.getPreviousScene();console.log("Previous scene:",t),Ne(e,27,29,52);const n=await Ue("./assets/maps/tower.json"),r=e.add([e.pos(-240,-372)]),s={player:null,wizard:[]},i=n.layers;for(const a of i){if(a.name==="Boundaries"){Ke(e,r,a);continue}if(a.name==="SpawnPointsTowerSecondFloor"){for(const l of a.objects)if(l.name==="tower-second-floor"&&!s.player&&t==="tower-second-floor"){s.player=r.add(le(e,e.vec2(l.x,l.y)));continue}}if(a.name==="SpawnPoints")for(const l of a.objects){if(l.name==="player"&&!s.player&&t!=="tower-second-floor"){s.player=r.add(le(e,e.vec2(l.x,l.y)));continue}if(l.name==="wizard"){s.wizard=r.add(nh(e,e.vec2(l.x,l.y)));continue}}a.type==="tilelayer"&&Ge(e,r,a,n.tileheight,n.tilewidth,n.tilesets)}s.player&&(e.setCamScale(4),e.setCamPos(s.player.worldPos()),e.onUpdate(()=>{s.player.pos.dist(e.getCamPos())&&e.tween(e.getCamPos(),s.player.worldPos(),.15,a=>{e.setCamPos(a)},e.easings.linear)}),Ve(e,s.player),s.player.onCollide("tower-exit",()=>{z.setPreviousScene("tower"),e.go("world")}),s.player.onCollide("tower-second-floor",()=>{z.setPreviousScene("tower"),e.go("tower-second-floor")}),s.player.onCollide("wizard",()=>{rh(e,s.wizard,s.player)}),fe(e))}async function ih(e){Ye(e),ze(e);const t=z.getPreviousScene();Ne(e,27,29,52);const n=await Ue("./assets/maps/tower-second-floor.json"),r=e.add([e.pos(-240,-372)]),s={player:null},i=n.layers;for(const a of i){if(a.name==="Boundaries"){Ke(e,r,a);continue}if(a.name==="SpawnPoints"){for(const l of a.objects)if(l.name==="player"&&!s.player&&t!=="basement"){s.player=r.add(le(e,e.vec2(l.x,l.y)));continue}}a.type==="tilelayer"&&Ge(e,r,a,n.tileheight,n.tilewidth,n.tilesets)}e.setCamScale(4),e.setCamPos(s.player.worldPos()),e.onUpdate(()=>{s.player.pos.dist(e.getCamPos())&&e.tween(e.getCamPos(),s.player.worldPos(),.15,a=>{e.setCamPos(a)},e.easings.linear)}),Ve(e,s.player),s.player.onCollide("tower",()=>{z.setPreviousScene("tower-second-floor"),e.go("tower")}),fe(e)}function ps(e,t){const n=e.getCamPos(),r=4,s=1280,i=720,a=s/r,l=i/r,o=n.x-a/2,u=n.x+a/2,c=n.y-l/2,m=n.y+l/2,d=t.worldPos?t.worldPos():t.pos,p=t.area?t.area:null;let f=d.x,v=d.x,y=d.y,w=d.y;return p&&p.shape&&p.shape.w&&p.shape.h&&(f=d.x,v=d.x+p.shape.w,y=d.y,w=d.y+p.shape.h),f<u&&v>o&&y<m&&w>c}const Pr=["left","right"];jt().getInstance();function ah(e,t){return[e.sprite("Everything",{anim:"chicken-idle-side"}),e.area({shape:new e.Rect(e.vec2(1,5),14,12)}),e.body(),e.pos(t),e.offscreen(),e.opacity(),e.state("idle",["idle",...Pr]),e.health(2),{speed:30,attackPower:.5},"chicken"]}function oh(e,t,n){e.onUpdate(()=>{if(!(t.health<=0)&&ps(e,t))switch(t.state){case"idle":t.move(0);break;case"left":t.move(-t.speed,0);break;case"right":t.move(t.speed,0);break}});const r=t.onStateEnter("idle",async()=>{t.stop(),await e.wait(3),ps(e,t)?t.enterState(Pr[Math.floor(Math.random()*Pr.length)]):t.enterState("idle")}),s=t.onStateEnter("right",async()=>{t.flipX=!0,L(t,"chicken-side");const a=e.rand(1,5);let l=0,o=!1;for(;l<a;)if(await e.wait(.1),l+=.1,t.getCollisions().length>0){o=!0;break}if(o){t.enterState("left");return}t.enterState("idle")}),i=t.onStateEnter("left",async()=>{t.flipX=!1,L(t,"chicken-side");const a=e.rand(1,5);let l=0,o=!1;for(;l<a;)if(await e.wait(.1),l+=.1,t.getCollisions().length>0){o=!0;break}if(o){t.enterState("idle");return}t.enterState("idle")});t.on("hurt",()=>{te.setChickenHealth(n,t.health)}),e.onSceneLeave(()=>{r.cancel(),s.cancel(),i.cancel()})}const lh=[["Stop right there!","What business do you have here?","We don't just let anyone through pal."],["Get lost!"],["Get out of my face buddy!"]],uh=[["essir slimungar eru alveg otholandi!","Eg er viss um ad galdrakallin upp i nordrinu hefur eitthvad med thetta ad gera.","Kiktu vid hja konunni minni. Hun myndist eitthvad a gjof handa ther."],["Jaeja, Eg aetti ad halda afram a vinna..."],["Fekkstu gjofinna fra konunni minni?"],["Hvers vegna horfirdu svona a mig?"]],dh={english:lh,icelandic:uh};function Bt(e,t,n,r="guard-1"){return[e.sprite("sprites",{anim:n}),e.pos(t.x,t.y),e.area(),e.body({isStatic:!0}),e.health(3),e.offscreen(),r]}async function Dt(e,t,n,r=0){const s=dh[z.getLanguage()][r];let i=nr.getNbTimesTalkedGuard();i>=s.length&&(i=s.length-1,nr.setNbTimesTalkedGuard(i)),s[i]&&(await be(e,e.vec2(250,500),s,{speed:10}),nr.setNbTimesTalkedGuard(i+1))}async function hh(e){const t=z.getPreviousScene();console.log("previousScene:",t),Ye(e),ze(e),Ne(e,8,148,236);const n=await Ue("./assets/maps/castle.json"),r=e.add([e.pos(100,100)]),s={player:null,chicken:[],guards:[]},i=n.layers;console.log("Map layers:",i);for(const a of i){if(a.name==="Boundaries"){Ke(e,r,a);continue}if(a.name==="SpawnPointsThroneRoom"){for(const l of a.objects)if(l.name==="player-throne-room"&&!s.player&&t==="throne-room"){s.player=r.add(le(e,e.vec2(l.x,l.y)));continue}}if(a.name==="SpawnPoints"){const l=a.objects.filter(o=>o.name==="chicken");for(let o=0;o<l.length;o++){const u=l[o],c=te.getChickenHealth();if(c.length&&c[o]===0)continue;const m=r.add(ah(e,e.vec2(u.x,u.y)));s.chicken.push(m),oh(e,m,o),Ii(e,m,()=>s.player),m.on("hurt",()=>{te.setChickenHealth(o,m.hp())})}for(const o of a.objects){if(o.name==="player-barn"&&!s.player&&t==="barn"){s.player=r.add(le(e,e.vec2(o.x,o.y)));continue}if(o.name==="player-barn-side"&&!s.player&&t==="barn-side"){s.player=r.add(le(e,e.vec2(o.x,o.y)));continue}if(o.name==="player"&&!s.player&&t!=="throne-room"&&t!=="barn"&&t!=="barn-side"){s.player=r.add(le(e,e.vec2(o.x,o.y)));continue}if(o.name==="guard-1"){s.guards.push(r.add(Bt(e,e.vec2(o.x,o.y),"guard-1-idle-down")));continue}if(o.name==="guard-2"){s.guards.push(r.add(Bt(e,e.vec2(o.x,o.y),"guard-2-idle-down")));continue}if(o.name==="guard-3"){const u=r.add(Bt(e,e.vec2(o.x,o.y),"guard-3-down","guard-3"));s.guards.push(u);const c=o.y,m=c-300;let d=-1,p="guard-3-down";e.loop(.3,()=>{e.wait(Math.random(.5,1.5)),u.pos.y<=m&&(d=1,p!=="guard-3-down"&&(u.play("guard-3-down"),p="guard-3-down")),u.pos.y>=c&&(d=-1,p!=="guard-3-up"&&(u.play("guard-3-up"),p="guard-3-up")),u.move(0,40*d)})}}continue}a.type==="tilelayer"&&Ge(e,r,a,n.tileheight,n.tilewidth,n.tilesets)}s.player.onCollide("barn-entrance",()=>{e.go("barn")}),s.player.onCollide("barn-side-entrance",()=>{e.go("barn")}),s.player.onCollide("guard-1",a=>{Dt(e,a,s.player,0)}),s.player.onCollide("guard-2",a=>{Dt(e,a,s.player,1)}),s.player.onCollide("guard-3",a=>{Dt(e,a,s.player,2)}),s.player.onCollide("throne-room-entrance",()=>{e.go("throne-room")}),s.player.onCollide("tavern-entrance",()=>{e.go("tavern")}),e.setCamScale(3),s.player&&typeof s.player.worldPos=="function"&&e.setCamPos(s.player.worldPos()),e.onUpdate(()=>{if(s.player&&typeof s.player.worldPos=="function"){const a=s.player.worldPos(),l=e.getCamPos();a&&l&&a.dist(l)>1&&e.tween(l,a,.15,o=>{e.setCamPos(o)},e.easings.linear)}}),Ve(e,s.player),fe(e),te.isInitialized()||te.resetChickenHealth(3)}function ch(e,t,n="king-idle-down",r="king"){return[e.sprite("sprites",{anim:n}),e.pos(t.x,t.y),e.area(),e.body({isStatic:!0}),e.health(5),e.offscreen(),r]}async function fh(e){Ye(e),ze(e),Ne(e,27,29,52);const t=await Ue("./assets/maps/throne-room.json"),n=e.add([e.pos(100,100)]),r={player:null,king:null,slimes:[],guards:[]},s=t.layers;console.log("Map layers:",s);for(const i of s){if(i.name==="Boundaries"){Ke(e,n,i);continue}if(i.name==="SpawnPoints"){for(const a of i.objects){if(a.name==="player"&&!r.player){r.player=n.add(le(e,e.vec2(a.x,a.y)));continue}if(a.name==="slime"){r.slimes.push(n.add(Di(e,e.vec2(a.x,a.y))));continue}if(a.name==="guard-1"){r.guards.push(n.add(Bt(e,e.vec2(a.x,a.y),"guard-1-idle-down")));continue}if(a.name==="guard-2"){r.guards.push(n.add(Bt(e,e.vec2(a.x,a.y),"guard-2-idle-down")));continue}if(a.name==="guard-3"){const l=n.add(Bt(e,e.vec2(a.x,a.y),"guard-3-down","guard-3"));r.guards.push(l);const o=a.y,u=o-300;let c=-1,m="guard-3-down";e.loop(.3,()=>{e.wait(Math.random(.5,1.5)),l.pos.y<=u&&(c=1,m!=="guard-3-down"&&(l.play("guard-3-down"),m="guard-3-down")),l.pos.y>=o&&(c=-1,m!=="guard-3-up"&&(l.play("guard-3-up"),m="guard-3-up")),l.move(0,40*c)})}a.name==="king"&&(r.king=n.add(ch(e,e.vec2(a.x,a.y),"king-sitting-down","king")))}continue}i.type==="tilelayer"&&Ge(e,n,i,t.tileheight,t.tilewidth,t.tilesets)}r.player.onCollide("guard-1",i=>{Dt(e,i,r.player,0)}),r.player.onCollide("guard-2",i=>{Dt(e,i,r.player,1)}),r.player.onCollide("guard-3",i=>{Dt(e,i,r.player,2)}),r.player.onCollide("throne-room-exit",()=>{z.setPreviousScene("throne-room"),e.go("castle")}),e.setCamScale(4),r.player&&typeof r.player.worldPos=="function"&&e.setCamPos(r.player.worldPos()),e.onUpdate(()=>{if(r.player&&typeof r.player.worldPos=="function"){const i=r.player.worldPos(),a=e.getCamPos();i&&a&&i.dist(a)>1&&e.tween(a,i,.15,l=>{e.setCamPos(l)},e.easings.linear)}}),Ve(e,r.player),fe(e)}const ph=[["Howdy there! I haven't seen you around before. It's nice to meet you stranger.","Feel free to pet the chickens!","You can pet the chickens by pressing 'space'... if I remember correctly."],["Well, I should get back to work... Have a good day!"],["Thanks for stopping by!"]],gh=[["essir slimungar eru alveg otholandi!","Eg er viss um ad galdrakallin upp i nordrinu hefur eitthvad med thetta ad gera.","Kiktu vid hja konunni minni. Hun myndist eitthvad a gjof handa ther."],["Jaeja, Eg aetti ad halda afram a vinna..."],["Fekkstu gjofinna fra konunni minni?"],["Hvers vegna horfirdu svona a mig?"]],mh={english:ph,icelandic:gh};function yh(e,t,n="farmer"){return[e.sprite("sprites",{anim:"farmer-idle-down"}),e.pos(t.x,t.y),e.area(),e.body({isStatic:!0}),e.health(2),e.offscreen(),n]}async function Sn(e,t,n,r=0){if(z.getPreviousScene()==="barn-side"&&te.isAnyChickenHurt()){t.flipX=!0,L(t,"farmer-idle-side");let a;te.isAnyChickenDead()&&!te.isAnyChickenAlive()?a=[["No! My chickens! What have you done? T-they're all dead!"],["Just leave! You monster!"]]:te.isSomeButNotAllDead&&typeof te.isSomeButNotAllDead=="function"&&te.isSomeButNotAllDead()?a=[["You killed Beatrice! That was my favorite chicken!"],["I can't believe you would do this!"]]:a=[["Hey! What's your problem? Leave my chickens alone!"],["You think you can just waltz in here and mess with my chickens?"],["Get lost!"]],await be(e,e.vec2(250,500),a),await e.wait(2),L(t,"farmer-idle-down");return}n.direction==="left"&&(t.flipX=!1,L(t,"farmer-idle-side")),n.direction==="right"&&(t.flipX=!0,L(t,"farmer-idle-side")),n.direction==="up"&&L(t,"farmer-idle-down"),n.direction==="down"&&L(t,"farmer-idle-up");const s=mh[z.getLanguage()];let i=rr.getNbTimesTalkedFarmer();i>=s.length&&(i=s.length-1,rr.setNbTimesTalkedFarmer(i)),await be(e,e.vec2(250,500),s[i],{speed:10}),rr.setNbTimesTalkedFarmer(i+1)}async function wh(e){Ye(e),ze(e),Ne(e,27,29,52);const t=await Ue("./assets/maps/barn.json"),n=e.add([e.pos(-70,-160)]);let r=z.getPreviousScene();const s={player:null,farmer:null},i=t.layers;for(const a of i){if(a.name==="Boundaries"){Ke(e,n,a);continue}if(a.name==="SpawnPoints"){for(const l of a.objects){if(l.name==="player"&&!s.player&&r!=="barn-side"){s.player=n.add(le(e,e.vec2(l.x,l.y)));continue}if(l.name==="farmer"){s.farmer=n.add(yh(e,e.vec2(l.x,l.y)));continue}if(l.name==="player-barn"&&!s.player&&r==="barn-side"){s.player=n.add(le(e,e.vec2(l.x,l.y)));continue}}continue}a.type==="tilelayer"&&Ge(e,n,a,t.tileheight,t.tilewidth,t.tilesets)}s.player.onCollide("farmer",()=>{te.isAnyChickenAlive()&&!te.isAnyChickenHurt()?Sn(e,s.farmer,s.player):be(e,e.vec2(250,500),[["I don't want to talk to you!"]],{speed:10})}),s.player.onCollide("barn-exit",()=>{z.setPreviousScene("barn"),e.go("castle")}),s.player.onCollide("barn-side-exit",()=>{z.setPreviousScene("barn-side"),e.go("castle")}),r==="barn-side"&&s.farmer&&s.player&&(te.isAnyChickenHurt()||te.isAnyChickenDead())&&(!te.isAnyChickenAlive()&&!te.hasTriggeredDeadInteraction()?(te.setTriggeredDeadInteraction(!0),Sn(e,s.farmer,s.player)):te.isSomeButNotAllDead()&&!te.hasTriggeredOneDeadInteraction()?(te.setTriggeredOneDeadInteraction(!0),Sn(e,s.farmer,s.player)):te.isAnyChickenHurt()&&te.isAnyChickenAlive()&&!te.hasTriggeredHurtInteraction()&&(te.setTriggeredHurtInteraction(!0),Sn(e,s.farmer,s.player))),e.setCamScale(4),Ve(e,s.player),fe(e)}const Ah=[["Stop right there!","What business do you have here?","We don't just let anyone through pal."],["Get lost!"],["Get out of my face buddy!"]],vh=[["essir slimungar eru alveg otholandi!","Eg er viss um ad galdrakallin upp i nordrinu hefur eitthvad med thetta ad gera.","Kiktu vid hja konunni minni. Hun myndist eitthvad a gjof handa ther."],["Jaeja, Eg aetti ad halda afram a vinna..."],["Fekkstu gjofinna fra konunni minni?"],["Hvers vegna horfirdu svona a mig?"]],bh={english:Ah,icelandic:vh};function xh(e,t){return[e.sprite("sprites",{anim:"bartender-idle-down"}),e.pos(t.x,t.y),e.area(),e.body(),"bartender"]}async function Sh(e,t,n){const r=bh[gameState.getLanguage()];let s=bn.getNbTimesTalkedBartender();s>r.length-1&&(bn.setNbTimesTalkedBartender(1),s=bn.getNbTimesTalkedBartender()),r[s]&&(await dialog(e,e.vec2(250,500),r[s],dialogOptions),bn.setNbTimesTalkedBartender(s+1))}async function Eh(e){Ye(e),ze(e),Ne(e,27,29,52);const t=await Ue("./assets/maps/tavern.json"),n=e.add([e.pos(-70,-160)]);let r=z.getPreviousScene();const s={player:null},i=t.layers;console.log("Map layers:",i);for(const a of i){if(a.name==="Boundaries"){Ke(e,n,a);continue}if(a.name==="SpawnPoints"){for(const l of a.objects){if(l.name==="player"&&!s.player&&r!=="tavern-second-floor"){s.player=n.add(le(e,e.vec2(l.x,l.y)));continue}if(l.name==="bartender"){s.bartender=n.add(xh(e,e.vec2(l.x,l.y)));continue}}continue}a.type==="tilelayer"&&Ge(e,n,a,t.tileheight,t.tilewidth,t.tilesets)}s.player.onCollide("bartender",()=>{Sh(e)}),s.player.onCollide("tavern-exit",()=>{z.setPreviousScene("tavern"),e.go("castle")}),s.player.onCollide("tavern-second-floor",()=>{z.setPreviousScene("tavern-second-floor"),e.go("tavern-second-floor")}),e.setCamScale(4),s.player&&typeof s.player.worldPos=="function"&&e.setCamPos(s.player.worldPos()),e.onUpdate(()=>{if(s.player&&typeof s.player.worldPos=="function"){const a=s.player.worldPos(),l=e.getCamPos();a&&l&&a.dist(l)>1&&e.tween(l,a,.15,o=>{e.setCamPos(o)},e.easings.linear)}}),Ve(e,s.player),fe(e),console.log("Tilesets in tavern map:",t.tilesets)}const Mh={title:"The Game",languageIndication:"Press 'F' to switch between English and Icelandic.",playIndication:"Press 'Enter' to Start."},Ch={title:"Leikurinn",languageIndication:"Smelltu a 'F' til ad skipta a milli ensku og islensku.",playIndication:"Smelltu a 'Enter' til ad byrja."},ir={english:Mh,icelandic:Ch},zt=jt().getInstance();function Ph(e){const t=zt.getLanguage();Ne(e,27,29,52),e.add([e.text(ir[t].title,{size:32,font:"gameboy"}),e.area(),e.anchor("center"),e.pos(e.center().x,e.center().y-100)]),e.add([e.text(ir[t].languageIndication,{size:16,font:"gameboy"}),e.area(),e.anchor("center"),e.pos(e.center().x,e.center().y+100)]),e.add([e.text(ir[t].playIndication,{size:24,font:"gameboy"}),e.area(),e.anchor("center"),e.pos(e.center().x,e.center().y+200)]),e.onKeyPress("f",()=>{const n=zt.getLanguage();zt.setLanguage(n==="english"?"icelandic":"english"),e.go("mainMenu")}),e.onKeyPress("enter",()=>{zt.pauseCurrentSong();const n=e.play("soundtrack",{loop:!0});zt.setCurrentSong(n),e.go("world")})}k.loadFont("gameboy","./assets/gb.ttf");k.loadSprite("Everything","./assets/Everything.png",{sliceX:128,sliceY:128,anims:{"chicken-idle-side":20,"chicken-side":{from:20,to:23,loop:!0}}});k.loadSprite("House","./assets/House.png",{sliceX:14,sliceY:7});k.loadSprite("1_terrain","./assets/1_terrain.png",{sliceX:16,sliceY:16});k.loadSprite("Maple Tree","./assets/Maple Tree.png",{sliceX:10,sliceY:3});k.loadSprite("4_buildings","./assets/4_buildings.png",{sliceX:24,sliceY:24});k.loadSprite("floors-walls","./assets/floors-walls.png",{sliceX:9,sliceY:7});k.loadSprite("Sprite-0005","./assets/Sprite-0005.png",{sliceX:33,sliceY:24,anims:{"chest-closed":239,"chest-opened":240}});k.loadSprite("topdownasset","./assets/topdownasset.png",{sliceX:39,sliceY:62});k.loadSprite("sprites","./assets/topdownasset.png",{sliceX:39,sliceY:62,anims:{"player-idle-down":936,"player-down":{from:936,to:939,loop:!0},"player-idle-side":975,"player-side":{from:976,to:978,loop:!0},"player-idle-up":1014,"player-up":{from:1014,to:1017,loop:!0},"player-attack-up":1094,"player-attack-down":1092,"player-attack-left":1093,"player-attack-right":1093,"slime-idle-down":858,"slime-down":{from:858,to:859,loop:!0},"slime-idle-side":860,"slime-side":{from:860,to:861,loop:!0},"slime-idle-up":897,"slime-up":{from:897,to:898,loop:!0},"lumberjack-idle-down":948,"lumberjack-idle-side":989,"lumberjack-idle-up":1026,"oldman-idle-down":866,"oldman-idle-side":907,"oldman-idle-up":905,"shopkeeper-idle-down":964,"shopkeeper-idle-side":1003,"shopkeeper-idle-up":1042,"prisoner-idle-down":940,"prisoner-down":{from:940,to:943,loop:!0},"prisoner-idle-side":979,"prisoner-side":{from:980,to:982,loop:!0},"prisoner-idle-up":1018,"prisoner-up":{from:1018,to:1021,loop:!0},"prison-door-closed":505,"prison-door-opened":506,"wizard-idle-down":792,"wizard-idle-side":793,"wizard-idle-up":794,"secret-passage":414,"pressure-plate-up":618,"pressure-plate-down":619,"guard-1-idle-down":944,"guard-2-idle-down":679,"guard-3-idle-down":679,"guard-3-down":{from:679,to:682,loop:!0},"guard-3-idle-up":767,"guard-3-up":{from:757,to:760,loop:!0},"king-sitting-down":918,"farmer-idle-down":1209,"farmer-idle-side":1248,"farmer-idle-up":1287,"bartender-idle-down":1213}});k.loadSprite("dungeonDoor","./assets/dungeonDoor.png",{sliceX:4,sliceY:1,anims:{"dungeon-door-1":0,"dungeon-door-2":1,"dungeon-door-3":2,"dungeon-door-4":3}});k.loadSpriteAtlas("./assets/topdownasset.png",{"full-heart":{x:0,y:224,width:48,height:48},"half-heart":{x:48,y:224,width:48,height:48},"empty-heart":{x:96,y:224,width:48,height:48},"health-potion":{x:0,y:272,width:48,height:48},"sword-icon":{x:192,y:224,width:48,height:48},key:{x:96,y:272,width:48,height:48}});k.loadSound("soundtrack","./assets/sounds/soundtrack.mp3");k.loadSound("basement-soundtrack","./assets/sounds/basement-soundtrack.mp3");k.loadSound("castle-soundtrack","./assets/sounds/castle-soundtrack.mp3");k.loadSound("dialogue","./assets/sounds/dialogue.mp3");k.loadSound("sword-swing","./assets/sounds/sword-swing.mp3");k.loadSound("item","./assets/sounds/item.mp3");k.loadSound("drink","./assets/sounds/drink.mp3");k.loadSound("chest-open","./assets/sounds/chest-open.mp3");k.loadSound("player-hurt","./assets/sounds/player-hurt.mp3");k.loadSound("door-open","./assets/sounds/door-open.mp3");const gs={mainMenu:Ph,world:Cd,house:Dd,shop:Yd,"shop-second-floor":Vd,basement:_d,tower:sh,"tower-second-floor":ih,castle:hh,"throne-room":fh,barn:wh,tavern:Eh};for(const e in gs)k.scene(e,()=>gs[e](k));k.go("castle");k.setVolume(.3);let ar=!1;k.onKeyPress("m",()=>{ar?(console.log("Unmuting"),k.setVolume(.3),ar=!1):(console.log("Muting"),k.setVolume(0),ar=!0)});
